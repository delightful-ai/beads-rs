{"_at":[1768197280720,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768180139651,1],"darin@darinsmacstudio.lan"],"claim":[[1768195804586,1],"darin@darinsmacstudio.lan"],"description":[[1768180139651,1],"darin@darinsmacstudio.lan"],"design":[[1768180139651,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768177746679,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768177746679,1],"darin@darinsmacstudio.lan"],"labels":[[1768177746679,1],"darin@darinsmacstudio.lan"],"priority":[[1768177746679,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768177746679,1],"darin@darinsmacstudio.lan"],"title":[[1768177746679,1],"darin@darinsmacstudio.lan"],"type":[[1768177746679,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] serde roundtrip tests for new wire types.\n- [ ] TxnDeltaV1 rejects duplicate op keys and preserves canonical ordering.\n- [ ] Conversions to and from core domain types are covered for at least one bead and note case.","assignee":"darin@darinsmacstudio.lan","assignee_at":[1768195804586,1],"assignee_expires":1768199404586,"closed_at":[1768197280720,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768177746679,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nRealtime events need a canonical delta representation that is not tied to the legacy git wire format. Today only src/git/wire.rs exists, so the realtime lane has no typed delta basis for EventBody and no canonical op ordering.\n\n**Context**\n- REALTIME_PLAN.md 0.7 (delta schema choice) and 2.4 (TxnDeltaV1 fields)\n- Stateright model: beads_stateright_models/src/realtime_types_sketch.rs (WireBeadPatch, NotesPatch, TxnOpKey, TxnDeltaV1)\n\n**Files:** src/core/wire_bead.rs (new), src/core/mod.rs, src/git/wire.rs (reference only)","design":"**Design**\n- Define core wire structs: WireBeadPatch, WireNoteV1, NotesPatch (Omitted vs AtLeast), NoteAppendV1, and TxnOpV1.\n- Define TxnOpKey and represent TxnDeltaV1 as a canonical map keyed by TxnOpKey to enforce unique ops and stable ordering for hashing and encoding.\n- Keep field names compatible with legacy wire to ease conversion, but keep types in core to avoid coupling realtime to git.\n- Provide conversions between domain types (Bead, Note, Tombstone, DepEdge) and wire structs when lossless.\n- Document notes rule: patches omit notes by default; if present they mean set union only (no truncation).","id":"bd-3m5.4","labels":[],"priority":2,"status":"closed","title":"Phase 2: Core wire delta types","type":"task"}
{"_at":[1765774451912,0],"_by":"darin@dusk","_v":{"acceptance_criteria":[[1765690392394,0],"darin@dusk"],"claim":[[1765773882062,0],"darin@dusk"],"description":[[1765690392394,0],"darin@dusk"],"design":[[1765690392394,0],"darin@dusk"],"estimated_minutes":[[1765690392394,0],"darin@dusk"],"external_ref":[[1765690392394,0],"darin@dusk"],"labels":[[1765690392394,0],"darin@dusk"],"priority":[[1765690392394,0],"darin@dusk"],"source_repo":[[1765690392394,0],"darin@dusk"],"title":[[1765690392394,0],"darin@dusk"],"type":[[1765690392394,0],"darin@dusk"]},"assignee":"darin@dusk","assignee_at":[1765773882062,0],"assignee_expires":1765777482062,"closed_at":[1765774451912,0],"closed_by":"darin@dusk","created_at":[1765690392394,0],"created_by":"darin@dusk","description":"## What's Wrong\n`Request::Init` ignores errors from `ensure_repo_loaded` (TODO in code). Also `SyncWait` behavior is duplicated: `Daemon::handle_request` returns Synced immediately, but `run_state_loop` has special-case barrier logic.\n\n## Where\n- src/daemon/core.rs:585 (TODO: ignores ensure_repo_loaded errors after init)\n- src/daemon/core.rs:559 (SyncWait returns immediately)\n- src/daemon/server.rs:45 (SyncWait handled as a barrier before calling daemon)\n\n## Why It Matters\nInit can report success even if repo state isn't loadable, leading to confusing follow-on failures. Duplicated SyncWait logic makes correctness brittle and creates drift.\n\n## Suggested Fix\n- Make Init return an error (or include warning details) if `ensure_repo_loaded` fails.\n- Consolidate SyncWait into one place (prefer state loop barrier) and remove/clarify the other path.\n\n## Acceptance\n- `bd init` fails (or returns structured warning) when it cannot load the repo state.\n- `SyncWait` has a single source of truth (no duplicate paths).","id":"bd-5wc","labels":[],"priority":2,"status":"closed","title":"Daemon init should not ignore ensure_repo_loaded errors; dedupe SyncWait","type":"chore"}
{"_at":[1768541691221,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768509364469,1],"darin@book"],"claim":[[1768541611958,1],"darin@book"],"description":[[1768509364469,1],"darin@book"],"design":[[1768509364469,1],"darin@book"],"estimated_minutes":[[1768509364469,1],"darin@book"],"external_ref":[[1768509364469,1],"darin@book"],"labels":[[1768509364469,1],"darin@book"],"priority":[[1768509364469,1],"darin@book"],"source_repo":[[1768509364469,1],"darin@book"],"title":[[1768509364469,1],"darin@book"],"type":[[1768509364469,1],"darin@book"]},"acceptance_criteria":"- [ ] git commands used in RealtimeFixture fail fast with clear error messages.\\n- [ ] No silent ignore of non-zero exit status.","assignee":"darin@book","assignee_at":[1768541611958,1],"assignee_expires":1768545211958,"closed_at":[1768541691221,1],"closed_by":"darin@book","created_at":[1768509364469,1],"created_by":"darin@book","description":"**Problem**\\n- tests/integration/fixtures/realtime.rs runs git commands via Command::output() but ignores exit status.\\n- If git fails (missing binary, permission), tests fail later with confusing errors.\\n\\n**Files**\\n- tests/integration/fixtures/realtime.rs","design":"Create a small helper (e.g., run_git(args, cwd) -> Result<()>) that checks status.success(), includes stderr/stdout in error, and is used for init/config/remote commands. Consider returning Result from init_git_repo and wiring RealtimeFixture::new to propagate the error (or panic with context).","id":"bd-ja8c","labels":[],"priority":3,"status":"closed","title":"Fixtures: validate git init in RealtimeFixture","type":"chore"}
