{"_at":[1769583586865,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769495930458,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nWe already have a validated `BranchName` type (`identity.rs`) but branch fields still use raw `Option<String>` across core and wire. This means invalid branch names (empty/whitespace, spaces/newlines) can enter state or be emitted on the wire even though the type exists to prevent it. It weakens invariants in creation/closure metadata and spreads stringly-typed branch logic across the stack.\n\nKey references:\n- `crates/beads-core/src/identity.rs:832` — `BranchName` type + validation.\n- `crates/beads-core/src/bead.rs:22` — `Creation.on_branch: Option<String>`.\n- `crates/beads-core/src/composite.rs:65` — `Closure.on_branch: Option<String>`.\n- `crates/beads-core/src/wire_bead.rs:309` / `:343` — `created_on_branch` / `closed_on_branch` are `Option<String>`.\n- `crates/beads-rs/src/git/wire.rs:45` — wire paths pass raw strings.\n\n**Design**\nUse `BranchName` everywhere branch names appear and let serde handle string conversion.\n\n- Replace `Option<String>` with `Option<BranchName>` in:\n  - `Creation` / `BeadCore` (`created_on_branch`)\n  - `Closure` (`on_branch`)\n  - `WireBeadFull` / `WireBeadPatch` (`created_on_branch`, `closed_on_branch`)\n  - Git wire structs that carry branch names\n- Use existing `#[serde(try_from = \"String\", into = \"String\")]` on `BranchName` to keep wire format unchanged while enforcing validation at decode time.\n- Update encode/decode in `event.rs` / `wire_bead.rs` to call `BranchName::parse` and surface errors early.\n- Update CLI parsing to produce `BranchName` (keep error messages helpful).\n\n**Acceptance**\n- [ ] No `created_on_branch` / `closed_on_branch` fields remain as raw `String` in core/wire types.\n- [ ] Decoding invalid branch names fails with actionable errors.\n- [ ] Existing serialization format remains string-compatible; roundtrip tests pass.\n\n**Files**\n- `crates/beads-core/src/identity.rs`\n- `crates/beads-core/src/bead.rs`\n- `crates/beads-core/src/composite.rs`\n- `crates/beads-core/src/wire_bead.rs`\n- `crates/beads-core/src/event.rs`\n- `crates/beads-rs/src/git/wire.rs`","id":"bd-3dw3","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Use BranchName for all branch fields","type":"bug"}
