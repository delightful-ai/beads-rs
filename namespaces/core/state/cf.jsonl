{"_at":[1770519281682,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Docs updated for final crate layout\n- [ ] Full verification commands pass\n- [ ] Epic acceptance checklist demonstrably satisfied","assignee":"darin@darins-Mac-Studio-2.local","closed_reason":"Docs + full verification matrix complete; epic checklist evidence captured","created_at":[1770498239220,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nArchitecture refactors drift quickly without synchronized docs and verification evidence.","design":"Update architecture/workflow docs and run full verification matrix including slow tests and boundary lint.","id":"bd-21eg.28","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1770519281463,0],"author":"darin@darins-Mac-Studio-2.local","content":"Closeout evidence for bd-21eg.28:\n\nDocumentation updated for final crate split + boundaries:\n- `docs/CRATE_DAG.md`\n- `docs/architecture/boundary-api-migration-matrix.md`\n- `docs/architecture/phase2-crate-split-closeout.md`\n\nBoundary / epic acceptance proof points:\n- No CLI->daemon direct imports remain (`rg -n \"crate::daemon::\" crates/beads-rs/src/cli crates/beads-cli/src` => no matches).\n- `beads-cli` and `beads-daemon` compile in workspace flows.\n- Boundary lint is active and passing (`just dylint`).\n- Surface/API contract boundary remains typed and single-source through `beads-surface`/`beads-api` interfaces.\n\nFull verification matrix run and passing:\n- `cargo check`\n- `cargo fmt --all`\n- `just dylint`\n- `cargo clippy --all-features -- -D warnings`\n- `cargo test`\n- `RUST_TEST_THREADS=1 cargo test --features slow-tests`\n\nAcceptance mapping:\n- [x] Docs updated for final crate layout\n- [x] Full verification commands pass\n- [x] Epic acceptance checklist demonstrably satisfied","id":"go-comment-bd-21eg.28-1"},{"at":[1770519281682,0],"author":"darin@darinsmcstudio2.lan","content":"Closeout evidence for bd-21eg.28:\n\nDocumentation updated for final crate split + boundaries:\n- `docs/CRATE_DAG.md`\n- `docs/architecture/boundary-api-migration-matrix.md`\n- `docs/architecture/phase2-crate-split-closeout.md`\n\nBoundary / epic acceptance proof points:\n- No CLI->daemon direct imports remain (`rg -n \"crate::daemon::\" crates/beads-rs/src/cli crates/beads-cli/src` => no matches).\n- `beads-cli` and `beads-daemon` compile in workspace flows.\n- Boundary lint is active and passing (`just dylint`).\n- Surface/API contract boundary remains typed and single-source through `beads-surface`/`beads-api` interfaces.\n\nFull verification matrix run and passing:\n- `cargo check`\n- `cargo fmt --all`\n- `just dylint`\n- `cargo clippy --all-features -- -D warnings`\n- `cargo test`\n- `RUST_TEST_THREADS=1 cargo test --features slow-tests`\n\nAcceptance mapping:\n- [x] Docs updated for final crate layout\n- [x] Full verification commands pass\n- [x] Epic acceptance checklist demonstrably satisfied","id":"legacy-notes"}],"priority":1,"status":"closed","title":"Documentation + full verification closeout for crate split","type":"task"}
{"_at":[1768474444255,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Broadcast/hot‑cache can hold opaque bytes without type lies.\n- [ ] Canonical bytes are only constructed via canonical encoder (or via an explicit `*_unchecked`).\n- [ ] No `EventBytes<Canonical>` created from opaque remote bytes.","assignee":"darin@book","created_at":[1768444207021,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`BroadcastEvent` requires `EventBytes<Canonical>`, but replication ingest accepts `EventBytes<Opaque>` and may forward non‑canonical CBOR bytes (allowed in v0.5). In `ingest_remote_batch` we wrap opaque bytes as canonical, so the type lies about the invariant.\n\n**Signals / Evidence**\n- `BroadcastEvent.bytes: EventBytes<Canonical>` (`src/daemon/broadcast.rs`).\n- Remote ingest constructs `BroadcastEvent` by wrapping `EventBytes<Opaque>` into `EventBytes<Canonical>` (`src/daemon/core.rs`).\n- `EventBytes<Canonical>::new` is public, so any caller can claim canonicality without validation.\n\n**Why this hurts velocity**\nThis is a classic “types lying” case. It makes it impossible to reason about whether bytes are canonical and forces reviewers to audit every call site instead of trusting the type.","design":"**Design**\n- Change `BroadcastEvent` to carry `EventBytes<Opaque>` (or add an enum/marker for `Canonical | Opaque`).\n- Only label bytes as canonical when produced by the canonical encoder.\n- Restrict `EventBytes<Canonical>::new` to `pub(crate)` and expose a constructor that actually enforces canonical encoding (or rename to `new_unchecked` with clear semantics).\n- Update replication broadcast/hot‑cache to use opaque bytes and avoid implicit canonical claims.","id":"bd-ayl","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"BroadcastEvent should not require canonical bytes (type-state leak)","type":"task"}
{"_at":[1769484614847,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] All CLI Request constructors are converted to ctx/payload.\n- [ ] CLI tests updated where they build Request directly.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769480295733,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nCLI command handlers construct `Request` using the old flat shape. After the Request refactor, these calls must be updated in a consistent, ergonomic way.\n\n**Design**\n- Add `mutation_ctx()`, `read_ctx()`, `repo_ctx()` helpers on CLI `Ctx` (as in REFACTORING_PLAN.md Phase 3).\n- Update all CLI command files to construct `Request::{… { ctx, payload } }` using shared payload structs.\n- Keep all fields and defaults identical to prior behavior (especially Claim default lease).\n- Update any CLI unit tests that construct `Request` directly (search `Request::` in `crates/beads-rs/src/cli`).\n\n**Acceptance**\n- [ ] All CLI commands compile against new Request shape.\n- [ ] No behavior changes in CLI options/flags.\n- [ ] `cargo test -p beads-rs cli::mod` (and any affected CLI tests) passes.\n\n**Files:**\n- crates/beads-rs/src/cli/mod.rs\n- crates/beads-rs/src/cli/commands/*.rs","design":"Use the new ctx/payload types; prefer small helpers to avoid repetition. Preserve existing flag → field mappings verbatim.","id":"bd-ebhh.2","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"CLI: switch Request construction to ctx/payload + helpers","type":"task"}
