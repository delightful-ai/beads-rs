{"_at":[1767995059041,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1767992679576,1],"darin@darinsmacstudio.lan"],"claim":[[1767994679578,1],"darin@darinsmacstudio.lan"],"description":[[1767992679576,1],"darin@darinsmacstudio.lan"],"design":[[1767992679576,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1767992679576,1],"darin@darinsmacstudio.lan"],"external_ref":[[1767992679576,1],"darin@darinsmacstudio.lan"],"labels":[[1767992679576,1],"darin@darinsmacstudio.lan"],"priority":[[1767992679576,1],"darin@darinsmacstudio.lan"],"source_repo":[[1767992679576,1],"darin@darinsmacstudio.lan"],"title":[[1767992679576,1],"darin@darinsmacstudio.lan"],"type":[[1767992679576,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@darinsmacstudio.lan","assignee_at":[1767994679578,1],"assignee_expires":1767998279578,"closed_at":[1767995059041,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1767992679576,1],"created_by":"darin@darinsmacstudio.lan","description":"","id":"bd-d2z","labels":[],"priority":2,"status":"closed","title":"GC floor must retroactively clear applied events <= floor for order-independent convergence; add regression test around NamespaceGcMarker apply (see gc_floor_machine)","type":"bug"}
{"_at":[1768416090694,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768411789433,1],"darin@book"],"claim":[[1768415889512,1],"darin@book"],"description":[[1768411789433,1],"darin@book"],"design":[[1768411789433,1],"darin@book"],"estimated_minutes":[[1768411789433,1],"darin@book"],"external_ref":[[1768411789433,1],"darin@book"],"labels":[[1768411789433,1],"darin@book"],"priority":[[1768411789433,1],"darin@book"],"source_repo":[[1768411789433,1],"darin@book"],"title":[[1768411789433,1],"darin@book"],"type":[[1768411789433,1],"darin@book"]},"assignee":"darin@book","assignee_at":[1768415889512,1],"assignee_expires":1768419489512,"closed_at":[1768416090694,1],"closed_by":"darin@book","created_at":[1768411789433,1],"created_by":"darin@book","description":"**Problem**\nRealtime integration tests start the daemon via `bd` auto-start but do not shut it down. `RealtimeFixture` drops only restore env (no `Request::Shutdown`), and `AdminFixture` has no Drop cleanup. `tests/critical_path.rs` and `tests/migration.rs` also auto-start the daemon and never shut it down (only one test does best-effort). This leaves orphaned `bd daemon run` processes, stale sockets/locks, and makes repeated test runs flaky on developer machines and CI.\n\nEvidence:\n- `tests/fixtures/realtime.rs` Drop only restores env (lines 77-80).\n- `tests/phase7_admin.rs`, `tests/phase7_admin_status.rs`, `tests/phase7_subscribe.rs` use `RealtimeFixture::start_daemon()` and never stop it.\n- `tests/critical_path.rs`/`tests/migration.rs` use `bd` CLI without teardown.\n\n**Design**\n- Add a shared test helper `shutdown_daemon(runtime_dir: &Path)` (new `tests/fixtures/daemon_runtime.rs` or similar).\n- Implement shutdown by sending IPC `Request::Shutdown` to `beads/daemon.sock`, waiting for ack or socket removal; fall back to SIGTERM/SIGKILL if the process is still alive after a timeout.\n- Make the helper idempotent (missing socket/meta -> Ok).\n- Call this helper from Drop for `RealtimeFixture` and `AdminFixture`, and from the runtime fixture used by `critical_path`/`migration`.\n\n**Acceptance**\n- [ ] Any test that auto-starts the daemon shuts it down during Drop (socket + meta removed).\n- [ ] `cargo test` leaves no `bd daemon run` processes behind.\n- [ ] Helper is used by phase7 realtime tests and other integration tests that spawn the daemon.\n\n**Files:**\n- tests/fixtures/realtime.rs\n- tests/phase7_admin.rs\n- tests/phase7_admin_status.rs\n- tests/phase7_subscribe.rs\n- tests/critical_path.rs\n- tests/migration.rs\n- tests/fixtures/daemon_runtime.rs (new)","id":"bd-o83","labels":[],"priority":1,"status":"closed","title":"tests: realtime fixtures leak daemon processes","type":"bug"}
