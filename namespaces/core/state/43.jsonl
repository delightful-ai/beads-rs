{"_at":[1768338304258,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darinsmacstudio.lan","created_at":[1768271728087,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nThe realtime code client_request_id_reuse_mismatch exists but cannot be emitted. WAL index upsert overwrites existing (namespace, origin_replica_id, client_request_id) rows, hiding mismatched reuse and mutating history.\n\n**Where**\n- src/core/error.rs: ErrorCode::ClientRequestIdReuseMismatch (defined)\n- src/daemon/ops.rs: OpError lacks a variant\n- src/daemon/wal/index.rs: upsert_client_request uses ON CONFLICT DO UPDATE\n\n**Design**\n- Add OpError variant and IPC mapping for client_request_id_reuse_mismatch with details {namespace, client_request_id, expected_request_sha256, got_request_sha256}.\n- Change index behavior to preserve first-seen mapping; detect mismatch and return explicit error instead of overwriting.\n- Keep idempotent reuse path returning original txn/event ids (no mutation) when request_sha matches.\n\n**Acceptance**\n- Reusing client_request_id with different request_sha256 returns client_request_id_reuse_mismatch (retryable=false).\n- WAL index no longer overwrites request_sha256/txn_id/event_ids on conflict.\n- Matching reuse returns prior ids without mutating history.\n\n**Files**\n- src/daemon/ops.rs\n- src/daemon/wal/index.rs\n- src/core/error.rs","id":"bd-3m5.68","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Idempotency: detect client_request_id reuse mismatch","type":"bug"}
{"_at":[1769593489986,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"Acceptance\n- AddDep rejects DepKind::Parent at parse boundary.\n- SetParent is the only way to create parent edges, and it removes prior parent edges.\n- Tests confirm multiple parents cannot be introduced via any mutation path.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769565878786,0],"created_by":"darin@darinsmcstudio2.lan","description":"Problem\n- ParsedMutationRequest::AddDep allows DepKind::Parent.\n- This bypasses the SetParent path and can create multiple parents for a bead.\n- The \"single parent\" invariant exists only in call-site discipline; the compiler can't enforce it.\n\nImpact\n- Tree semantics for hierarchy can be broken silently.\n- Violates parse-don't-validate and introduces \"lies\" (API implies any dep kind is valid).\n","design":"Design\n- Remove Parent from the AddDep surface: either reject DepKind::Parent in parse_add_dep or expose a distinct request type for parents only.\n- Encode parent edges as a dedicated operation with its own validated type (e.g., ParentEdgeAdd { child, parent, proof: NoCycleProof }).\n- Optionally encode in DepKind by splitting Parent into a distinct enum used only in SetParent.\n- Ensure apply path guarantees at most one Parent edge (remove existing parent before add, as plan_set_parent does).\n\nScatter fit\n- Parent invariants live in one operation; other dep ops cannot express Parent at all.\n\nFiles\n- crates/beads-rs/src/daemon/mutation_engine.rs\n- crates/beads-core/src/dep.rs\n- crates/beads-core/src/domain.rs (if splitting enum)\n- crates/beads-core/src/event.rs (validation)","id":"bd-5mi4","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"mutation: forbid AddDep with Parent; encode single-parent invariant","type":"bug"}
{"_at":[1768814617770,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768779044417,0],"created_by":"darin@darinsmcstudio2.lan","description":"Many fixtures spawn git init/config/remote for temp repos (critical_path, migration, daemon fixtures, repl_rig). Consider a shared helper that uses git2 APIs to init repo, set config, and add remote without process spawn. Should speed test setup and reduce dependency on git binary.","id":"bd-gfu3","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Use libgit2 for test repo setup to avoid spawning git","type":"chore"}
