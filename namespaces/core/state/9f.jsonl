{"_at":[1767992070512,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1767985300995,1],"darin@darinsmacstudio.lan"],"claim":[[1767991703698,1],"darin@darinsmacstudio.lan"],"description":[[1767985300995,1],"darin@darinsmacstudio.lan"],"design":[[1767985300995,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1767985300995,1],"darin@darinsmacstudio.lan"],"external_ref":[[1767985300995,1],"darin@darinsmacstudio.lan"],"labels":[[1767985300995,1],"darin@darinsmacstudio.lan"],"priority":[[1767985300995,1],"darin@darinsmacstudio.lan"],"source_repo":[[1767985300995,1],"darin@darinsmacstudio.lan"],"title":[[1767985300995,1],"darin@darinsmacstudio.lan"],"type":[[1767985300995,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] New model file exists (e.g., beads_stateright_models/examples/idempotency_receipt_machine.rs) and compiles\n- [ ] Properties cover: at-most-once per client_request_id, retry returns original receipt, no stamp remint, and request digest mismatch rejection (todo.md Model #3)\n- [ ] Crash/restart scenarios are modeled for the cut points in REALTIME_PLAN.md §6.5\n- [ ] Model doc comments reference §0.11, §8.2, and §6.5","assignee":"darin@darinsmacstudio.lan","assignee_at":[1767991703698,1],"assignee_expires":1767995303698,"closed_at":[1767992070512,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1767985300995,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nIdempotency and receipts are correctness-critical (REALTIME_PLAN.md §0.11, §8.2, §6.5). There is no model today that covers client_request_id reuse, PENDING vs COMMITTED receipts, or crash-window retries.\n\n**Design Notes**\nModel the receipt state machine and crash cut points so retries are deterministic and do not mint new txn_id or stamps.","design":"**Design**\nCreate a Stateright model with a client_request_id key, request_sha256 guard, and PENDING/COMMITTED receipt states. Include crash cut points aligned to Plan §6.5 ordering (append, fsync, index commit, apply, receipt finalize, reply). Allow retries at any point and ensure the model returns the original receipt without minting new identifiers (Plan §0.11, §8.2).\n\nUse small integers for stamps/txn_id but enforce the invariant that retries reuse the same values. Add explicit mismatch handling when the same client_request_id arrives with a different request digest (Plan §0.11).","id":"bd-hjm.3","labels":["modeling","realtime","stateright"],"priority":1,"status":"closed","title":"Stateright: idempotency + receipts with crash cut points","type":"feature"}
