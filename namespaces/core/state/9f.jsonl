{"_at":[1770511114269,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Ownership of each support module is explicit\n- [ ] CLI uses local/shared module from correct crate\n- [ ] No duplicate config models introduced","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770498237674,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nCLI-adjacent modules are scattered and mixed with daemon concerns.","design":"Place support modules according to ownership, extracting shared pieces where needed.","id":"bd-21eg.23","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1770504565738,0],"author":"darin@darins-Mac-Studio-2.local","content":"Progress: support-level extraction advanced indirectly via shared CLI helper ownership now living in beads-cli. Remaining support modules still mixed ownership: config/telemetry/upgrade transport and runtime paths need explicit boundary split.","id":"go-comment-bd-21eg.23-1"},{"at":[1770507472841,0],"author":"darin@darins-Mac-Studio-2.local","content":"Progress: support-module ownership moved further toward beads-cli by removing prime/setup/onboard compatibility command wrappers and using beads-cli modules directly. This reduces duplicated command support logic in beads-rs while keeping behavior unchanged. Validation passes: cargo check -p beads-rs, cargo test -p beads-cli, cargo check --workspace, just dylint.","id":"go-comment-bd-21eg.23-2"},{"at":[1770508398481,0],"author":"darin@darins-Mac-Studio-2.local","content":"Support ownership tightened further: CLI support concerns now source directly from beads-cli (parsers/filters/validation + prime/setup/onboard command logic). Deleted now-unused beads-rs shim files and kept typed error conversions via crate::Error From impls. This reduces duplicate support logic in beads-rs and improves locality around beads-cli ownership.\nValidation: cargo check -p beads-rs, cargo test -p beads-rs --test integration -- cli::critical_path::, just dylint, cargo check --workspace.","id":"go-comment-bd-21eg.23-3"},{"at":[1770511110232,0],"author":"darin@darins-Mac-Studio-2.local","content":"Completed support-module ownership cleanup with explicit single-owner boundaries and shim removals:\n\nOwnership decisions now applied in code:\n- `migrate` import implementation owner: `beads-cli` (`crates/beads-cli/src/migrate/go_export.rs`)\n  - removed beads-rs compatibility shim (`crates/beads-rs/src/migrate/mod.rs` deleted)\n  - CLI migrate command calls `beads_cli::migrate::import_go_export` directly\n- `upgrade` release metadata/platform/checksum owner: `beads-cli` (`crates/beads-cli/src/upgrade/*`)\n  - orchestrator/runtime owner remains `beads-rs::upgrade` by design (daemon/process integration)\n- `paths` base path/store/wal resolution owner: `beads-cli::paths`\n  - beads-rs retains runtime/config override glue where daemon/runtime coupling is required\n- `config` owner: `beads-rs::config` (shared daemon/runtime source of truth)\n- `telemetry` owner: `beads-rs::telemetry` (daemon+runtime logging integration)\n\nKey cleanup outcome:\n- Removed duplicate migrate shim layer in beads-rs; only one implementation source remains.\n- No duplicate config model definitions introduced; config remains single-source in `beads-rs::config`.\n- CLI command paths now consume support modules from correct owning crate/module.\n\nValidation:\n- cargo check -p beads-rs\n- cargo check -p beads-cli\n- cargo check --workspace\n- cargo test -p beads-rs --test integration -- cli::migration::\n- just dylint\nAll green.","id":"go-comment-bd-21eg.23-4"},{"at":[1770511114269,0],"author":"darin@darinsmcstudio2.lan","content":"Progress: support-level extraction advanced indirectly via shared CLI helper ownership now living in beads-cli. Remaining support modules still mixed ownership: config/telemetry/upgrade transport and runtime paths need explicit boundary split.\n\nProgress: support-module ownership moved further toward beads-cli by removing prime/setup/onboard compatibility command wrappers and using beads-cli modules directly. This reduces duplicated command support logic in beads-rs while keeping behavior unchanged. Validation passes: cargo check -p beads-rs, cargo test -p beads-cli, cargo check --workspace, just dylint.\n\nSupport ownership tightened further: CLI support concerns now source directly from beads-cli (parsers/filters/validation + prime/setup/onboard command logic). Deleted now-unused beads-rs shim files and kept typed error conversions via crate::Error From impls. This reduces duplicate support logic in beads-rs and improves locality around beads-cli ownership.\nValidation: cargo check -p beads-rs, cargo test -p beads-rs --test integration -- cli::critical_path::, just dylint, cargo check --workspace.\n\nCompleted support-module ownership cleanup with explicit single-owner boundaries and shim removals:\n\nOwnership decisions now applied in code:\n- `migrate` import implementation owner: `beads-cli` (`crates/beads-cli/src/migrate/go_export.rs`)\n  - removed beads-rs compatibility shim (`crates/beads-rs/src/migrate/mod.rs` deleted)\n  - CLI migrate command calls `beads_cli::migrate::import_go_export` directly\n- `upgrade` release metadata/platform/checksum owner: `beads-cli` (`crates/beads-cli/src/upgrade/*`)\n  - orchestrator/runtime owner remains `beads-rs::upgrade` by design (daemon/process integration)\n- `paths` base path/store/wal resolution owner: `beads-cli::paths`\n  - beads-rs retains runtime/config override glue where daemon/runtime coupling is required\n- `config` owner: `beads-rs::config` (shared daemon/runtime source of truth)\n- `telemetry` owner: `beads-rs::telemetry` (daemon+runtime logging integration)\n\nKey cleanup outcome:\n- Removed duplicate migrate shim layer in beads-rs; only one implementation source remains.\n- No duplicate config model definitions introduced; config remains single-source in `beads-rs::config`.\n- CLI command paths now consume support modules from correct owning crate/module.\n\nValidation:\n- cargo check -p beads-rs\n- cargo check -p beads-cli\n- cargo check --workspace\n- cargo test -p beads-rs --test integration -- cli::migration::\n- just dylint\nAll green.","id":"legacy-notes"}],"priority":2,"status":"closed","title":"Move CLI support modules (config/paths/upgrade/migrate/telemetry) into beads-cli or shared crates","type":"chore"}
{"_at":[1767992070512,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] New model file exists (e.g., beads_stateright_models/examples/idempotency_receipt_machine.rs) and compiles\n- [ ] Properties cover: at-most-once per client_request_id, retry returns original receipt, no stamp remint, and request digest mismatch rejection (todo.md Model #3)\n- [ ] Crash/restart scenarios are modeled for the cut points in REALTIME_PLAN.md §6.5\n- [ ] Model doc comments reference §0.11, §8.2, and §6.5","assignee":"darin@darinsmacstudio.lan","created_at":[1767985300995,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nIdempotency and receipts are correctness-critical (REALTIME_PLAN.md §0.11, §8.2, §6.5). There is no model today that covers client_request_id reuse, PENDING vs COMMITTED receipts, or crash-window retries.\n\n**Design Notes**\nModel the receipt state machine and crash cut points so retries are deterministic and do not mint new txn_id or stamps.","design":"**Design**\nCreate a Stateright model with a client_request_id key, request_sha256 guard, and PENDING/COMMITTED receipt states. Include crash cut points aligned to Plan §6.5 ordering (append, fsync, index commit, apply, receipt finalize, reply). Allow retries at any point and ensure the model returns the original receipt without minting new identifiers (Plan §0.11, §8.2).\n\nUse small integers for stamps/txn_id but enforce the invariant that retries reuse the same values. Add explicit mismatch handling when the same client_request_id arrives with a different request digest (Plan §0.11).","id":"bd-hjm.3","labels":{"cc":{"max":{}},"entries":{"modeling":[{"counter":13303579372635729072,"replica":"dd55d583-da56-9121-c05e-c65a7b27b9bb"}],"realtime":[{"counter":14768718878948176106,"replica":"8f8704be-e1f2-a406-8d9a-57bbafbed060"}],"stateright":[{"counter":14873742063769662553,"replica":"79178dea-bb9e-899a-5ee1-a5ebff67a80d"}]}},"priority":1,"status":"closed","title":"Stateright: idempotency + receipts with crash cut points","type":"feature"}
