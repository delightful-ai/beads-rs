{"_at":[1769512015209,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] All five crates compile independently\n- [ ] beads-surface consumable without daemon internals\n- [ ] Existing beads_rs::* paths still work via re-exports\n- [ ] cargo test passes\n- [ ] cargo clippy clean","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769398681857,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nThe current single-crate architecture (`crates/beads-rs`) couples the public boundary (IPC protocol, schemas, client) with daemon internals. External consumers cannot use the IPC client without pulling in git/WAL/store implementation details.\n\n**Goal**\nSplit into a dependency DAG:\n- `beads-macros`: shared macro crate (enum_str!), no deps\n- `beads-core`: pure domain + CRDT + error-code/payload types + Effect/Transience\n- `beads-api`: canonical JSON schemas for IPC/--json\n- `beads-surface`: IPC protocol + codec + client + request/patch/query schemas\n- `beads-rs`: daemon + CLI + operational logic (re-exports for compatibility)\n\n```\nbeads-macros\n   ↑\nbeads-core\n   ↑\nbeads-api\n   ↑\nbeads-surface\n   ↑\nbeads-rs\n```\n\n**Phases**\n- Phase 0: Workspace scaffolding + versioning (bd-14fs.1)\n- Phase 1A: Extract enum_str! macro (bd-14fs.11) ← NEW\n- Phase 1: Extract core into beads-core (bd-14fs.2)\n- Phase 2: Extract api into beads-api (bd-14fs.3)\n- Phase 3A: Create beads-surface layout (bd-14fs.4)\n- Phase 3B-D: Move IPC types, ops, query schemas (bd-14fs.5-7) ← PARALLEL\n- Phase 3E: Refactor IPC codec (bd-14fs.8)\n- Phase 3F: Move IPC client (bd-14fs.9)\n- Phase 4: Re-wire beads-rs with re-export shims (bd-14fs.10)\n- Cleanup: Add AGENTS.md documentation (bd-14fs.12)\n\n**Key Gotchas** (from codebase analysis)\n1. enum_str! used in 9 places (4 outside core) - beads-rs needs direct beads-macros dep\n2. Core tests cannot depend on git/daemon\n3. Query type duplication must be removed, not papered over\n4. 2 From impls break orphan rules (OpError, IpcError → ErrorPayload)\n5. 161 Response::err() call sites need explicit .to_error_payload()\n6. Runtime + autostart overrides must move into surface","id":"bd-14fs","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Crate boundary refactor: split beads-rs into workspace DAG","type":"epic"}
{"_at":[1767999821696,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darinsmacstudio.lan","created_at":[1765949712708,0],"created_by":"darin@darinsmcstudio2.lan","description":"beads-go supports creating beads from a markdown file:\n  bd create --file issues.md --type feature\n\nThis enables batch creation workflows. Also consider --from-template support.\n\nFiles: src/cli/mod.rs, src/cli/commands/create.rs","id":"bd-59d","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Add bd create --file for bulk creation from markdown","type":"feature"}
{"_at":[1769571514034,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"Acceptance\n- parse_meta rejects unsupported format_version with a clear error.\n- v1 meta without full checksum set fails to parse.\n- root_slug is validated on load and stored as BeadSlug (invalid slug cannot reach mutation_engine).\n- read_state_at_oid exposes meta verification state via types (Legacy vs V1) and callers compile-fail until they handle it.\n- Add tests for unsupported version, missing checksums, invalid root_slug, and a happy-path v1 meta with checksums.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769563839480,0],"created_by":"darin@darinsmcstudio2.lan","description":"Problem\n- wire::parse_meta exposes format_version but no caller enforces it; read_state_at_oid always treats store as legacy/v1.\n- meta.json can omit checksums; we silently skip verification and still accept blobs.\n- root_slug is Option<String> and not validated at the parse boundary; invalid slugs propagate until mutation_engine rejects them at runtime.\n\nImpact\n- We can accept incompatible future formats or corrupt data without a clear error.\n- The type system can't tell us whether meta was verified or even compatible.\n- Violates parse-don't-validate and Scatter (callers must remember what is safe).\n","design":"Design\n- Replace ParsedMeta with a versioned enum, e.g. StoreMeta::Legacy | StoreMeta::V1 { root_slug: Option<BeadSlug>, last_write_stamp: Option<WriteStamp>, checksums: StoreChecksums }.\n- parse_meta validates format_version == 1; unknown versions return WireError::InvalidValue (or a new UnsupportedVersion variant).\n- For v1 meta, require all checksum fields; treat partial checksum sets as hard errors.\n- Validate root_slug via BeadSlug::parse at parse time; store as Option<BeadSlug> so invalid slugs are unrepresentable.\n- read_state_at_oid returns a typed LoadedStore that carries verification state explicitly (e.g. LoadedStore { meta: StoreMeta, state }). Callers must handle Legacy vs V1 (no silent fallthrough).\n\nScatter fit\n- Put all version + checksum validation in wire.rs; callers should not need to re-check.\n- Remove ad-hoc Option<String> plumbing for root_slug; let the type tell the truth.\n\nFiles\n- crates/beads-rs/src/git/wire.rs\n- crates/beads-rs/src/git/sync.rs\n- crates/beads-rs/src/daemon/git_worker.rs\n- crates/beads-rs/src/daemon/migration.rs\n- crates/beads-rs/src/daemon/core.rs","id":"bd-wxaq","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1769570923199,0],"author":"darin@darins-Mac-Studio-2.local","content":"Rendering should stay in the command files themselves; do not move rendering into shared helpers.","id":"go-comment-bd-wxaq-1"},{"at":[1769571514034,0],"author":"darin@darinsmcstudio2.lan","content":"Rendering should stay in the command files themselves; do not move rendering into shared helpers.","id":"legacy-notes"}],"priority":1,"status":"closed","title":"git store meta parse should be versioned + verified","type":"bug"}
