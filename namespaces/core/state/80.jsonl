{"_at":[1768195999463,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768195757755,1],"darin@darinsmacstudio.lan"],"claim":[[1768189246143,1],"darin@darinsmacstudio.lan"],"design":[[1768180553392,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768178989361,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768178989361,1],"darin@darinsmacstudio.lan"],"labels":[[1768178989361,1],"darin@darinsmacstudio.lan"],"priority":[[1768178989361,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768178989361,1],"darin@darinsmacstudio.lan"],"title":[[1768187797497,1],"darin@darinsmacstudio.lan"],"type":[[1768178989361,1],"darin@darinsmacstudio.lan"],"workflow":[[1768195664088,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] DurabilityProofV1 and DurabilityOutcome types match REALTIME_PLAN.md semantics (local fsync + optional peer acks; pending vs achieved).\n- [ ] DurabilityReceipt includes store identity, txn_id, event_ids, durability_proof, outcome, and min_seen.\n- [ ] Serde JSON roundtrip tests cover DurabilityReceipt and DurabilityProofV1.\n- [ ] No daemon/IPC behavior changes in this bead (core types only).","assignee":"darin@darinsmacstudio.lan","assignee_at":[1768189246143,1],"assignee_expires":1768192846143,"closed_at":[1768195664088,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768178989361,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nReceipts are the durable contract for retries and read-your-writes. Today there is no shared receipt type, so IPC responses risk being inconsistent and partial, and errors cannot safely return a receipt for retry.\n\n**Context**\n- REALTIME_PLAN.md ยง0.11 (idempotency mapping + receipts), ยง10.5 (receipt semantics), ยง16.1 (IPC response shape)\n- Stateright model: beads_stateright_models/src/realtime_types_sketch.rs (DurabilityProofV1, DurabilityOutcome)\n\n**Files:** src/core/durability.rs, src/api/mod.rs\n\n**Design**\n- Define DurabilityProofV1 to capture the local fsync proof and optional replication acks.\n- Define DurabilityOutcome (Achieved vs Pending) to avoid ambiguous Option<DurabilityClass> fields.\n- Define DurabilityReceipt { store: StoreIdentity, txn_id, event_ids, durability_proof, outcome, min_seen } with serde support.\n- Keep types serde-friendly for IPC JSON; daemon/IPC wiring lives in bd-3m5.14.","design":"**Design**\n- Define DurabilityProofV1 to capture the local fsync proof and optional replication acks.\n- Define DurabilityOutcome (Achieved vs Pending) to avoid ambiguous Option<DurabilityClass> fields.\n- Define DurabilityReceipt { store: StoreIdentity, txn_id, event_ids, durability_proof, outcome, min_seen } with serde support.\n- Ensure idempotent retry returns the same txn_id/event_ids, with monotonic improvement of durability_proof if new ACKs are observed.\n- IPC success returns receipt; timeout returns retryable error with receipt included.","id":"bd-3m5.52","labels":[],"priority":2,"status":"closed","title":"Phase 1: DurabilityReceipt response types","type":"task"}
{"_at":[1768526386421,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768508732683,1],"darin@book"],"claim":[[1768526346923,1],"darin@book"],"description":[[1768508732683,1],"darin@book"],"design":[[1768508732683,1],"darin@book"],"estimated_minutes":[[1768508732683,1],"darin@book"],"external_ref":[[1768508732683,1],"darin@book"],"labels":[[1768508732683,1],"darin@book"],"priority":[[1768508732683,1],"darin@book"],"source_repo":[[1768508732683,1],"darin@book"],"title":[[1768508732683,1],"darin@book"],"type":[[1768508732683,1],"darin@book"]},"acceptance_criteria":"- [ ] `server.rs` contains only transport loops and delegates subscription work to the new module.\n- [ ] Backfill planning is testable in isolation.\n- [ ] No behavior change; `phase7_subscribe` tests still pass.","assignee":"darin@book","assignee_at":[1768526346923,1],"assignee_expires":1768529946923,"closed_at":[1768526386421,1],"closed_by":"darin@book","created_at":[1768508732683,1],"created_by":"darin@book","description":"**Problem**\n- `src/daemon/server.rs` mixes transport (socket handling) with subscription/backfill planning, WAL reads, and broadcast error mapping.\n- This obscures boundaries and makes subscription behavior harder to test.\n\n**Files:**\n- src/daemon/server.rs\n- src/daemon/repl/runtime.rs\n- src/daemon/broadcast.rs\n- src/daemon/repl/want.rs (if needed)","design":"- Create a `subscription` module (`src/daemon/subscription.rs` or `src/daemon/repl/subscription.rs`).\n- Move `BackfillPlan`, `build_backfill_plan`, `WalRangeRead`, and subscriber limit helpers into that module.\n- Expose a function like `prepare_subscription(...) -> SubscribeReply` used by `server.rs`.\n- Add unit tests for backfill planning behavior in the new module.","id":"bd-dsvq","labels":[],"priority":2,"status":"closed","title":"Extract subscription/backfill planning from server","type":"chore"}
