{"_at":[1770509501726,0],"_by":"darin@darinsmcstudio2.lan","_v":{"workflow":[[1770509501666,0],"darin@darinsmcstudio2.lan"]},"assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770508424013,0],"created_by":"darin@darinsmcstudio2.lan","description":"Problem: repl_peer fixtures still require beads_rs::daemon::{admission,repl::session} internals, preventing shim cleanup. Design: expose typed repl session/admission fixtures or boundary interfaces from daemon-owned crates, migrate fixture imports, and remove temporary re-export dependence. Acceptance: repl fixtures avoid direct daemon internal session/admission imports; repl integration suite remains green.","id":"bd-21eg.35","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1770509501726,0],"author":"darin@darins-Mac-Studio-2.local","content":"Implemented repl fixture boundary API and removed direct daemon internal imports from repl fixtures.\nChanges:\n- Added `tests/integration/fixtures/daemon_boundary.rs` with typed repl boundary exports.\n- Rewired `tests/integration/fixtures/repl_peer.rs` to import repl/admission/session types via fixture boundary module.\nValidation:\n- cargo test -p beads-rs --test integration -- repl:: (9 pass)\n- cargo check -p beads-rs\nAcceptance met: repl fixtures avoid direct daemon session/admission imports; repl integration suite remains green.","id":"go-comment-bd-21eg.35-1"},{"at":[1770509501726,0],"author":"darin@darinsmcstudio2.lan","content":"Implemented repl fixture boundary API and removed direct daemon internal imports from repl fixtures.\nChanges:\n- Added `tests/integration/fixtures/daemon_boundary.rs` with typed repl boundary exports.\n- Rewired `tests/integration/fixtures/repl_peer.rs` to import repl/admission/session types via fixture boundary module.\nValidation:\n- cargo test -p beads-rs --test integration -- repl:: (9 pass)\n- cargo check -p beads-rs\nAcceptance met: repl fixtures avoid direct daemon session/admission imports; repl integration suite remains green.","id":"legacy-notes"}],"priority":2,"status":"closed","title":"Extract repl session/admission fixture boundary API from daemon internals","type":"task"}
{"_at":[1770511736778,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770511139193,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\\nCLI command handlers remain tied to beads-rs because Ctx/send/render helpers are owned under crates/beads-rs/src/cli/mod.rs.\\n\\n**Design**\\nMove typed CLI runtime primitives (Ctx-equivalent, send wrappers, print/render helpers) into beads-cli without depending on beads-rs internals. Keep behavior identical and preserve JSON/human output shapes.\\n\\n**Acceptance**\\n- [ ] beads-cli exposes typed runtime context/helpers for command handlers\\n- [ ] No behavior change in rendering/transport semantics\\n- [ ] cargo check -p beads-cli and -p beads-rs pass\\n\\n**Files:** crates/beads-cli/src/*, crates/beads-rs/src/cli/mod.rs","id":"bd-21eg.37","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1770511730493,0],"author":"darin@darins-Mac-Studio-2.local","content":"Completed extraction of typed CLI runtime primitives into beads-cli and integrated them into beads-rs without behavior changes.\n\nImplemented in beads-cli:\n- `crates/beads-cli/src/runtime.rs`\n  - `CliRuntimeCtx` (typed context struct for command handlers)\n  - transport helpers (`send_raw`, `send`)\n  - actor/description validation helpers (`validate_actor_id`, `current_actor_id`, `resolve_description`)\n- `crates/beads-cli/src/render.rs`\n  - shared render/print primitives and typed renderer trait surface\n- exports/wiring:\n  - `crates/beads-cli/src/lib.rs` exports `runtime` and `render`\n  - `crates/beads-cli/Cargo.toml` includes required typed deps (`beads-api`, `tracing`, `whoami`)\n\nIntegrated in beads-rs CLI:\n- `crates/beads-rs/src/cli/mod.rs`\n  - `Ctx` now aliases `beads_cli::runtime::CliRuntimeCtx`\n  - `resolve_description` and actor validation now delegate to beads-cli runtime helpers\n  - `send_raw`/`send` now delegate to beads-cli runtime transport helpers\n  - removed stale local transport connection implementation from beads-rs cli module\n\nValidation:\n- cargo check -p beads-cli\n- cargo check -p beads-rs\n- cargo test -p beads-rs --test integration -- cli::critical_path:: (6 pass)\n- just dylint\nAll green.","id":"go-comment-bd-21eg.37-1"},{"at":[1770511736778,0],"author":"darin@darinsmcstudio2.lan","content":"Completed extraction of typed CLI runtime primitives into beads-cli and integrated them into beads-rs without behavior changes.\n\nImplemented in beads-cli:\n- `crates/beads-cli/src/runtime.rs`\n  - `CliRuntimeCtx` (typed context struct for command handlers)\n  - transport helpers (`send_raw`, `send`)\n  - actor/description validation helpers (`validate_actor_id`, `current_actor_id`, `resolve_description`)\n- `crates/beads-cli/src/render.rs`\n  - shared render/print primitives and typed renderer trait surface\n- exports/wiring:\n  - `crates/beads-cli/src/lib.rs` exports `runtime` and `render`\n  - `crates/beads-cli/Cargo.toml` includes required typed deps (`beads-api`, `tracing`, `whoami`)\n\nIntegrated in beads-rs CLI:\n- `crates/beads-rs/src/cli/mod.rs`\n  - `Ctx` now aliases `beads_cli::runtime::CliRuntimeCtx`\n  - `resolve_description` and actor validation now delegate to beads-cli runtime helpers\n  - `send_raw`/`send` now delegate to beads-cli runtime transport helpers\n  - removed stale local transport connection implementation from beads-rs cli module\n\nValidation:\n- cargo check -p beads-cli\n- cargo check -p beads-rs\n- cargo test -p beads-rs --test integration -- cli::critical_path:: (6 pass)\n- just dylint\nAll green.","id":"legacy-notes"}],"priority":1,"status":"closed","title":"Extract CLI runtime context + transport/render helpers into beads-cli","type":"task"}
{"_at":[1768352524533,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768178939206,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbd-3m5.17 is too large. Split: session state machine handles single connection lifecycle.\n\n**Context**\n- REALTIME_PLAN.md ยง9.3-9.4 (handshake, EVENTS processing)\n- Refines bd-3m5.17\n\n**Design**\n- Implement Session struct in src/daemon/repl/session.rs\n- States: Connecting, Handshaking, Streaming, Draining, Closed\n- HELLO/WELCOME handshake with capability negotiation\n- EVENTS processing: validate, buffer gaps, advance watermarks\n- Send ACK with watermarks and heads after apply\n- Error handling: divergence, overload, timeout\n\n**Acceptance**\n- [ ] Session state machine handles connection lifecycle\n- [ ] HELLO/WELCOME negotiates protocol version\n- [ ] EVENTS validated and buffered if gaps\n- [ ] ACK sent after successful apply\n\n**Files:** src/daemon/repl/session.rs","id":"bd-3m5.46","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Phase 5: Replication session state machine","type":"task"}
