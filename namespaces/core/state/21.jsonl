{"_at":[1768352524533,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768178939206,1],"darin@darinsmacstudio.lan"],"claim":[[1768350370223,1],"darin@book"],"description":[[1768178939206,1],"darin@darinsmacstudio.lan"],"design":[[1768178939206,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768178939206,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768178939206,1],"darin@darinsmacstudio.lan"],"labels":[[1768178939206,1],"darin@darinsmacstudio.lan"],"priority":[[1768261543441,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768178939206,1],"darin@darinsmacstudio.lan"],"title":[[1768185452078,1],"darin@darinsmacstudio.lan"],"type":[[1768178939206,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@book","assignee_at":[1768350370223,1],"assignee_expires":1768353970223,"closed_at":[1768352524533,1],"closed_by":"darin@book","created_at":[1768178939206,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nbd-3m5.17 is too large. Split: session state machine handles single connection lifecycle.\n\n**Context**\n- REALTIME_PLAN.md ยง9.3-9.4 (handshake, EVENTS processing)\n- Refines bd-3m5.17\n\n**Design**\n- Implement Session struct in src/daemon/repl/session.rs\n- States: Connecting, Handshaking, Streaming, Draining, Closed\n- HELLO/WELCOME handshake with capability negotiation\n- EVENTS processing: validate, buffer gaps, advance watermarks\n- Send ACK with watermarks and heads after apply\n- Error handling: divergence, overload, timeout\n\n**Acceptance**\n- [ ] Session state machine handles connection lifecycle\n- [ ] HELLO/WELCOME negotiates protocol version\n- [ ] EVENTS validated and buffered if gaps\n- [ ] ACK sent after successful apply\n\n**Files:** src/daemon/repl/session.rs","id":"bd-3m5.46","labels":[],"priority":1,"status":"closed","title":"Phase 5: Replication session state machine","type":"task"}
