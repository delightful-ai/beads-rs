{"_at":[1768199741562,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] apply_event is deterministic and idempotent on repeated events (tests).\n- [ ] Note id collision with different content is detected and surfaced.\n- [ ] ApplyOutcome reports changes used by indexing and checkpoint scheduling.","assignee":"darin@darinsmacstudio.lan","created_at":[1768177773057,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nThe daemon mutates CanonicalState directly, so apply semantics are scattered and can diverge across mutation and replication paths. We need a single pure apply_event path that deterministically maps EventBody deltas to CRDT joins.\n\n**Context**\n- REALTIME_PLAN.md 0.8 (deterministic apply), 2.4 (TxnDeltaV1), 8.3 (apply pipeline)\n- Stateright model: beads_stateright_models/src/realtime_types_sketch.rs (TxnOpV1, TxnDeltaV1)\n\n**Files:** src/core/apply.rs (new), src/core/state.rs, src/core/bead.rs, src/core/dep.rs, src/core/tombstone.rs","design":"**Design**\n- Add core::apply_event(&mut CanonicalState, &EventBody) -> ApplyOutcome as a pure function with no I/O.\n- Apply TxnDeltaV1 ops in canonical op key order so repeated application is deterministic.\n- Use existing CRDT joins (Lww, Tombstone::join, DepEdge::join) and preserve tombstone resurrection rules.\n- Detect note id collisions with mismatched content as corruption (return error), and treat duplicate note append as idempotent.\n- Return ApplyOutcome with changed bead ids, dep keys, and note ids to drive indexing and checkpoint dirtiness.","id":"bd-3m5.6","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Phase 2: core apply_event for EventBody","type":"task"}
{"_at":[1768487268821,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768448649899,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nConfig is currently minimal (`src/config.rs` only has auto_upgrade + limits). REALTIME_PLAN §15.2 requires replication/checkpoint/namespace defaults, and the project needs a maintainable, central config system. We also want repo‑level `beads.toml` (plus user config) with clear precedence and env overrides.\n\n**Design**\n- Introduce a dedicated config module (e.g., `src/config/mod.rs` with submodules `schema.rs`, `load.rs`, `merge.rs`).\n- Define layered config types:\n  - `UserConfig` (global defaults, stored at `~/.config/beads-rs/config.toml`).\n  - `RepoConfig` (repo‑level `beads.toml`).\n  - `EffectiveConfig` (merged result used by CLI/daemon).\n- Keep store‑local files (`namespaces.toml`, `replicas.toml`, store meta) as authoritative for store identity/policy, but allow repo config to supply defaults when those files are absent.\n- Precedence: env vars > repo config > user config > defaults.\n- Provide helper to locate repo root and load `beads.toml`.\n\n**Config schema sketch**\n- `[defaults]` (namespace, durability, actor?)\n- `[replication]` (listen_addr, max_connections, peers, timeouts)\n- `[checkpoint.groups.<name>]` (namespaces, git_ref, writers, debounce/max_interval/max_events, durable_copy_via_git)\n- `[namespaces.<name>]` (NamespacePolicy defaults if store config missing)\n- `[limits]` (existing Limits override)\n\n**Acceptance**\n- [ ] Central config module with clear layering/merge logic and tests.\n- [ ] `beads.toml` supported at repo root; user config still supported.\n- [ ] Env overrides are preserved.\n- [ ] CLI + daemon use `EffectiveConfig` instead of ad‑hoc reads where applicable.","id":"bd-3m5.99","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1768449533383,0],"author":"darin@book","content":"Env var audit: map to config where appropriate. Recommend: BD_ACTOR -> defaults.actor (env remains override); BD_REPL_LISTEN_ADDR -> replication.listen_addr; BD_REPL_MAX_CONNECTIONS -> replication.max_connections; BD_LOAD_TIMEOUT_SECS -> timeouts.git_load_secs (or similar). Keep env-only: BD_REMOTE_URL, BD_STORE_ID (debug overrides); BD_DATA_DIR/BD_CONFIG_DIR/BD_WAL_DIR; LOG; BD_NO_AUTO_UPGRADE (override); BD_UPGRADE_* (test/upgrade harness); BD_TEST_WAL_HANG_* (slow-tests). BD_TOMBSTONE_TTL_MS is legacy tombstone GC for git sync; leave env-only or add to a legacy config section if we intentionally support it.","id":"go-comment-bd-3m5.99-1"},{"at":[1768487268821,0],"author":"darin@darinsmcstudio2.lan","content":"Env var audit: map to config where appropriate. Recommend: BD_ACTOR -> defaults.actor (env remains override); BD_REPL_LISTEN_ADDR -> replication.listen_addr; BD_REPL_MAX_CONNECTIONS -> replication.max_connections; BD_LOAD_TIMEOUT_SECS -> timeouts.git_load_secs (or similar). Keep env-only: BD_REMOTE_URL, BD_STORE_ID (debug overrides); BD_DATA_DIR/BD_CONFIG_DIR/BD_WAL_DIR; LOG; BD_NO_AUTO_UPGRADE (override); BD_UPGRADE_* (test/upgrade harness); BD_TEST_WAL_HANG_* (slow-tests). BD_TOMBSTONE_TTL_MS is legacy tombstone GC for git sync; leave env-only or add to a legacy config section if we intentionally support it.","id":"legacy-notes"}],"priority":2,"status":"closed","title":"Layered config (user+repo beads.toml) with central module","type":"feature"}
{"_at":[1767995576464,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darinsmacstudio.lan","created_at":[1767995397103,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-441","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"cargo test fails in src/daemon/ipc.rs tests: missing BeadId import for Query::Show/Deps","type":"bug"}
{"_at":[1770618072005,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] `beads-cli` owns full CLI command parse/dispatch/handler implementation.\n- [ ] `crates/beads-rs/src/cli/commands/*` is removed or reduced to explicit compat shims with a removal plan.\n- [ ] `bd` behavior is preserved: existing critical-path/integration tests pass without output or semantic regressions.\n- [ ] Dependency DAG policy in `docs/CRATE_DAG.md` remains satisfied (no forbidden edges introduced).\n- [ ] Verification gate passes: `cargo fmt --all`, `just dylint`, `cargo clippy --all-features -- -D warnings`, `cargo test`, `cargo test --features slow-tests`.\n- [ ] Architecture closeout doc captures final ownership map and migration deltas.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770579261378,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nThe CLI/daemon split is still in a hybrid state in the working copy: part of the command surface has moved to `beads-cli`, while substantial parse/dispatch/handler ownership remains in `beads-rs`. This increases maintenance cost and makes crate boundaries harder to reason about.\n\n**Goal**\nComplete the move so `beads-cli` owns the full CLI command surface and `beads-rs` remains a thin orchestration/compat layer only.\n\n**Files**\n- crates/beads-cli/**\n- crates/beads-rs/src/cli/**\n- crates/beads-rs/src/bin/main.rs\n- crates/beads-rs/src/lib.rs\n- crates/beads-rs/tests/**\n- docs/architecture/**\n- docs/CRATE_DAG.md","design":"1. Inventory remaining command handlers and top-level CLI wiring still owned by `beads-rs`.\n2. Move pure IPC/read-only command paths first to minimize risk.\n3. For host-coupled commands (e.g. migrate/store/upgrade), expose typed backend seams and migrate without introducing `beads-cli -> beads-rs` or `beads-cli -> beads-daemon` forbidden edges.\n4. Move top-level parse/dispatch/runtime wiring into `beads-cli`, then keep `beads-rs` entrypoint as thin call-through shim.\n5. Rewire integration tests/fixtures to assert behavior parity (output shape, exit codes, daemon interactions).\n6. Keep boundary policy enforced with `just dylint` and update closeout docs.","id":"bd-atsg","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Finish full CLI ownership move from beads-rs to beads-cli","type":"epic"}
{"_at":[1766137460946,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@dusk","created_at":[1766136153713,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-cg3","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Move more CLI validation into core types (parse helpers)","type":"chore"}
{"_at":[1769217756691,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Unit test: same replica adds two values, remove one -> other survives.\\n- [ ] Unit test: apply_remove with ctx containing dot for value A does NOT remove value B from same replica.\\n- [ ] Join test: a has value A, b removes B and advances ctx; join preserves A.\\n- [ ] Join test: concurrent add vs remove (ctx not covering new dot) is add-wins.\\n- [ ] Serialization roundtrip preserves DVV semantics (encode/decode for DVV if format changed).","assignee":"darin@book","created_at":[1769209799358,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\\nOrSet uses Dvv as max-per-replica and prunes any dot dominated by cc. A remove of one value advances cc and incorrectly removes unrelated values added earlier by the same replica. This breaks labels/deps semantics (remove one label can erase others).\\n\\n**Files**: src/core/orset.rs, src/core/state.rs, src/core/event.rs, src/git/wire.rs, src/daemon/wal_legacy_snapshot.rs","design":"**Design**\\nImplement correct ORSWOT removal semantics by making Dvv a dotted version vector (max + dot exceptions) or equivalent tombstone mechanism so removal can target specific dots without wiping earlier dots from the same replica.\\n\\nImplementation sketch:\\n- Extend Dvv to include an explicit dot set (exception set).\\n- dominates(dot) returns true if dot.counter <= max[replica] OR dot in dots.\\n- merge/join merges max and dot sets and compacts dots covered by max.\\n- apply_remove(value, ctx) removes dots for that value dominated by ctx and merges ctx into cc (without over-approximating unrelated dots).\\n- Update encode/decode for DVV if representation changes (wire + git + WAL).\\n- Add normalization to drop empty entries and resolve collisions deterministically after join.\\n\\nTesting should focus on remove targeting only intended dots and add-wins behavior under concurrency.","id":"bd-qz97.1","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"OR-Set DVV pruning removes unrelated values (fix ORSWOT semantics)","type":"bug"}
{"_at":[1769575175967,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"Acceptance\n- plan cannot be called without a validated StampedContext (compile-time change).\n- Mismatched actor/stamp is impossible to represent or yields a clear OpError at construction.\n- Tests cover mismatch rejection and valid stamping.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769565888376,0],"created_by":"darin@darinsmcstudio2.lan","description":"Problem\n- MutationEngine::plan accepts a Stamp separate from MutationContext.actor_id and never verifies they match.\n- A caller can pass mismatched actor/HLc stamp, yielding events whose HLC actor differs from the request actor.\n- This violates causality invariants and is not caught by the compiler.\n\nImpact\n- Incorrect event authorship and HLC ordering; difficult-to-debug replication issues.\n- Violates \"types should tell the truth\"; the API implies any Stamp is valid.\n","design":"Design\n- Introduce a StampedContext type that can only be constructed from MutationContext + Stamp after verifying stamp.by == ctx.actor_id.\n- Change plan signature to accept StampedContext (or accept a stamp builder that derives from ctx).\n- Option: have plan compute stamp from ctx + wall clock, and only accept the wall clock inputs, not a raw Stamp.\n- Add a debug assertion or validation error if mismatch is detected in legacy call sites.\n\nScatter fit\n- Make the mismatch unrepresentable; no call site can pass a mismatched stamp.\n\nFiles\n- crates/beads-rs/src/daemon/mutation_engine.rs\n- crates/beads-rs/src/daemon/executor.rs (callers)\n- crates/beads-rs/src/daemon/core.rs (callers)","id":"bd-txrl","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"mutation: stamp must be derived from actor context","type":"bug"}
{"_at":[1768757897903,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768719779416,0],"created_by":"darin@darinsmcstudio2.lan","description":"src/cli/commands/show.rs calls fetch_issue_summary per id for deps/children/related. Use Request::List with Filters::ids to fetch all summaries in one IPC round-trip, then map id->summary.","id":"bd-z4vo","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"CLI show: batch summaries for related issue lists","type":"chore"}
