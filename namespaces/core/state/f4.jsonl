{"_at":[1768199741562,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768180161167,1],"darin@darinsmacstudio.lan"],"claim":[[1768198462443,1],"darin@darinsmacstudio.lan"],"description":[[1768180161167,1],"darin@darinsmacstudio.lan"],"design":[[1768180161167,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768177773057,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768177773057,1],"darin@darinsmacstudio.lan"],"labels":[[1768177773057,1],"darin@darinsmacstudio.lan"],"priority":[[1768177773057,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768177773057,1],"darin@darinsmacstudio.lan"],"title":[[1768177773057,1],"darin@darinsmacstudio.lan"],"type":[[1768177773057,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] apply_event is deterministic and idempotent on repeated events (tests).\n- [ ] Note id collision with different content is detected and surfaced.\n- [ ] ApplyOutcome reports changes used by indexing and checkpoint scheduling.","assignee":"darin@darinsmacstudio.lan","assignee_at":[1768198462443,1],"assignee_expires":1768202062443,"closed_at":[1768199741562,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768177773057,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nThe daemon mutates CanonicalState directly, so apply semantics are scattered and can diverge across mutation and replication paths. We need a single pure apply_event path that deterministically maps EventBody deltas to CRDT joins.\n\n**Context**\n- REALTIME_PLAN.md 0.8 (deterministic apply), 2.4 (TxnDeltaV1), 8.3 (apply pipeline)\n- Stateright model: beads_stateright_models/src/realtime_types_sketch.rs (TxnOpV1, TxnDeltaV1)\n\n**Files:** src/core/apply.rs (new), src/core/state.rs, src/core/bead.rs, src/core/dep.rs, src/core/tombstone.rs","design":"**Design**\n- Add core::apply_event(&mut CanonicalState, &EventBody) -> ApplyOutcome as a pure function with no I/O.\n- Apply TxnDeltaV1 ops in canonical op key order so repeated application is deterministic.\n- Use existing CRDT joins (Lww, Tombstone::join, DepEdge::join) and preserve tombstone resurrection rules.\n- Detect note id collisions with mismatched content as corruption (return error), and treat duplicate note append as idempotent.\n- Return ApplyOutcome with changed bead ids, dep keys, and note ids to drive indexing and checkpoint dirtiness.","id":"bd-3m5.6","labels":[],"priority":2,"status":"closed","title":"Phase 2: core apply_event for EventBody","type":"task"}
{"_at":[1768487268821,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768448649899,1],"darin@book"],"claim":[[1768485667221,1],"darin@book"],"description":[[1768448649899,1],"darin@book"],"design":[[1768448649899,1],"darin@book"],"estimated_minutes":[[1768448649899,1],"darin@book"],"external_ref":[[1768448649899,1],"darin@book"],"labels":[[1768448649899,1],"darin@book"],"priority":[[1768448649899,1],"darin@book"],"source_repo":[[1768448649899,1],"darin@book"],"title":[[1768448649899,1],"darin@book"],"type":[[1768448649899,1],"darin@book"]},"assignee":"darin@book","assignee_at":[1768485667221,1],"assignee_expires":1768489267221,"closed_at":[1768487268821,1],"closed_by":"darin@book","created_at":[1768448649899,1],"created_by":"darin@book","description":"**Problem**\nConfig is currently minimal (`src/config.rs` only has auto_upgrade + limits). REALTIME_PLAN §15.2 requires replication/checkpoint/namespace defaults, and the project needs a maintainable, central config system. We also want repo‑level `beads.toml` (plus user config) with clear precedence and env overrides.\n\n**Design**\n- Introduce a dedicated config module (e.g., `src/config/mod.rs` with submodules `schema.rs`, `load.rs`, `merge.rs`).\n- Define layered config types:\n  - `UserConfig` (global defaults, stored at `~/.config/beads-rs/config.toml`).\n  - `RepoConfig` (repo‑level `beads.toml`).\n  - `EffectiveConfig` (merged result used by CLI/daemon).\n- Keep store‑local files (`namespaces.toml`, `replicas.toml`, store meta) as authoritative for store identity/policy, but allow repo config to supply defaults when those files are absent.\n- Precedence: env vars > repo config > user config > defaults.\n- Provide helper to locate repo root and load `beads.toml`.\n\n**Config schema sketch**\n- `[defaults]` (namespace, durability, actor?)\n- `[replication]` (listen_addr, max_connections, peers, timeouts)\n- `[checkpoint.groups.<name>]` (namespaces, git_ref, writers, debounce/max_interval/max_events, durable_copy_via_git)\n- `[namespaces.<name>]` (NamespacePolicy defaults if store config missing)\n- `[limits]` (existing Limits override)\n\n**Acceptance**\n- [ ] Central config module with clear layering/merge logic and tests.\n- [ ] `beads.toml` supported at repo root; user config still supported.\n- [ ] Env overrides are preserved.\n- [ ] CLI + daemon use `EffectiveConfig` instead of ad‑hoc reads where applicable.","id":"bd-3m5.99","labels":[],"notes":[{"at":[1768449533383,1],"author":"darin@book","content":"Env var audit: map to config where appropriate. Recommend: BD_ACTOR -> defaults.actor (env remains override); BD_REPL_LISTEN_ADDR -> replication.listen_addr; BD_REPL_MAX_CONNECTIONS -> replication.max_connections; BD_LOAD_TIMEOUT_SECS -> timeouts.git_load_secs (or similar). Keep env-only: BD_REMOTE_URL, BD_STORE_ID (debug overrides); BD_DATA_DIR/BD_CONFIG_DIR/BD_WAL_DIR; LOG; BD_NO_AUTO_UPGRADE (override); BD_UPGRADE_* (test/upgrade harness); BD_TEST_WAL_HANG_* (slow-tests). BD_TOMBSTONE_TTL_MS is legacy tombstone GC for git sync; leave env-only or add to a legacy config section if we intentionally support it.","id":"9v79vZGR"}],"priority":2,"status":"closed","title":"Layered config (user+repo beads.toml) with central module","type":"feature"}
{"_at":[1767995576464,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1767995397103,1],"darin@darinsmacstudio.lan"],"claim":[[1767995509693,1],"darin@darinsmacstudio.lan"],"description":[[1767995397103,1],"darin@darinsmacstudio.lan"],"design":[[1767995397103,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1767995397103,1],"darin@darinsmacstudio.lan"],"external_ref":[[1767995397103,1],"darin@darinsmacstudio.lan"],"labels":[[1767995397103,1],"darin@darinsmacstudio.lan"],"priority":[[1767995397103,1],"darin@darinsmacstudio.lan"],"source_repo":[[1767995397103,1],"darin@darinsmacstudio.lan"],"title":[[1767995397103,1],"darin@darinsmacstudio.lan"],"type":[[1767995397103,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@darinsmacstudio.lan","assignee_at":[1767995509693,1],"assignee_expires":1767999109693,"closed_at":[1767995576464,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1767995397103,1],"created_by":"darin@darinsmacstudio.lan","description":"","id":"bd-441","labels":[],"priority":3,"status":"closed","title":"cargo test fails in src/daemon/ipc.rs tests: missing BeadId import for Query::Show/Deps","type":"bug"}
{"_at":[1766137460946,0],"_by":"darin@dusk","_v":{"acceptance_criteria":[[1766136153713,0],"darin@dusk"],"claim":[[1766136176129,0],"darin@dusk"],"description":[[1766136153713,0],"darin@dusk"],"design":[[1766136153713,0],"darin@dusk"],"estimated_minutes":[[1766136153713,0],"darin@dusk"],"external_ref":[[1766136153713,0],"darin@dusk"],"labels":[[1766136153713,0],"darin@dusk"],"priority":[[1766136153713,0],"darin@dusk"],"source_repo":[[1766136153713,0],"darin@dusk"],"title":[[1766136153713,0],"darin@dusk"],"type":[[1766136153713,0],"darin@dusk"]},"assignee":"darin@dusk","assignee_at":[1766136176129,0],"assignee_expires":1766139776129,"closed_at":[1766137460946,0],"closed_by":"darin@dusk","created_at":[1766136153713,0],"created_by":"darin@dusk","description":"","id":"bd-cg3","labels":[],"priority":3,"status":"closed","title":"Move more CLI validation into core types (parse helpers)","type":"chore"}
