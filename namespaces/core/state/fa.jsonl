{"_at":[1768450000807,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768444153886,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nREALTIME_PLAN §5.5/§5.6 define an EventWal that owns the active segment per namespace and rotates by size/age. Current code opens a new SegmentWriter for every local mutation and every replication ingest batch, so each event/batch becomes its own segment and rotation logic is effectively bypassed. This contradicts the WAL design and inflates segment count + fsync dir overhead.\n\nEvidence:\n- src/daemon/executor.rs:225–255 creates SegmentWriter::open for each mutation (no reuse).\n- src/daemon/core.rs:1009–1033 (ingest_remote_batch) creates SegmentWriter::open per batch.\n- There is no EventWal struct managing active segments in src/daemon/wal/mod.rs.\n\n**Why this violates plan**\nPlan requires a long-lived EventWal that appends to the current segment, rotates when size/age thresholds are hit, and only fsyncs directories on rotation. Opening a new segment per event defeats these invariants.\n\n**Acceptance**\n- [ ] Introduce EventWal (per store) that keeps active SegmentWriter per namespace.\n- [ ] Use EventWal::append in executor + replication ingest; reuse active segment until rotation triggers.\n- [ ] Rotation honors max_segment_bytes/max_segment_age and only then creates new segment + dir fsync.\n- [ ] Tests cover multi-append into a single segment and rotation thresholds.","id":"bd-3m5.82","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Event WAL uses SegmentWriter per append; no persistent EventWal/segment reuse","type":"bug"}
{"_at":[1769211764333,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Unit test: WalDepStore with empty dots produces DepStore with no values.\\n- [ ] Unit test: WalDepStore with mixed empty/non-empty dots preserves only non-empty entries.","assignee":"darin@book","created_at":[1769209800383,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\\nWalDepStore::into_dep_store inserts entries with empty dot sets, which violates OrSet invariants and can create phantom membership.\\n\\n**Files**: src/daemon/wal_legacy_snapshot.rs, src/core/orset.rs","design":"**Design**\\nSkip entries with empty dot sets during conversion, or normalize through OrSet constructor that prunes empties. Ensure resulting DepStore contains only keys with non-empty dot sets. Add a regression test with empty-dot entries.","id":"bd-qz97.6","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"WalDepStore conversion must not create empty-dot entries","type":"bug"}
{"_at":[1769589200382,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769578525789,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-tjbb","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"parse_legacy_state double-inserts label_store for state entries in git/wire.rs","type":"task"}
