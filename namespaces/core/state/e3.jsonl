{"_at":[1769406787388,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Filters and SortField defined in beads-surface\n- [ ] Filters::matches() implemented in beads-surface\n- [ ] Filter semantics testable at boundary level\n- [ ] `cargo check -p beads-surface` passes\n- [ ] daemon/query.rs imports from beads-surface","assignee":"darin@book","created_at":[1769398696907,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`Filters` and `SortField` are embedded in IPC `Request::List` and other requests - they're part of the public protocol boundary.\n\n**What's in daemon/query.rs today**:\n- `Filters` - query filter struct (boundary)\n- `SortField` - sort specification (boundary)\n- `Filters::matches(&BeadView)` - filter semantics (boundary - part of protocol contract)\n- Internal query execution logic (daemon-only)\n\n**Decision**: Keep `Filters::matches` in surface because filter semantics are part of the public protocol contract.\n\n**Changes**\n\n1. **Create beads-surface/src/query.rs** with filter schemas:\n   ```rust\n   use serde::{Deserialize, Serialize};\n   use beads_core::BeadView;\n\n   #[derive(Debug, Clone, Default, Serialize, Deserialize)]\n   pub struct Filters { ... }\n\n   impl Filters {\n       /// Returns true if the bead matches all specified filters.\n       /// This is part of the protocol contract - filter semantics must be consistent.\n       pub fn matches(&self, bead: &BeadView) -> bool { ... }\n   }\n\n   #[derive(Debug, Clone, Serialize, Deserialize)]\n   pub enum SortField { ... }\n   ```\n\n2. **Keep daemon-only query execution** in beads-rs:\n   - Import: `use beads_surface::query::{Filters, SortField};`\n   - Keep internal execution logic that iterates over state\n\n3. **Remove duplicates from daemon/query.rs**:\n   - Delete `Filters` and `SortField` definitions\n   - Import from beads-surface instead\n\n**Files**\n- crates/beads-surface/src/query.rs (new - filter types + matches())\n- crates/beads-rs/src/daemon/query.rs (refactored - execution only)","id":"bd-14fs.7","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Phase 3D: Extract query filter schemas to beads-surface","type":"task"}
{"_at":[1770502826078,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] model module no longer re-exports daemon internals\n- [ ] Consumers updated to shared typed exports\n- [ ] No behavior regressions in model workflows","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770498508347,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`model` re-exports daemon internals, creating a hidden dependency cliff for split crates.","design":"Re-home model adapters to shared daemon-core or explicit adapters, with typed public exports and no daemon leakage.","id":"bd-21eg.30","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Move model adapters off daemon re-exports","type":"task"}
{"_at":[1768268810681,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] MutationEngine builds a deterministic EventBody draft plus request_sha256 from a canonicalized request.\n- [ ] Limit enforcement rejects oversize requests before WAL append.\n- [ ] MutationEngine produces plan output without mutating CanonicalState.","assignee":"darin@darinsmacstudio.lan","created_at":[1768177849326,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nPhase 4: implement a MutationEngine that turns IPC ops into a single EventBody with canonical request hash and stamps. Current mutations in `src/daemon/executor.rs` mutate state directly; there is no event planning or idempotency digest.\n\n**Context**\n- REALTIME_PLAN.md ยง8.1 and ยง8.2 (mutation planning and request_sha256)\n- request_sha256 storage in WAL headers (REALTIME_PLAN.md ยง0.11)\n**Files:** src/daemon/mutation_engine.rs (new), src/daemon/ops.rs, src/daemon/clock.rs","design":"**Design**\n- Add a MutationEngine that validates inputs, enforces limits (MAX_OPS_PER_TXN, MAX_NOTE_BYTES), and builds one EventBody (TxnV1).\n- Compute canonical request_sha256 from a normalized request that excludes retry only fields (wait_timeout_ms, durability wait targets).\n- Mint txn_id and stamps using HLC; ensure event_time_ms equals stamp wall time and populate hlc_max.\n- Return EventDraft { event_body, request_sha256, client_request_id } for WAL append.","id":"bd-3m5.12","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Phase 4: MutationEngine planning + request hash","type":"task"}
{"_at":[1768542341282,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] `src/api/mod.rs` is a re-export hub only.\n- [ ] Domain types live in dedicated files.\n- [ ] No behavior change; tests pass.","assignee":"darin@book","created_at":[1768508733513,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n- `src/api/mod.rs` is ~900 LOC and mixes admin, realtime, issues, and deps types.\n- Discoverability is low and changes are noisy.\n\n**Files:**\n- src/api/mod.rs\n- src/api/admin.rs\n- src/api/issues.rs\n- src/api/realtime.rs\n- src/api/deps.rs (as needed)","design":"- Split `api/mod.rs` into domain modules and re-export from `mod.rs`.\n- Keep struct names and serde behavior unchanged.\n- Update imports across daemon/cli as needed.","id":"bd-6w3l","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Split api/mod.rs into domain modules","type":"chore"}
{"_at":[1765787088948,0],"_by":"darin@darinsmcstudio2.lan","closed_reason":"Refactored executor.rs to use require_live/require_live_mut with MapLiveError trait. Eliminated all .unwrap() calls on bead lookups.","created_at":[1765781522273,0],"created_by":"darin@darinsmcstudio2.lan","description":"executor.rs has many instances of the check-then-unwrap pattern:\n```rust\nif repo_state.state.get_live(id).is_none() {\n    if repo_state.state.get_tombstone(id).is_some() {\n        return Response::err(OpError::BeadDeleted(id.clone()));\n    }\n    return Response::err(OpError::NotFound(id.clone()));\n}\n// ... later ...\nlet bead = repo_state.state.get_live_mut(id).unwrap();\n```\n\nShould use the new require_live/require_live_mut helpers added in bd-ieo.\n\nFiles: src/daemon/executor.rs","id":"bd-n11","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Refactor executor.rs to use require_live helpers","type":"chore"}
