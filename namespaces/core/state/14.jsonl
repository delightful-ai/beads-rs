{"_at":[1767998814474,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darinsmacstudio.lan","created_at":[1765744962426,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nMixed use of `tracing` and `eprintln!`. For a \"daemon for swarms\", logs matter.\n\n**Design**\n- Use `tracing` everywhere (esp sync start/stop, retries, backoff, durations, remote id)\n- Add structured fields for key events\n- Consider counters (sync failures, queue depth, refresh latency) - even structured logs help before full prometheus\n\n**Acceptance**\n- [ ] No `eprintln!` in non-test code\n- [ ] Sync events have structured tracing spans\n- [ ] Key metrics visible in logs (durations, retry counts)\n\n**Files:** grep for eprintln, likely src/daemon/*.rs, src/git/*.rs","id":"bd-0ap","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Observability: replace eprintln with tracing everywhere","type":"chore"}
{"_at":[1769596098140,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"Acceptance\n- Every mutation path that emits WireBeadPatch runs validation (or uses ValidatedBeadPatch type).\n- Tests cover that invalid patch combinations fail early in mutation planning.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769565914175,0],"created_by":"darin@darinsmcstudio2.lan","description":"Problem\n- plan_claim/plan_unclaim/plan_extend_claim and plan_close/plan_reopen build WireBeadPatch but do not call validate_wire_patch.\n- Today the patches happen to be valid, but future changes to patch semantics can silently break invariants.\n- This is a drift risk (types don't guarantee the patch is validated).\n\nImpact\n- Inconsistent validation across mutation paths; fragile invariants.\n","design":"Design\n- Add a validated patch builder (e.g., BeadPatchBuilder) that always returns ValidatedBeadPatch.\n- Or, call validate_wire_patch in every mutation path that emits a patch (claim/unclaim/extend/close/reopen/delete).\n- Encode as a helper so missing validation is a compile-time error (e.g., return ValidatedBeadPatch from plan_*).\n\nScatter fit\n- Centralize patch validation and make it the only way to emit bead upserts.\n\nFiles\n- crates/beads-rs/src/daemon/mutation_engine.rs\n- crates/beads-core/src/event.rs (if adding builder)","id":"bd-3uw0","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"mutation: validate all claim/close patches before emit","type":"bug"}
{"_at":[1769484603890,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Per‑op parse fns replace ParsedMutationRequest::parse.\n- [ ] Executor mutation flow updated to use payloads directly.\n- [ ] Existing mutation engine tests updated for new parse API.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769480308365,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`daemon::mutation_engine::MutationRequest` duplicates wire shapes and must be deleted. The mutation pipeline should parse directly from shared payloads while preserving all validation and idempotency behavior.\n\n**Design**\n- Delete `MutationRequest` enum in `daemon/mutation_engine.rs`.\n- Replace `ParsedMutationRequest::parse(MutationRequest, …)` with per‑payload parse fns (e.g., `parse_create(payload, actor)`), carrying over all normalization logic verbatim:\n  - trim‑to‑None for optional strings\n  - assignee `\"me\"/\"self\"` normalization\n  - invalid ID mapping to `OpError::InvalidId` vs `ValidationFailed`\n  - label/dep parsing behavior\n- Update executor mutation handling to accept payload structs instead of MutationRequest:\n  - `apply_*` signatures accept `payload: …` and pass into `ParsedMutationRequest::parse_*`.\n  - Preserve idempotency hash semantics: keep `request_sha256` based on `CanonicalMutation { namespace, actor_id, client_request_id, op }`.\n- Update `daemon/mutation_engine.rs` unit tests to use payloads + new parse fns.\n- Update `daemon/executor.rs` tests (idempotency, op_result_from_delta) that referenced MutationRequest.\n\n**Acceptance**\n- [ ] `MutationRequest` removed with no behavior changes.\n- [ ] All parsing/normalization semantics preserved.\n- [ ] Idempotency hash semantics unchanged.\n- [ ] `cargo test -p beads-rs daemon::mutation_engine` and `daemon::executor` pass.\n\n**Files:**\n- crates/beads-rs/src/daemon/mutation_engine.rs\n- crates/beads-rs/src/daemon/executor.rs","design":"Follow Phase 5 in REFACTORING_PLAN.md. Keep hash behavior identical and reuse existing normalization helpers.","id":"bd-ebhh.3","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Daemon mutation path: remove MutationRequest, parse payloads directly","type":"task"}
{"_at":[1768715517215,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] A model exists that uses `LinearizabilityTester` or `SequentialConsistencyTester` for read/receipt semantics.\n- [ ] The model uses `RegisterMsg::record_invocations` + `record_returns` instead of custom history tracking.\n- [ ] Consistency property is asserted and passes in the bounded model.","assignee":"darin@book","created_at":[1768680802330,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nWe currently hand-write invariants for read/receipt semantics. Stateright provides built-in linearizability/sequential consistency testers we’re not using.\n\n**Goal**\nUse Stateright’s consistency testers to validate read/receipt behavior against a sequential spec.","design":"**Design**\n1) Define a small sequential spec for receipts/reads (e.g., `Register` or `WriteOnceRegister`).\n2) Use `actor::register::RegisterMsg` helpers to record invocations/returns:\n   - `RegisterMsg::record_invocations`\n   - `RegisterMsg::record_returns`\n3) Build an ActorModel where client actors issue reads/writes (or receipt queries), and server actors call production code paths to produce responses.\n4) Attach `LinearizabilityTester` (or `SequentialConsistencyTester`) to history type H.\n5) Add a property that checks `history.is_consistent()`.\n\n**References**\n- `~/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/stateright-0.31.0/src/semantics/consistency_tester.rs`\n- `~/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/stateright-0.31.0/src/semantics/linearizability.rs`\n- `~/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/stateright-0.31.0/src/semantics/sequential_consistency.rs`\n- `~/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/stateright-0.31.0/src/actor/register.rs`\n- Example: `~/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/stateright-0.31.0/examples/linearizable-register.rs`","id":"bd-np77","labels":{"cc":{"max":{}},"entries":{}},"priority":0,"status":"closed","title":"Stateright consistency testers for read/receipt semantics","type":"task"}
