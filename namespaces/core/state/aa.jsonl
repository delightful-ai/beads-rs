{"_at":[1769517753954,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] `WireBeadFull` cannot represent conflicting workflow/claim timestamps.\n- [ ] Import/export preserves canonical stamps without redundancy.\n- [ ] Backward compatibility path exists or explicit migration is documented.\n- [ ] Tests cover at least one inconsistent legacy payload being rejected or normalized.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769495028619,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`WireBeadFull` includes redundant workflow/claim timestamps (`closed_at/closed_by`, `assignee_at`) that can conflict with the canonical LWW stamps derived from `workflow`/`claim`. Conversions ignore these fields, which means the wire type can represent contradictory states. This violates “information holds its shape” and creates a lying API for checkpoints/snapshots.\n\nKey references:\n- `crates/beads-core/src/wire_bead.rs:303` — `WireBeadFull` fields.\n- `crates/beads-core/src/composite.rs:99` — closure/claim timestamps are derived from LWW stamps.\n\nSeverity: snapshot import/export can silently accept inconsistent data; types do not encode invariants.","design":"**Design**\nMake workflow/claim snapshot representations canonical and non‑redundant.\n\nOption A (sum types):\n- Replace `status + closed_*` with `WorkflowSnapshot`:\n  - `Open {}`\n  - `InProgress {}`\n  - `Closed { at: WireStamp, by: ActorId, reason: Option<String>, on_branch: Option<String> }`\n- Replace `assignee + assignee_at + assignee_expires` with `ClaimSnapshot`:\n  - `Unclaimed {}`\n  - `Claimed { assignee: ActorId, at: WireStamp, expires: Option<WallClock> }`\n\nOption B (derived-only):\n- Remove `closed_at/closed_by` and `assignee_at` from `WireBeadFull`; derive from stamps only.\n\nGiven compatibility needs, Option A keeps wire expressiveness while encoding invariants.\n\nMigration:\n- Adjust serde for backward compatibility (accept old fields, emit new shape).\n- Update `WireBeadFull::from_view` and `From<WireBeadFull> for Bead` accordingly.","id":"bd-yax6","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Encode workflow/claim snapshot invariants in WireBeadFull","type":"bug"}
