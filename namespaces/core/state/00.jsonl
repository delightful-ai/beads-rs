{"_at":[1768278581850,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768271745099,1],"darin@darinsmacstudio.lan"],"claim":[[1768278031735,1],"darin@darinsmacstudio.lan"],"description":[[1768271745099,1],"darin@darinsmacstudio.lan"],"design":[[1768271745099,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768271745099,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768271745099,1],"darin@darinsmacstudio.lan"],"labels":[[1768271745099,1],"darin@darinsmacstudio.lan"],"priority":[[1768271745099,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768271745099,1],"darin@darinsmacstudio.lan"],"title":[[1768271745099,1],"darin@darinsmacstudio.lan"],"type":[[1768271745099,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@darinsmacstudio.lan","assignee_at":[1768278031735,1],"assignee_expires":1768281631735,"closed_at":[1768278581850,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768271745099,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nReplay maps all SegmentHeader errors to segment_header_mismatch, including unsupported wal_format_version and header decode failures. REALTIME_ERRORS.md distinguishes wal_format_unsupported from semantic header mismatch and from corruption.\n\n**Where**\n- src/daemon/wal/segment.rs: SegmentHeader::decode reports unsupported wal format version\n- src/daemon/ops.rs: wal_replay_error_code maps SegmentHeader to segment_header_mismatch\n- src/daemon/ipc.rs: mirrored mapping\n\n**Design**\n- Add a specific error variant (or reason parsing) to detect wal_format_version mismatch and map to wal_format_unsupported with details {wal_format_version, supported}.\n- Split decode failures (bad magic/CRC/truncated header) from semantic mismatch and map to wal_corrupt (or specific corruption code) instead of segment_header_mismatch.\n\n**Acceptance**\n- Unsupported wal_format_version yields wal_format_unsupported.\n- Header decode failures yield corruption code, not segment_header_mismatch.\n- True store_id/store_epoch mismatch continues to use segment_header_mismatch.\n\n**Files**\n- src/daemon/wal/segment.rs\n- src/daemon/ops.rs\n- src/daemon/ipc.rs","id":"bd-3m5.70","labels":[],"priority":1,"status":"closed","title":"WAL replay: map wal_format_unsupported and header decode vs mismatch","type":"bug"}
