{"_at":[1766129876918,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1765835909920,0],"created_by":"darin@darinsmcstudio2.lan","description":"Add integration test that:\n1. Starts daemon\n2. Creates beads\n3. SIGKILL daemon (before sync completes)\n4. Restarts daemon\n5. Verifies beads recovered from WAL\n\nRequires subprocess spawning and signal handling in test harness. See tests/critical_path.rs for existing integration test patterns.","id":"bd-1u2","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Add kill -9 crash recovery integration test for WAL","type":"task"}
{"_at":[1768622571168,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622571168,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbeads-rs lacks the Event issue type - immutable operational state change records that provide an audit trail of swarm activity. Events capture who did what when, enabling debugging, monitoring, and compliance.\n\n**What Event Beads Do (from Go beads)**\nEvent beads are append-only records of state changes:\n- Operational events (agent started, gate resolved, patrol completed)\n- System events (sync failed, timeout detected)\n- Audit trail (who approved what, who escalated)\n- Never modified after creation (immutable)\n\nEvent structure:\n- EventKind: Namespaced event type (e.g., \"patrol.muted\", \"agent.started\")\n- Actor: Entity URI or bead ID who caused the event\n- Target: Entity URI or bead ID affected by the event\n- Payload: Event-specific JSON data\n- Timestamp: When event occurred (CreatedAt)\n\nEvent kinds (namespaced):\n- patrol.*: Patrol lifecycle (started, completed, muted, unmuted)\n- agent.*: Agent lifecycle (started, stuck, stopped, dead)\n- gate.*: Gate events (resolved, escalated, expired)\n- merge.*: Merge events (approved, rejected, merged)\n\n**Go Implementation**\nType definition (internal/types/types.go):\n- IssueType = TypeEvent (line 494)\n- Fields (lines 120-124):\n  - EventKind string: Namespaced event type\n  - Actor string: Entity URI who caused this\n  - Target string: Entity URI or bead ID affected\n  - Payload string: Event-specific JSON data\n\nEvent creation pattern:\n```go\nevent := &types.Issue{\n    IssueType:  types.TypeEvent,\n    Title:      fmt.Sprintf(\"%s: %s\", eventKind, summary),\n    EventKind:  eventKind,\n    Actor:      actorURI,\n    Target:     targetBeadID,\n    Payload:    payloadJSON,\n}\nstore.CreateIssue(ctx, event, actor)\n```\n\nEvent querying:\n- bd list --type event --filter event_kind=patrol.started\n- Filter by actor, target, time range\n- Reconstruct event timelines\n\nImmutability:\n- Events should never be updated after creation\n- Enforce via code convention (no UpdateEvent calls)\n- Consider: Hard validation that prevents event updates\n\n**Design for Rust**\nData model (src/core/):\n```rust\npub struct EventData {\n    event_kind: String,      // Namespaced type (patrol.started)\n    actor: String,           // Entity URI or bead ID\n    target: Option<String>,  // Entity URI or bead ID\n    payload: Option<String>, // JSON blob\n}\n```\n\nAdd to Bead or use optional fields.\n\nEvent creation (src/daemon/ or src/api/):\n```rust\npub fn create_event(\n    event_kind: &str,\n    actor: &str,\n    target: Option<&str>,\n    payload: Option<serde_json::Value>,\n) -> Result<Bead, Error>;\n```\n\nImmutability enforcement:\n- Mark event beads as immutable in type system\n- Return error if update attempted on event type\n- Consider: Separate EventBead enum variant with no update methods\n\nCLI (src/cli/):\n- bd create --type event --event-kind <kind> --actor <uri> --target <id> [--payload <json>]\n- bd list --type event [--filter event_kind=<kind>]\n- bd show <event-id> (display structured event data)\n\n**Design Notes**\n- Events are write-once, read-many (WORM)\n- Event payload should be structured (JSON) for querying\n- Namespaced event kinds enable categorization and filtering\n- Consider: Event aggregation for metrics (count events by kind)\n- Consider: Event streaming/notification (pubsub for new events)\n- Consider: Event retention policy (old events can be archived)\n- Consider: Event schema validation (enforce payload structure per kind)\n\n**Acceptance**\n- [ ] Event type constant defined\n- [ ] EventData struct with event_kind, actor, target, payload\n- [ ] create_event helper function\n- [ ] bd create --type event works\n- [ ] Event fields populate correctly\n- [ ] bd list --type event shows events\n- [ ] bd show <event-id> displays structured event\n- [ ] Immutability enforced (update returns error for events)\n- [ ] Tests for event creation\n- [ ] Tests for event immutability\n- [ ] Migration from Go beads preserves event type and fields\n\n**Files to study in Go beads:**\n- tmp/beads/internal/types/types.go (lines 120-124: event fields, line 494: TypeEvent)\n- tmp/beads/cmd/bd/create.go (event creation examples, if any)\n- tmp/beads/internal/storage/sqlite/schema.go (lines 50-54: event columns)","id":"bd-ze0x.49","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":2052653861025408883,"replica":"808c9050-11e9-66b2-8da2-e9214f3d4cfd"}]}},"priority":2,"status":"open","title":"Add Event issue type support","type":"feature"}
