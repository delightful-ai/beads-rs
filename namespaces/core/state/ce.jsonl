{"_at":[1768206011449,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Daemon state keyed by StoreId; remote URL only used for legacy git lane mapping.\n- [ ] Store discovery order matches plan and is covered by tests or structured logs.\n- [ ] Existing commands still resolve a store from repo path (compat) without behavior regression.","assignee":"darin@darinsmacstudio.lan","created_at":[1768177801439,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nPhase 3: introduce StoreRuntime and move daemon identity from RemoteUrl to StoreId (hybrid mapping). Today `Daemon` is keyed by `RemoteUrl` and uses `path_to_remote` in `src/daemon/core.rs`, which blocks per store WAL and replication.\n\n**Context**\n- REALTIME_PLAN.md §0.1 (StoreId as correctness identity) and §7.1-7.4 (StoreRuntime + discovery order)\n- Migration fallback UUIDv5(normalized_remote_url) in §0.16\n**Files:** src/daemon/core.rs, src/daemon/remote.rs, src/daemon/repo.rs, src/paths.rs, src/daemon/store_runtime.rs (new)","design":"**Design**\n- Add `StoreRuntime` struct (initially minimal fields: meta, policies, state, watermarks, wal handle) in `src/daemon/store_runtime.rs`.\n- Change `Daemon` maps to `BTreeMap<StoreId, StoreRuntime>` plus `path_to_store_id` and `remote_to_store_id` caches.\n- Implement store identity discovery order: local store meta.json, refs/beads/meta store_meta.json, refs/beads/<store_id> listing, UUIDv5(normalized_remote_url) fallback for migration only.\n- Keep RemoteUrl mapping for legacy git sync, but do not key correctness on it.","id":"bd-3m5.8","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Phase 3: StoreRuntime + StoreId identity mapping","type":"task"}
{"_at":[1768253578193,0],"_by":"darin@darinsmcstudio2.lan","closed_reason":"duplicate stub - no description","created_at":[1768245268042,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-ay2","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Crash recovery","type":"task"}
{"_at":[1769222402180,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Labels::remove no longer returns a misleading unconditional true.\\n- [ ] Call sites updated to the chosen API.","assignee":"darin@book","created_at":[1769210188658,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\\nLabels::remove returns true unconditionally, which can hide bugs at call sites and mislead tests.\\n\\n**Files**: src/core/collections.rs","design":"**Design**\\nEither return a real changed flag (before_len != after_len) or change the API to return () and update call sites. Pick whichever matches usage patterns best.","id":"bd-qz97.22","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Cleanup: Labels::remove return value should reflect change","type":"chore"}
{"_at":[1769584529017,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] IPC update patch cannot encode `Closed` (compile‑time enforced).\n- [ ] Closing a bead is only possible via the `Close` IPC operation with explicit reason/branch data.\n- [ ] Attempts to send `status=closed` in Update payload fail at decode time.\n- [ ] Tests cover Update payload rejecting closed status and Close op still working.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769501256172,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nThe IPC update patch schema allows setting `status=Closed` via `BeadPatch.status`, without requiring `closed_reason`/`closed_on_branch`. This violates the workflow invariant (closed must carry closure data), and relies on downstream runtime validation to reject invalid updates.\n\nKey refs:\n- `crates/beads-surface/src/ops.rs:82` — `BeadPatch.status: Patch<WorkflowStatus>`.\n- `crates/beads-surface/src/ipc/payload.rs:51` — Update payload uses `BeadPatch`.\n\n**Impact**\nIPC schema can represent illegal states; compiler can’t prevent accidental Close‑via‑Update.","design":"**Design (opinionated)**\nMake “Close” a dedicated operation only; updates must not encode the Closed state.\n\nOptions:\n- Replace `BeadPatch.status: Patch<WorkflowStatus>` with `Patch<OpenInProgress>` where:\n```rust\nenum OpenInProgress { Open, InProgress }\n```\n- Alternatively, remove `status` from `BeadPatch` entirely and require `Close`/`Reopen` IPC ops for status transitions.\n\nThis forces correct closure semantics and makes illegal updates unrepresentable at the schema level.","id":"bd-v1xr","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1769583969449,0],"author":"darin@darins-Mac-Studio-2.local","content":"Constraint: keep rendering logic in the command files themselves; do not move rendering out of command files.","id":"go-comment-bd-v1xr-1"},{"at":[1769584529017,0],"author":"darin@darinsmcstudio2.lan","content":"Constraint: keep rendering logic in the command files themselves; do not move rendering out of command files.","id":"legacy-notes"}],"priority":2,"status":"closed","title":"IPC update patch must not allow Closed status","type":"bug"}
