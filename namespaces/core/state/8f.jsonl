{"_at":[1768510077718,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768503254251,1],"darin@book"],"claim":[[1768508467913,1],"darin@book"],"description":[[1768503254251,1],"darin@book"],"design":[[1768503254251,1],"darin@book"],"estimated_minutes":[[1768503254251,1],"darin@book"],"external_ref":[[1768503254251,1],"darin@book"],"labels":[[1768503254251,1],"darin@book"],"priority":[[1768503254251,1],"darin@book"],"source_repo":[[1768503254251,1],"darin@book"],"title":[[1768503254251,1],"darin@book"],"type":[[1768503254251,1],"darin@book"]},"acceptance_criteria":"- [ ] Replication protocol code uses `Seq0`-typed watermark values internally.\n- [ ] Encode/decode preserves the existing on-wire format.\n- [ ] All conversions from raw `u64` removed from session/peer_acks paths.","assignee":"darin@book","assignee_at":[1768508467913,1],"assignee_expires":1768512067913,"closed_at":[1768510077718,1],"closed_by":"darin@book","created_at":[1768503254251,1],"created_by":"darin@book","description":"**Problem**\nReplication protocol types (`WatermarkMap`, `Want`, `Ack`) use raw `u64` sequence numbers in `src/daemon/repl/proto.rs`. Multiple layers then convert these to `Seq0`/`Watermark`, which is easy to misuse and obscures invariants.\n\n**Files**\n- src/daemon/repl/proto.rs\n- src/daemon/repl/session.rs\n- src/daemon/repl/peer_acks.rs\n- src/daemon/repl/runtime.rs\n- src/daemon/repl/want.rs","design":"Introduce a typed wire map (e.g., `WireSeq0` or `WireWatermarkMap`) that stores `Seq0` in memory and encodes/decodes as `u64` on the wire. Replace `WatermarkMap` aliases with the typed version across replication logic, and update CBOR encoding/decoding accordingly. This keeps all internal code on `Seq0`/`Watermark` while preserving the protocol format.","id":"bd-4f5","labels":[],"priority":2,"status":"closed","title":"Replication watermarks should use Seq0 typed values","type":"chore"}
