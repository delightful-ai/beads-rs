{"_at":[1770499794432,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Patch validation API signature finalized\n- [ ] Offline fsck API signature finalized\n- [ ] Offline lock API signature finalized","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770498231067,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nSome CLI paths require daemon internals because boundary APIs do not exist yet.","design":"Specify typed API signatures for patch validation and offline fsck/lock operations using `beads-api` output types.","id":"bd-21eg.4","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Define migration matrix for missing boundary APIs (patch/fsck/lock)","type":"task"}
{"_at":[1768622449305,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622449305,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nGo beads supports waits-for dependencies for dynamic fanout gates. B waits for spawner A's dynamically-bonded children to complete. This enables molecule bonding patterns where a step waits for all parallel work spawned by a previous step. beads-rs needs this.\n\n**How it works in Go beads**\n- Dependency type: `DepWaitsFor` (in internal/types/types.go)\n- Gate types: \"all-children\" (wait for all) or \"any-children\" (wait for first)\n- Metadata field `WaitsForMeta` stores gate type and optional spawner ID\n- Affects blocked cache calculation (internal/storage/sqlite/blocked_cache.go)\n- B is blocked until condition met based on gate type\n- SpawnerID identifies which step spawns the children to wait for\n  * If empty, waits for all direct children of depends_on_id\n\n**Gate semantics**\n- all-children (default): blocked while ANY child is not closed\n- any-children: blocked until ANY child is closed (first completion unblocks)\n\n**Design for Rust**\n1. Add `WaitsFor` variant to `DepKind` enum in src/core/domain.rs\n2. Mark it as DAG-enforcing (affects ready work calculation)\n3. Define WaitsForMeta structure for JSON metadata:\n   - gate: \"all-children\" | \"any-children\"\n   - spawner_id: optional BeadId\n4. Update blocked cache logic to handle waits-for:\n   - Query children of spawner\n   - Check gate condition (all vs any)\n   - Mark as blocked if condition not met\n5. Add CLI support for creating waits-for deps with metadata\n6. Add JSON serialization for metadata field\n\n**Design considerations**\n- Metadata storage: use DepEdge metadata field or separate structure?\n- Default gate type: \"all-children\" (matches Go)\n- Should we validate spawner_id exists?\n- How to query \"what is B waiting for\"? (show spawner + children)\n- Performance: waits-for gates require recursive child queries\n\n**Design questions for human review**\n- Should waits-for support timeout/deadline metadata?\n- Should we allow custom gate predicates beyond all/any?\n- How to handle orphaned waits-for (spawner deleted)?\n- Should gate type be extensible (enum vs string)?\n\n**Files to study**\n- tmp/beads/internal/types/types.go - WaitsForMeta, DepWaitsFor\n- tmp/beads/internal/storage/sqlite/blocked_cache.go - lines 182-216 (waits-for logic)\n- src/core/dep.rs - dependency edge structure\n- src/daemon/ops/blocked.rs - blocked work calculation (if exists)\n\n**Acceptance**\n- [ ] WaitsFor added to DepKind enum\n- [ ] WaitsForMeta structure defined and serializable\n- [ ] Blocked cache updated to handle waits-for gates\n- [ ] all-children gate blocks until all children closed\n- [ ] any-children gate blocks until first child closes\n- [ ] CLI can create waits-for deps with gate metadata\n- [ ] Cargo fmt, clippy, test pass","id":"bd-ze0x.21","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":14212175201581814820,"replica":"3aa0ea12-248f-77cf-4a78-ef21a8c909b8"}]}},"priority":2,"status":"open","title":"Add waits-for dependency type for dynamic fanout gates","type":"feature"}
