{"_at":[1768475322370,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768454400799,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nREALTIME_PLAN §6.1/§6.2 calls for a store‑local `index_durability_mode = cache | durable` setting. The code always opens `SqliteWalIndex` with `IndexDurabilityMode::Cache` (e.g., `StoreRuntime::open`, fsck/rebuild helpers). There is no config knob or store‑local setting.\n\n**Design**\n- Add a store‑local setting (namespaces.toml or a new `store_config.toml`) or config‑layer override to choose `cache` vs `durable`.\n- Thread the setting into `SqliteWalIndex::open` calls, including rebuild/fsck paths.\n\n**Acceptance**\n- [ ] Index durability mode is configurable and persisted per store.\n- [ ] All index open paths respect the configured mode.\n- [ ] Tests cover both modes.\n\n**Files:** src/daemon/store_runtime.rs, src/daemon/wal/index.rs, src/daemon/wal/fsck.rs, src/config.rs (or new config module)","id":"bd-3m5.104","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"WalIndex durability mode is hardcoded to cache","type":"bug"}
{"_at":[1769582365342,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] `RecordHeader` cannot represent “request_sha256 without client_request_id”.\n- [ ] Encoding/decoding logic uses the new sum type and no longer needs runtime combo checks.\n- [ ] All callers updated; tests added for each `RequestProof` variant.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769494178609,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`RecordHeader` allows invalid combinations (e.g., `request_sha256` present without `client_request_id`), and this is enforced by runtime checks in encode/decode. That means invalid headers are representable in the type system, violating the “types tell the truth” principle.\n\nKey references:\n- `crates/beads-rs/src/daemon/wal/record.rs:65` — `RecordHeader` fields allow invalid combinations.\n- `crates/beads-rs/src/daemon/wal/record.rs:103` — runtime validation in `encode`.\n\nSeverity: integrity checks are scattered across encode/decode paths; misuse can create invalid headers before validation.","design":"**Design**\nIntroduce a dedicated request‑proof sum type and make it the only representation.\n\n- `enum RequestProof { None, Client { client_request_id: ClientRequestId, request_sha256: [u8;32] }, ClientNoHash { client_request_id: ClientRequestId } }`.\n- `RecordHeader` stores a single `request_proof: RequestProof` rather than two optional fields.\n- Encoding/decoding handles the different cases explicitly; invalid combinations become unrepresentable.\n\nMigration:\n- Add conversion helpers to maintain wire format compatibility.\n- Update all call sites constructing `RecordHeader`.","id":"bd-42hq","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Encode WAL request proof as sum type in RecordHeader","type":"bug"}
