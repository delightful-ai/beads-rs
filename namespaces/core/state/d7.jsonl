{"_at":[1768524029898,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768503848137,1],"darin@book"],"claim":[[1768522424071,1],"darin@book"],"description":[[1768503848137,1],"darin@book"],"design":[[1768503848137,1],"darin@book"],"estimated_minutes":[[1768503848137,1],"darin@book"],"external_ref":[[1768503848137,1],"darin@book"],"labels":[[1768503848137,1],"darin@book"],"priority":[[1768503848137,1],"darin@book"],"source_repo":[[1768503848137,1],"darin@book"],"title":[[1768503848137,1],"darin@book"],"type":[[1768503848137,1],"darin@book"]},"acceptance_criteria":"- [ ] Replication core logic no longer returns ErrorPayload directly.\n- [ ] Boundary adapters produce ErrorPayload from ReplError.\n- [ ] Tests cover ReplError -> ErrorPayload mapping.","assignee":"darin@book","assignee_at":[1768522424071,1],"assignee_expires":1768526024071,"closed_at":[1768524029898,1],"closed_by":"darin@book","created_at":[1768503848137,1],"created_by":"darin@book","description":"**Problem**\nReplication internals use ErrorPayload as their primary error type (SessionResult = Result<T, Box<ErrorPayload>> in repl/session.rs, and ReplSessionStore/ingest paths). This pushes boundary formatting into core logic, loses structured error intent, and conflicts with error_design guidance (use domain errors internally, map at boundaries).\n\n**Files:** src/daemon/repl/session.rs, src/daemon/repl/runtime.rs, src/daemon/repl/manager.rs, src/daemon/repl/server.rs","design":"**Design**\n- Introduce a ReplError enum capturing internal error cases with structured fields.\n- Convert ReplError -> ErrorPayload only at the protocol boundary (SessionAction::Close / outbound ERROR frames, IPC responses).\n- Update SessionStore trait and ReplIngestRequest to use ReplError instead of Box<ErrorPayload>.\n- Add conversion tests to ensure payload formatting stays stable.","id":"bd-2oms","labels":[],"priority":2,"status":"closed","title":"Use typed internal errors in replication (avoid ErrorPayload in core logic)","type":"chore"}
{"_at":[1768183528235,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768180116695,1],"darin@darinsmacstudio.lan"],"claim":[[1768183232171,1],"darin@darinsmacstudio.lan"],"description":[[1768180116695,1],"darin@darinsmacstudio.lan"],"design":[[1768180116695,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768177719868,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768177719868,1],"darin@darinsmacstudio.lan"],"labels":[[1768177719868,1],"darin@darinsmacstudio.lan"],"priority":[[1768177719868,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768177719868,1],"darin@darinsmacstudio.lan"],"title":[[1768177719868,1],"darin@darinsmacstudio.lan"],"type":[[1768177719868,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] NamespaceId validation tests cover valid and invalid inputs.\n- [ ] StoreState can create and return the default core namespace without side effects.\n- [ ] NamespacePolicy defaults match the plan.\n- [ ] No daemon behavior change yet; this is core types only.","assignee":"darin@darinsmacstudio.lan","assignee_at":[1768183232171,1],"assignee_expires":1768186832171,"closed_at":[1768183528235,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768177719868,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nThe core state is currently single namespace. Namespace boundaries are implicit (\"core\") and there is no NamespaceId or namespace policy type, which makes cross namespace bugs easy and prevents typestate around per namespace invariants.\n\n**Context**\n- REALTIME_PLAN.md 0.3 (StoreState choice), 0.4 (namespace policy representation), 2.2 (Namespaces)\n- Stateright model: beads_stateright_models/src/realtime_types_sketch.rs (section 3 Namespaces)\n\n**Files:** src/core/namespace.rs (new), src/core/store_state.rs (new) or src/core/state.rs, src/core/mod.rs, src/lib.rs, src/config.rs (policy parsing hook)","design":"**Design**\n- Add NamespaceId newtype with validation [a-z][a-z0-9_]{0,31}, matching the stateright model; include as_str and display.\n- Add NamespacePolicy and CheckpointGroup structs with the fields and defaults from REALTIME_PLAN.md 2.2.\n- Introduce StoreState as BTreeMap<NamespaceId, CanonicalState> with helpers: get, get_mut, ensure_namespace, and a constant default NamespaceId::core().\n- Ensure callers must select a namespace before accessing a CanonicalState (no implicit global operations), so cross namespace operations require explicit opt in.\n- Re-export NamespaceId, NamespacePolicy, CheckpointGroup, StoreState in src/core/mod.rs and src/lib.rs.","id":"bd-3m5.2","labels":[],"priority":2,"status":"closed","title":"Phase 1: Namespaces + StoreState","type":"task"}
{"_at":[1768375342617,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768178842509,1],"darin@darinsmacstudio.lan"],"claim":[[1768374581631,1],"darin@book"],"description":[[1768195893430,1],"darin@darinsmacstudio.lan"],"design":[[1768178842509,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768178842509,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768178842509,1],"darin@darinsmacstudio.lan"],"labels":[[1768178842509,1],"darin@darinsmacstudio.lan"],"priority":[[1768178842509,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768178842509,1],"darin@darinsmacstudio.lan"],"title":[[1768185435229,1],"darin@darinsmacstudio.lan"],"type":[[1768178842509,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@book","assignee_at":[1768374581631,1],"assignee_expires":1768378181631,"closed_at":[1768375342617,1],"closed_by":"darin@book","created_at":[1768178842509,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nExisting users have data in refs/heads/beads/store. Must import into new checkpoint format.\n\n**Context**\n- REALTIME_PLAN.md ยง17.2 (legacy Git ref), ยง17.3 (identity migration)\n\n**Design**\n- On store open: check for refs/heads/beads/store\n- Import into StoreState[\"core\"] namespace using legacy wire format\n- Leave checkpoint export to the scheduler (refs/beads/<store_id>/<group>) in bd-3m5.22\n- Mirror legacy ref for one release if needed\n- Keep legacy wire format reader for migration only\n\n**Acceptance**\n- [ ] Migration imports refs/heads/beads/store into StoreState[\"core\"].\n- [ ] Legacy ref is treated as read-only during migration.\n- [ ] Identity persisted locally (URL changes don't break it).\n- [ ] Tests verify legacy import\n\n**Files:** src/git/sync.rs, src/git/wire.rs, src/daemon/migration.rs, src/git/checkpoint/import.rs","id":"bd-3m5.39","labels":[],"priority":2,"status":"closed","title":"Phase 6: Legacy Git ref migration import","type":"task"}
