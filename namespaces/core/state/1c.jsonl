{"_at":[1768373474494,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768195801789,1],"darin@darinsmacstudio.lan"],"claim":[[1768371778919,1],"darin@book"],"description":[[1768180604890,1],"darin@darinsmacstudio.lan"],"design":[[1768180604890,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768178745980,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768178745980,1],"darin@darinsmacstudio.lan"],"labels":[[1768178745980,1],"darin@darinsmacstudio.lan"],"priority":[[1768178745980,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768178745980,1],"darin@darinsmacstudio.lan"],"title":[[1768185407010,1],"darin@darinsmacstudio.lan"],"type":[[1768178745980,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] Snapshot captures included watermarks and shard contents from a single coordinator tick.\n- [ ] Snapshot object is immutable once created and safe to pass to worker thread.\n- [ ] Export worker consumes only snapshot data (no live reads during I/O).\n- [ ] Snapshot includes metadata needed for manifest/meta construction without touching live state.","assignee":"darin@book","assignee_at":[1768371778919,1],"assignee_expires":1768375378919,"closed_at":[1768373474494,1],"closed_by":"darin@book","created_at":[1768178745980,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nCheckpoint export requires a snapshot barrier that freezes the state and included watermarks together. Without a typed barrier, the coordinator can accidentally mix shards from different logical times or claim watermarks that aren’t represented in the exported content.\n\n**Context**\n- REALTIME_PLAN.md §13.8 (checkpoint snapshot barrier and consistency rule)\n- Checkpoint scheduling in §13.7 and export workflow in §13.8\n\n**Files:** src/git/checkpoint/types.rs (new), src/git/checkpoint/export.rs, src/daemon/store_runtime.rs","design":"**Design**\n- Introduce an immutable CheckpointSnapshot struct: { group_id, policy_hash, roster_hash, included_watermarks (durable), included_heads?, shard_payloads/dirty_shards, created_at_ms }.\n- The coordinator thread captures the snapshot under a single lock so shard contents and watermarks correspond to the same logical point in time.\n- Make the snapshot owned/immutable (e.g., Arc or owned values), so the worker thread cannot observe concurrent mutations.\n- Enforce a check: included_watermarks must not exceed the max seq represented by shard_payloads; if it would, delay snapshot or recompute.","id":"bd-3m5.30","labels":[],"priority":2,"status":"closed","title":"Phase 6: CheckpointSnapshot barrier type","type":"task"}
