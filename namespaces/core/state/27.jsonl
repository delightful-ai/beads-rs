{"_at":[1768348878056,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768271736943,1],"darin@darinsmacstudio.lan"],"claim":[[1768347895105,1],"darin@book"],"description":[[1768271736943,1],"darin@darinsmacstudio.lan"],"design":[[1768271736943,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768271736943,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768271736943,1],"darin@darinsmacstudio.lan"],"labels":[[1768271736943,1],"darin@darinsmacstudio.lan"],"priority":[[1768271736943,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768271736943,1],"darin@darinsmacstudio.lan"],"title":[[1768271736943,1],"darin@darinsmacstudio.lan"],"type":[[1768271736943,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@book","assignee_at":[1768347895105,1],"assignee_expires":1768351495105,"closed_at":[1768348878056,1],"closed_by":"darin@book","created_at":[1768271736943,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nMutation planning generates a fresh txn_id per retry via the current write stamp. There is no visible fast-path to reuse existing txn/event ids for repeated client_request_id, which breaks idempotent retry semantics in REALTIME_PLAN.md.\n\n**Where**\n- src/daemon/mutation_engine.rs: MutationEngine::plan uses txn_id_for_stamp(&store, &write_stamp)\n- src/daemon/wal/index.rs: WalIndexReader::lookup_client_request exists but is not used in planning path\n\n**Design**\n- Before planning a mutation, lookup client_request_id in the WAL index.\n- If found with matching request_sha256, return a plan that reuses the stored txn_id/event_ids and short-circuits event creation.\n- If not found, proceed with normal planning and insert mapping.\n\n**Acceptance**\n- Retrying the same request returns the same txn/event ids (idempotent).\n- No duplicate txn rows for repeated client_request_id.\n- Coverage in Phase 4 idempotency tests (bd-3m5.60) updated.\n\n**Files**\n- src/daemon/mutation_engine.rs\n- src/daemon/wal/index.rs","id":"bd-3m5.69","labels":[],"priority":1,"status":"closed","title":"Idempotent retries reuse WAL index mapping","type":"bug"}
