{"_at":[1768348878056,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768271736943,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nMutation planning generates a fresh txn_id per retry via the current write stamp. There is no visible fast-path to reuse existing txn/event ids for repeated client_request_id, which breaks idempotent retry semantics in REALTIME_PLAN.md.\n\n**Where**\n- src/daemon/mutation_engine.rs: MutationEngine::plan uses txn_id_for_stamp(&store, &write_stamp)\n- src/daemon/wal/index.rs: WalIndexReader::lookup_client_request exists but is not used in planning path\n\n**Design**\n- Before planning a mutation, lookup client_request_id in the WAL index.\n- If found with matching request_sha256, return a plan that reuses the stored txn_id/event_ids and short-circuits event creation.\n- If not found, proceed with normal planning and insert mapping.\n\n**Acceptance**\n- Retrying the same request returns the same txn/event ids (idempotent).\n- No duplicate txn rows for repeated client_request_id.\n- Coverage in Phase 4 idempotency tests (bd-3m5.60) updated.\n\n**Files**\n- src/daemon/mutation_engine.rs\n- src/daemon/wal/index.rs","id":"bd-3m5.69","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Idempotent retries reuse WAL index mapping","type":"bug"}
{"_at":[1769225042433,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Test: legacy WAL sample either deserializes correctly (compat path) or fails with explicit wipe guidance (non-compat path).\\n- [ ] Test: current WalEntry still roundtrips.","assignee":"darin@book","created_at":[1769209801215,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\\nRecent WAL snapshots may not deserialize after WalDepStore format change. The current untagged enum will fail without a clear remediation path.\\n\\n**Files**: src/daemon/wal_legacy_snapshot.rs","design":"**Design**\\nPick and implement one strategy:\\nA) Add a transitional legacy variant that can parse the previous DepStore-shaped WAL JSON and convert to DepStore.\\nB) If backward compatibility is explicitly unsupported, detect the shape and return a clear error instructing users to delete old WAL files.\\n\\nInclude tests for the chosen strategy using a handcrafted JSON sample of the prior format (or a simulated struct) to ensure behavior stays locked.","id":"bd-qz97.10","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"WAL snapshot format transition: decide compat vs explicit failure","type":"task"}
