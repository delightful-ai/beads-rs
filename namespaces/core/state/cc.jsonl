{"_at":[1768362718810,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768260929390,1],"darin@darinsmacstudio.lan"],"claim":[[1768359242638,1],"darin@book"],"description":[[1768260939082,1],"darin@darinsmacstudio.lan"],"design":[[1768260929390,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768177897263,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768177897263,1],"darin@darinsmacstudio.lan"],"labels":[[1768177897263,1],"darin@darinsmacstudio.lan"],"priority":[[1768261544066,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768177897263,1],"darin@darinsmacstudio.lan"],"title":[[1768260929390,1],"darin@darinsmacstudio.lan"],"type":[[1768177897263,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] Daemon startup wires replication server + manager and registers channels to the coordinator.\n- [ ] Inbound replication events reach the coordinator through bounded queues and produce ACKs.\n- [ ] Outbound sessions receive events via broadcaster or WAL range fallback.\n- [ ] Overload path rejects replication ingest (no unbounded buffering).","assignee":"darin@book","assignee_at":[1768359242638,1],"assignee_expires":1768362842638,"closed_at":[1768362718810,1],"closed_by":"darin@book","created_at":[1768177897263,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nThis bead is now the integration glue for replication runtime. Sessions/manager/server are split into separate beads; we need to wire them into the daemon coordinator with bounded channels, correct defaults, and backpressure so replication traffic is serialized safely.\n\n**Context**\n- REALTIME_PLAN.md sections 7.5, 9.1-9.8, 7.2 (store runtime wiring)\n- Split beads: bd-3m5.46 (session), bd-3m5.47 (manager), bd-3m5.48 (server)\n**Files:** src/daemon/repl/mod.rs, src/daemon/core.rs, src/daemon/run.rs\n\n","design":"**Design**\n- Add a repl module root to share wiring/config between session/manager/server.\n- On daemon startup, spawn replication server + manager threads and register bounded channels into the coordinator.\n- Route inbound replication ingest through the coordinator (WAL append + apply) and produce ACKs via session channel.\n- Route outbound fanout from EventBroadcaster (with WAL fallback) and enforce AdmissionController limits at ingress.\n\n","id":"bd-3m5.17","labels":[],"priority":1,"status":"closed","title":"Phase 5: Replication runtime integration","type":"task"}
{"_at":[1768387640756,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768178867760,1],"darin@darinsmacstudio.lan"],"claim":[[1768383928777,1],"darin@book"],"description":[[1768178867760,1],"darin@darinsmacstudio.lan"],"design":[[1768178867760,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768178867760,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768178867760,1],"darin@darinsmacstudio.lan"],"labels":[[1768178867760,1],"darin@darinsmacstudio.lan"],"priority":[[1768178867760,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768178867760,1],"darin@darinsmacstudio.lan"],"title":[[1768185436572,1],"darin@darinsmacstudio.lan"],"type":[[1768178867760,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@book","assignee_at":[1768383928777,1],"assignee_expires":1768387528777,"closed_at":[1768387640756,1],"closed_by":"darin@book","created_at":[1768178867760,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nDaemon must shut down gracefully without losing durable events. Operators need tracing and metrics.\n\n**Context**\n- REALTIME_PLAN.md §16.1 (graceful shutdown, observability requirements)\n\n**Design**\n- On SIGTERM: stop accepting mutations, drain in-flight durability waits (bounded), flush WAL, close segments, exit\n- Every mutation traceable via txn_id and client_request_id\n- Replication sessions log peer identity and namespace authorization\n- Emit counters: wal_append_ok/err, wal_fsync_ok/err, apply_ok/err, repl_events_in/out, checkpoint_export_ok/err\n- Emit gauges: IPC inflight, repl queue depth, per-peer lag\n- Emit histograms: wal_append_duration, wal_fsync_duration, apply_duration, checkpoint_duration\n\n**Acceptance**\n- [ ] SIGTERM triggers graceful drain and flush\n- [ ] Metrics emitted via tracing or metrics crate\n- [ ] Tests verify no event loss on shutdown\n- [ ] Tests verify metric emission\n\n**Files:** src/daemon/core.rs, src/daemon/metrics.rs (new), Cargo.toml (tracing/metrics)","id":"bd-3m5.40","labels":[],"priority":2,"status":"closed","title":"Phase 4: Graceful shutdown + observability metrics","type":"task"}
{"_at":[1767992854703,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1767985331288,1],"darin@darinsmacstudio.lan"],"claim":[[1767992703086,1],"darin@darinsmacstudio.lan"],"description":[[1767985331288,1],"darin@darinsmacstudio.lan"],"design":[[1767985331288,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1767985331288,1],"darin@darinsmacstudio.lan"],"external_ref":[[1767985331288,1],"darin@darinsmacstudio.lan"],"labels":[[1767985331288,1],"darin@darinsmacstudio.lan"],"priority":[[1767985331288,1],"darin@darinsmacstudio.lan"],"source_repo":[[1767985331288,1],"darin@darinsmacstudio.lan"],"title":[[1767985331288,1],"darin@darinsmacstudio.lan"],"type":[[1767985331288,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] identity_handshake model is extended or a new cross-lane model added (e.g., beads_stateright_models/examples/identity_epoch_machine.rs)\n- [ ] Properties cover: no cross-store merge, no cross-epoch merge, and consistent rejection across replication/checkpoint/WAL paths (todo.md Model #6)\n- [ ] Model doc comments reference REALTIME_PLAN.md §0.1, §2.1, §9.3, and §9.10\n- [ ] Example runs via cargo run --example identity_epoch_machine (or equivalent)","assignee":"darin@darinsmacstudio.lan","assignee_at":[1767992703086,1],"assignee_expires":1767996303086,"closed_at":[1767992854703,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1767985331288,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nIdentity and epoch mismatch rules must be enforced consistently across replication, checkpoint import, and WAL header validation (REALTIME_PLAN.md §0.1, §2.1, §9.3, §9.10). The current identity_handshake model only covers the replication handshake path.\n\n**Design Notes**\nWe need one model or a paired model set that proves the same guardrails apply in all lanes.","design":"**Design**\nExtend or add a Stateright model that covers store_id and store_epoch gating across: (1) replication HELLO/WELCOME, (2) checkpoint import, and (3) WAL segment header validation. Model mismatches and assert hard-close or reject semantics in all lanes (Plan §9.10 error handling).\n\nReuse or build on beads_stateright_models/examples/identity_handshake.rs, but add explicit actions for checkpoint import and WAL header accept/reject. Ensure the same validation function is referenced in comments to map to the plan.","id":"bd-hjm.6","labels":["modeling","realtime","stateright"],"priority":2,"status":"closed","title":"Stateright: store identity + epoch guardrails across lanes","type":"feature"}
{"_at":[1767999215864,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1765744960969,0],"darin@book"],"claim":[[1767998883490,1],"darin@darinsmacstudio.lan"],"description":[[1765744960969,0],"darin@book"],"design":[[1765744960969,0],"darin@book"],"estimated_minutes":[[1765744960969,0],"darin@book"],"external_ref":[[1765744960969,0],"darin@book"],"labels":[[1765744960969,0],"darin@book"],"priority":[[1765744960969,0],"darin@book"],"source_repo":[[1765744960969,0],"darin@book"],"title":[[1765744960969,0],"darin@book"],"type":[[1765744960969,0],"darin@book"]},"assignee":"darin@darinsmacstudio.lan","assignee_at":[1767998883490,1],"assignee_expires":1768002483490,"closed_at":[1767999215864,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1765744960969,0],"created_by":"darin@book","description":"**Problem**\n`git/wire.rs` repeatedly does `String::from_utf8(bytes.to_vec())` for blobs. Avoidable copy.\n\n**Design**\nUse `std::str::from_utf8(bytes)?` and parse from the slice, or stream JSONL via `serde_json::Deserializer`.\n\nNot a moral issue, just free perf + less churn.\n\n**Acceptance**\n- [ ] No unnecessary `.to_vec()` in blob parsing\n- [ ] Benchmark shows improvement (or at least no regression)\n\n**Files:** src/git/wire.rs","id":"bd-oe8","labels":[],"priority":3,"status":"closed","title":"Wire parsing does extra allocations","type":"chore"}
{"_at":[1765786005799,0],"_by":"darin@dusk","_v":{"acceptance_criteria":[[1765744322054,0],"darin@book"],"claim":[[1765785832059,0],"darin@dusk"],"description":[[1765744322054,0],"darin@book"],"design":[[1765744322054,0],"darin@book"],"estimated_minutes":[[1765744322054,0],"darin@book"],"external_ref":[[1765744322054,0],"darin@book"],"labels":[[1765744322054,0],"darin@book"],"priority":[[1765744322054,0],"darin@book"],"source_repo":[[1765744322054,0],"darin@book"],"title":[[1765744322054,0],"darin@book"],"type":[[1765744322054,0],"darin@book"]},"assignee":"darin@dusk","assignee_at":[1765785832059,0],"assignee_expires":1765789432059,"closed_at":[1765786005799,0],"closed_by":"darin@dusk","closed_reason":"Added serde boundary validation via try_from/into for BeadId, ActorId, NoteId, and Priority. Invalid values now fail at deserialization rather than scattered through handlers. Added 6 tests for the new validation behavior.","created_at":[1765744322054,0],"created_by":"darin@book","description":"Use `#[serde(try_from, into)]` to validate at deserialization boundary instead of scattered runtime checks.\n\n**Problem:** These types use `#[serde(transparent)]` which accepts any value, then validation happens later in handlers.\n\n**Solution:** Follow the `BranchName` pattern (identity.rs:363-416):\n```rust\n#[serde(try_from = \"String\", into = \"String\")]\npub struct BeadId(String);\n\nimpl TryFrom<String> for BeadId {\n    type Error = CoreError;\n    fn try_from(s: String) -> Result<Self, Self::Error> {\n        Self::parse(&s)\n    }\n}\n\nimpl From<BeadId> for String {\n    fn from(id: BeadId) -> String { id.0 }\n}\n```\n\nApply to: BeadId, ActorId, NoteId, Priority (use `try_from = \"u8\"` for Priority).\n\n**Impact:** Invalid IDs fail at deserialization rather than scattered through handlers. Request types can use `BeadId` directly instead of `String`.\n\n**Files:** src/core/identity.rs, src/core/domain.rs","id":"bd-y8x","labels":[],"priority":2,"status":"closed","title":"Add serde boundary validation for identity types (BeadId, ActorId, NoteId, Priority)","type":"chore"}
