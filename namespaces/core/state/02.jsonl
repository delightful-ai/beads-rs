{"_at":[1768454809145,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768449027537,1],"darin@book"],"claim":[[1768449027537,1],"darin@book"],"description":[[1768449027537,1],"darin@book"],"design":[[1768449027537,1],"darin@book"],"estimated_minutes":[[1768449027537,1],"darin@book"],"external_ref":[[1768449027537,1],"darin@book"],"labels":[[1768449027537,1],"darin@book"],"priority":[[1768449027537,1],"darin@book"],"source_repo":[[1768449027537,1],"darin@book"],"title":[[1768449027537,1],"darin@book"],"type":[[1768449027537,1],"darin@book"]},"acceptance_criteria":"- [ ] Outbound payloads never exceed session.peer().max_frame_bytes.\n- [ ] send_events batches respect the peer frame limit (not just local limits).\n- [ ] Tests cover a peer with smaller max_frame_bytes.\n\n**Files:** src/daemon/repl/session.rs, src/daemon/repl/manager.rs, src/daemon/repl/server.rs","closed_at":[1768454809145,1],"closed_by":"darin@book","created_at":[1768449027537,1],"created_by":"darin@book","description":"**Problem**\nHandshake negotiates an effective max_frame_bytes, but outbound writers continue using the local limit. This can emit frames larger than the peer accepts.\n\n**Evidence**\n- src/daemon/repl/session.rs: SessionPeer.max_frame_bytes is set to min(local, peer).\n- src/daemon/repl/manager.rs and src/daemon/repl/server.rs: FrameWriter is created once with limits.max_frame_bytes (local) and never updated after handshake.\n- send_payload/send_events do not clamp payload size to session.peer().max_frame_bytes.\n\n**Why this hurts**\nPeers with smaller frame limits will reject frames or disconnect even though we negotiated a smaller effective limit.","design":"**Design**\nOption A: Re-create FrameWriter after handshake with max_frame_bytes = peer.max_frame_bytes, and use it for all subsequent sends.\nOption B: Keep FrameWriter but add a size check in send_payload/send_events that enforces the peer limit (clamp batches accordingly, return FrameTooLarge if exceeded).\n\nEither way, ensure events and error payloads respect the negotiated max.","id":"bd-gkz","labels":[],"priority":2,"status":"closed","title":"Replication ignores negotiated max_frame_bytes","type":"bug"}
{"_at":[1768176637617,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768173802780,1],"darin@darinsmacstudio.lan"],"claim":[[1768176634792,1],"darin@darinsmacstudio.lan"],"description":[[1768173840787,1],"darin@darinsmacstudio.lan"],"design":[[1768173802780,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768173802780,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768173802780,1],"darin@darinsmacstudio.lan"],"labels":[[1768173802780,1],"darin@darinsmacstudio.lan"],"priority":[[1768173802780,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768173802780,1],"darin@darinsmacstudio.lan"],"title":[[1768173802780,1],"darin@darinsmacstudio.lan"],"type":[[1768173802780,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@darinsmacstudio.lan","assignee_at":[1768176634792,1],"assignee_expires":1768180234792,"closed_at":[1768176637617,1],"closed_by":"darin@darinsmacstudio.lan","closed_reason":"fixed","created_at":[1768173802780,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\n`session_coordinator_boundary` model reports a counterexample for the property \"pending ingest starts at next expected\" when running `cargo run --example session_coordinator_boundary -- check`. This indicates either the property is too strict for v0.5 semantics (buffered/out-of-order ingest) or the model logic is wrong.\n\n**Design**\nRe-run the model and capture the counterexample path. Decide whether the property should be relaxed (e.g., allow pending ingest to start earlier) or the model should be fixed to align with v0.5 gap buffering/prev deferral rules. Update the property or ingest logic accordingly and rerun the model to confirm no counterexample.\n\n**Acceptance**\n- [ ] Reproduce the counterexample path from the model output.\n- [ ] Decide whether the property or model logic is wrong and update accordingly.\n- [ ] `cargo run --example session_coordinator_boundary -- check` completes with no counterexample for that property.\n\n**Files:** `beads_stateright_models/examples/session_coordinator_boundary.rs`","id":"bd-heh","labels":[],"priority":2,"status":"closed","title":"session_coordinator_boundary model hits counterexample for pending ingest property","type":"bug"}
