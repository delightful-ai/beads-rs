{"_at":[1769404832405,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] `cargo check -p beads-surface` passes (empty stubs OK)\n- [ ] Module structure matches plan\n- [ ] Dependencies declared in Cargo.toml\n- [ ] Workspace builds cleanly","assignee":"darin@book","created_at":[1769398696286,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nNeed the beads-surface crate structure before moving IPC/ops/query types.\n\n**Changes**\nCreate the crate layout:\n\n```\ncrates/beads-surface/\n├── Cargo.toml\n└── src/\n    ├── lib.rs\n    ├── ipc/\n    │   ├── mod.rs\n    │   ├── types.rs    (Request, Response, ResponsePayload, etc.)\n    │   ├── codec.rs    (NDJSON framing, encode/decode)\n    │   └── client.rs   (IpcClient)\n    ├── ops.rs          (Patch, BeadPatch, OpResult)\n    └── query.rs        (Filters, SortField)\n```\n\n**Cargo.toml dependencies**:\n- beads-core\n- beads-api\n- serde, serde_json, thiserror\n- nix (signals/user)\n- tracing\n- optionally tempfile for tests\n\n**lib.rs public API**:\n```rust\npub mod ipc;\npub mod ops;\npub mod query;\n\npub use ipc::{Request, Response, ResponsePayload, IpcClient, IpcError, ...};\npub use ops::{Patch, BeadPatch, OpResult};\npub use query::{Filters, SortField};\n```\n\n**Files**\n- crates/beads-surface/Cargo.toml (new)\n- crates/beads-surface/src/lib.rs (new)\n- crates/beads-surface/src/ipc/mod.rs (new, empty stubs)\n- crates/beads-surface/src/ipc/types.rs (new, empty)\n- crates/beads-surface/src/ipc/codec.rs (new, empty)\n- crates/beads-surface/src/ipc/client.rs (new, empty)\n- crates/beads-surface/src/ops.rs (new, empty)\n- crates/beads-surface/src/query.rs (new, empty)","id":"bd-14fs.4","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Phase 3A: Create beads-surface crate layout","type":"task"}
{"_at":[1768495021369,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Global flags parsed and stored in Ctx\n- [ ] All read/query requests include require_min_seen/wait_timeout when flags provided\n- [ ] Subscribe uses explicit args when given, otherwise inherits global read gating","assignee":"darin@book","created_at":[1768494734814,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nREALTIME_PLAN requires require_min_seen + wait_timeout_ms on all read/query requests. CLI only exposes these for `bd subscribe`, so read gating cannot be exercised for `bd show/list/status/ready/...`.\n\n**Design**\nAdd global CLI flags `--require-min-seen <JSON>` and `--wait-timeout-ms <MS>` and plumb them into Ctx::read_consistency for all read/query requests. Reuse the existing JSON Watermarks parser used by subscribe. Subscribe args should override global flags when provided.\n\n**Files**\n- src/cli/mod.rs\n- src/cli/commands/subscribe.rs","id":"bd-jrz","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"CLI read gating flags for queries","type":"feature"}
{"_at":[1768448823419,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] `last_heartbeat_ms` is regularly updated while the daemon holds the lock, or the field is removed.\n- [ ] Tests or logs demonstrate the heartbeat behavior.","closed_reason":"duplicate of bd-3m5.87","created_at":[1768444225712,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nStore lock metadata includes `last_heartbeat_ms`, but the daemon never updates it. That makes the lock look stale even when the daemon is healthy, and it undermines the intended recovery UX.\n\n**Signals / Evidence**\n- `StoreLockMeta` contains `last_heartbeat_ms` (`src/daemon/store_lock.rs`).\n- `StoreLock::update_heartbeat` exists but is never called (no references).\n\n**Why this hurts velocity**\nOperators will get misleading diagnostics and may delete live locks. It’s also a sign of unexercised code paths.","design":"**Design**\n- Add a small periodic heartbeat in the daemon loop (e.g., every 10s) that calls `StoreLock::update_heartbeat`.\n- If we don’t want heartbeats, remove the field + method entirely to avoid lying metadata.","id":"bd-wy1","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Store lock heartbeat is never updated","type":"chore"}
