{"_at":[1768727290967,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768546082587,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-7lnn","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"rt smoke","type":"task"}
{"_at":[1769562239090,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769288486747,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-rptz","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Add admin reload-limits to apply config limits at runtime","type":"feature"}
{"_at":[1768622517020,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622517020,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbeads-rs lacks the Rig issue type - multi-repo workspace identity beads that represent a collection of Git repositories working together. Rigs enable cross-repo coordination, routing, and scoped agent operation.\n\n**What Rig Beads Do (from Go beads)**\nA rig is a logical workspace spanning multiple repos. Rig beads:\n- Define rig identity and membership (which repos belong)\n- Enable cross-repo bead references (gastown:bd-abc → rig:bd-xyz)\n- Scope agent operation (agents tied to specific rigs)\n- Coordinate multi-repo workflows (formulas spanning repos)\n\nRig structure:\n- HQ repo: Central coordination repo (e.g., beads-hq)\n- Member repos: Application/project repos (e.g., beads-rs, myapp)\n- Rig name: Identifier (e.g., \"gastown\", \"myproject\")\n\nEach member repo has .beads/config.toml pointing to HQ:\n```toml\n[rig]\nname = \"gastown\"\nhq = \"../beads-hq\"  # Relative path to HQ repo\n```\n\n**Go Implementation**\nType definition (internal/types/types.go):\n- IssueType = TypeRig (line 492)\n- Uses standard Issue fields\n- Rig.Rig field (line 113): Rig name\n- Description holds rig membership and configuration\n\nRig resolution (internal/routing/):\n- ResolveBeadsDirForRig(rigName, currentDir) → (beadsDir, repoDir, error)\n- Traverses filesystem to find HQ repo\n- Validates rig membership\n- Returns HQ .beads dir for cross-repo access\n\nCross-repo routing:\n- Bead IDs: <rig>:<bead-id> (e.g., gastown:bd-abc123)\n- Resolution: Parse rig prefix, resolve to HQ, query database\n- Used in: gate bead gates, agent cross-rig references, convoy tracking\n\nAgent-rig binding:\n- Agent.Rig field specifies rig membership\n- Town-level agents (mayor, deacon) have empty Rig\n- Rig-level agents (witness, polecat) have Rig = \"gastown\"\n\n**Design for Rust**\nData model (src/core/):\n```rust\npub struct RigData {\n    name: String,              // Rig identifier\n    hq_path: Option<String>,   // Path to HQ repo\n    members: Vec<String>,      // Member repo paths\n}\n```\n\nAdd to Bead or use optional fields.\n\nRig resolution (src/git/ or new src/routing/):\n```rust\npub fn resolve_rig_hq(rig_name: &str, current_dir: &Path) \n    -> Result<PathBuf, Error>;\n    \npub fn resolve_cross_repo_bead(rig_bead_id: &str, current_dir: &Path) \n    -> Result<(PathBuf, String), Error>;\n```\n\nCross-repo access:\n- Parse <rig>:<bead-id> references\n- Resolve rig to HQ .beads directory\n- Open HQ database read-only\n- Query for bead\n\nCLI (src/cli/):\n- bd create --type rig \"Rig name\"\n- bd show <rig-id> (display membership)\n- bd list --type rig\n\nConfig integration:\n- Read .beads/config.toml for rig.name and rig.hq\n- Validate rig membership on operations\n\n**Design Notes**\n- Rigs enable multi-repo coordination without monorepo\n- HQ repo is source of truth for rig-level state\n- Cross-repo references must be read-only (no writes to other repos)\n- Rig resolution needs filesystem traversal (security consideration)\n- Consider: Rig discovery (scan workspace for .beads dirs)\n- Consider: Rig validation (ensure member repos agree on HQ)\n- Town-level (no rig) vs rig-level separation\n\n**Acceptance**\n- [ ] Rig type constant defined\n- [ ] RigData struct with name, hq_path, members\n- [ ] bd create --type rig works\n- [ ] bd list --type rig shows rig beads\n- [ ] Config parser reads rig.name and rig.hq\n- [ ] resolve_rig_hq finds HQ repo from rig name\n- [ ] Cross-repo bead ID parsing (<rig>:<id>)\n- [ ] Cross-repo bead resolution via HQ database\n- [ ] Tests for rig resolution\n- [ ] Tests for cross-repo bead access\n- [ ] Migration from Go beads preserves rig type\n\n**Files to study in Go beads:**\n- tmp/beads/internal/types/types.go (line 492: TypeRig, line 113: Rig field)\n- tmp/beads/internal/routing/routing.go (rig resolution logic)\n- tmp/beads/cmd/bd/gate.go (checkBeadGate: cross-rig bead lookup example)\n- tmp/beads/internal/configfile/config.go (rig configuration)","id":"bd-ze0x.40","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":2491772196697158159,"replica":"43c7e7f3-fbed-23ea-af55-4204f3b6beec"}]}},"priority":2,"status":"open","title":"Add Rig issue type support","type":"feature"}
