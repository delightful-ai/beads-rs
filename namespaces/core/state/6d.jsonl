{"_at":[1768202500376,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Store directory helpers return expected paths under BD_DATA_DIR.\n- [ ] Lock file is created with required metadata and permissions; failure surfaces metadata.\n- [ ] Store open fails if lock held.\n- [ ] `cargo check` passes.","assignee":"darin@darinsmacstudio.lan","created_at":[1768177786604,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nPhase 3: implement store directory layout and a store global lock. Current paths only expose a base data dir and WAL uses per remote snapshot filenames. Realtime needs `$BD_DATA_DIR/stores/<store_id>/` with a lock file and secure permissions.\n\n**Context**\n- REALTIME_PLAN.md ยง0.2 (process level locking), ยง15.1 (store layout), ยง7.3 (startup flow steps 2-4)\n**Files:** src/paths.rs, src/daemon/store_lock.rs (new), src/daemon/store_runtime.rs (new) or src/daemon/core.rs","design":"**Design**\n- Add path helpers in `src/paths.rs`: stores_dir, store_dir(store_id), store_meta_path, wal_dir, index_path, checkpoint_cache_dir.\n- Implement a store lock file in the store dir with metadata: store_id, replica_id, pid, started_at_ms, daemon_version, last_heartbeat_ms.\n- Acquire lock at store open; on failure show metadata and fail fast. No auto delete.\n- Enforce file permissions (0700 for dirs, 0600 for sensitive files) and reject symlinks for critical paths.\n- Expose a helper API for lock acquire and release (called by StoreRuntime open).","id":"bd-3m5.7","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Phase 3: Store dir layout + store lock","type":"task"}
{"_at":[1768813480792,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768774750291,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nSpans are not propagated into background threads, so logs from git worker, repl loops, and server threads lose parent context.\n\n**Design**\n- Capture `Span::current()` before spawning threads and use `span.in_scope(...)` or `tracing::Instrument` inside thread bodies.\n- Apply to daemon worker spawns (git worker, repl server/manager, coord refresh loops, etc.).\n\n**Acceptance**\n- [ ] Background worker logs include parent span context where applicable.\n- [ ] No functional behavior changes; tests remain green.\n\n**Files:** src/daemon/git_worker.rs, src/daemon/coord.rs, src/daemon/repl/manager.rs, src/daemon/repl/server.rs, src/daemon/run.rs","id":"bd-4rhy","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Observability: propagate spans into background workers","type":"chore"}
