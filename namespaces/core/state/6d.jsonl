{"_at":[1768202500376,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768177786604,1],"darin@darinsmacstudio.lan"],"claim":[[1768201568086,1],"darin@darinsmacstudio.lan"],"description":[[1768177786604,1],"darin@darinsmacstudio.lan"],"design":[[1768177786604,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768177786604,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768177786604,1],"darin@darinsmacstudio.lan"],"labels":[[1768177786604,1],"darin@darinsmacstudio.lan"],"priority":[[1768177786604,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768177786604,1],"darin@darinsmacstudio.lan"],"title":[[1768177786604,1],"darin@darinsmacstudio.lan"],"type":[[1768177786604,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] Store directory helpers return expected paths under BD_DATA_DIR.\n- [ ] Lock file is created with required metadata and permissions; failure surfaces metadata.\n- [ ] Store open fails if lock held.\n- [ ] `cargo check` passes.","assignee":"darin@darinsmacstudio.lan","assignee_at":[1768201568086,1],"assignee_expires":1768205168086,"closed_at":[1768202500376,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768177786604,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nPhase 3: implement store directory layout and a store global lock. Current paths only expose a base data dir and WAL uses per remote snapshot filenames. Realtime needs `$BD_DATA_DIR/stores/<store_id>/` with a lock file and secure permissions.\n\n**Context**\n- REALTIME_PLAN.md ยง0.2 (process level locking), ยง15.1 (store layout), ยง7.3 (startup flow steps 2-4)\n**Files:** src/paths.rs, src/daemon/store_lock.rs (new), src/daemon/store_runtime.rs (new) or src/daemon/core.rs","design":"**Design**\n- Add path helpers in `src/paths.rs`: stores_dir, store_dir(store_id), store_meta_path, wal_dir, index_path, checkpoint_cache_dir.\n- Implement a store lock file in the store dir with metadata: store_id, replica_id, pid, started_at_ms, daemon_version, last_heartbeat_ms.\n- Acquire lock at store open; on failure show metadata and fail fast. No auto delete.\n- Enforce file permissions (0700 for dirs, 0600 for sensitive files) and reject symlinks for critical paths.\n- Expose a helper API for lock acquire and release (called by StoreRuntime open).","id":"bd-3m5.7","labels":[],"priority":2,"status":"closed","title":"Phase 3: Store dir layout + store lock","type":"task"}
