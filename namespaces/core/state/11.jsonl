{"_at":[1768187523392,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768180501637,1],"darin@darinsmacstudio.lan"],"claim":[[1768185964732,1],"darin@darinsmacstudio.lan"],"description":[[1768180501637,1],"darin@darinsmacstudio.lan"],"design":[[1768180501637,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768178713781,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768178713781,1],"darin@darinsmacstudio.lan"],"labels":[[1768178713781,1],"darin@darinsmacstudio.lan"],"priority":[[1768178713781,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768178713781,1],"darin@darinsmacstudio.lan"],"title":[[1768185399345,1],"darin@darinsmacstudio.lan"],"type":[[1768178713781,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] ErrorCode covers every entry in REALTIME_ERRORS.md and is the sole mapping to code strings.\n- [ ] ErrorPayload serializes to both JSON (IPC) and CBOR (replication) with optional fields omitted when empty.\n- [ ] Tests verify retryable and receipt fields are preserved and unknown codes do not break decoding.","assignee":"darin@darinsmacstudio.lan","assignee_at":[1768185964732,1],"assignee_expires":1768189564732,"closed_at":[1768187523392,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768178713781,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nWe need a single, truthful error vocabulary shared by IPC and replication. Today error mapping is scattered (OpError/CoreError/IpcError) and ErrorPayload in src/daemon/ipc.rs lacks retryable/receipt fields. That creates multiple representations of the same failure and forces clients to interpret strings ad hoc.\n\n**Context**\n- REALTIME_PLAN.md §0.14 (error payload standardization) and §9.10 (replication error handling)\n- REALTIME_ERRORS.md (canonical error code registry)\n- Current error plumbing: src/core/error.rs, src/error.rs, src/daemon/ipc.rs, src/daemon/repl/proto.rs (new)\n\n**Files:** src/core/error.rs (new or expanded), src/error.rs, src/daemon/ipc.rs, src/api/mod.rs, src/daemon/repl/proto.rs, REALTIME_ERRORS.md","design":"**Design**\n- Introduce ErrorCode enum with stable string mappings for every code in REALTIME_ERRORS.md; make it the single source of truth for code strings.\n- Define ErrorPayload { code, message, retryable, retry_after_ms?, details?, receipt? } in core and re-use it in IPC JSON and replication CBOR.\n- Provide From conversions from CoreError/OpError/IpcError/SyncError into ErrorPayload with consistent retryable/effect semantics.\n- Enforce that unknown codes are tolerated by clients; only retry when retryable=true.\n- Keep ErrorPayload schema version stable; add fields only as optional to preserve compatibility.","id":"bd-3m5.25","labels":[],"priority":2,"status":"closed","title":"Phase 1: Core error types + ErrorPayload","type":"task"}
{"_at":[1768456911759,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768444178286,1],"darin@book"],"claim":[[1768444178286,1],"darin@book"],"description":[[1768444178286,1],"darin@book"],"design":[[1768444178286,1],"darin@book"],"estimated_minutes":[[1768444178286,1],"darin@book"],"external_ref":[[1768444178286,1],"darin@book"],"labels":[[1768444178286,1],"darin@book"],"priority":[[1768444178286,1],"darin@book"],"source_repo":[[1768444178286,1],"darin@book"],"title":[[1768444178286,1],"darin@book"],"type":[[1768444178286,1],"darin@book"]},"closed_at":[1768456911759,1],"closed_by":"darin@book","created_at":[1768444178286,1],"created_by":"darin@book","description":"**Problem**\nREALTIME_PLAN §3.1 requires rejecting non-canonical integer encodings in EventBody. Current decode uses minicbor::Decoder u64/u32 directly and never checks for non-minimal integer encodings, so overlong integer encodings are accepted.\n\nEvidence:\n- src/core/event.rs:1650–1667 decode_u32 uses dec.u64 with no canonicality check.\n- No canonical integer validation exists in decode_map_len/decode_array_len/decode_u32.\n\n**Why this violates plan**\nCanonical CBOR is a correctness primitive for hashed payloads. Accepting non-canonical integers undermines deterministic validation requirements.\n\n**Acceptance**\n- [ ] Implement strict integer decoding that rejects non-minimal encodings (and tags).\n- [ ] Apply to all integer fields in EventBody/TxnDelta/HlcMax.\n- [ ] Add tests that reject overlong integer encodings.","id":"bd-3m5.85","labels":[],"priority":2,"status":"closed","title":"CBOR decode does not reject non-canonical integer encodings","type":"bug"}
{"_at":[1768428574356,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768387630958,1],"darin@book"],"claim":[[1768428285788,1],"darin@book"],"description":[[1768387630958,1],"darin@book"],"design":[[1768387630958,1],"darin@book"],"estimated_minutes":[[1768387630958,1],"darin@book"],"external_ref":[[1768387630958,1],"darin@book"],"labels":[[1768387630958,1],"darin@book"],"priority":[[1768387630958,1],"darin@book"],"source_repo":[[1768387630958,1],"darin@book"],"title":[[1768387630958,1],"darin@book"],"type":[[1768387630958,1],"darin@book"]},"assignee":"darin@book","assignee_at":[1768428285788,1],"assignee_expires":1768431885788,"closed_at":[1768428574356,1],"closed_by":"darin@book","created_at":[1768387630958,1],"created_by":"darin@book","description":"Full cargo test failed: test_update_bead saw type task after update. Running the test alone and critical_path with --test-threads=1 passes. Likely shared runtime dir/daemon across parallel tests.","id":"bd-zwn","labels":[],"priority":2,"status":"closed","title":"critical_path test_update_bead flaky in parallel runs","type":"bug"}
