{"_at":[1769549538751,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] IPC request structs no longer expose raw `String` for identifiers/namespace/actor/branch/durability.\n- [ ] Invalid IDs/namespaces/branches are rejected during deserialization (before daemon logic).\n- [ ] All daemon parsing code that manually validates these fields is removed or reduced to unavoidable business‑logic checks.\n- [ ] Tests cover IPC decode failure on invalid IDs and success on valid inputs.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769501245203,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nIPC payloads use raw strings for IDs, namespaces, actors, durability, and branch names. That defers parsing/validation to ad‑hoc runtime logic in the daemon, which means mistakes are not caught by the compiler and invalid payloads can slip through if a parse call is missed.\n\nExamples:\n- `MutationMeta.namespace`, `actor_id`, `durability` are `Option<String>`.\n- `IdPayload`, `DepPayload`, `CreatePayload.parent`, etc. are raw `String`.\n- `ClosePayload.on_branch` is `Option<String>`.\n\nKey refs:\n- `crates/beads-surface/src/ipc/types.rs:18`\n- `crates/beads-surface/src/ipc/payload.rs:12`\n\n**Impact**\nParse‑don’t‑validate is violated at the IPC boundary. Compiler cannot enforce that IDs and namespaces are valid.","design":"**Design (opinionated)**\nParse at the boundary. Replace raw strings with typed core IDs and enforce validation in serde.\n\n- Use `BeadId`, `NamespaceId`, `ActorId`, `BranchName`, `DurabilityClass` in IPC structs.\n- Provide custom serde/`TryFrom<String>` (already exists for most core IDs) so invalid inputs fail deserialization.\n- If backward compatibility requires strings on the wire, keep the wire format as strings but decode into typed fields immediately.\n\nThis makes “forgot to validate” a compile‑time error and rejects invalid inputs early.","id":"bd-5xpx","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Parse IPC payloads into typed IDs at boundary","type":"bug"}
{"_at":[1768425958918,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1766127778679,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nClock behavior is hard to test deterministically. We should be able to inject time sources to simulate skew and verify monotonicity across restarts.\n\n**Design**\nIntroduce a TimeSource trait for Clock (SystemTimeSource default). Allow tests to inject a fake source. Add tests covering backward/forward jumps and ensure stamps are monotonic and skew is detected.\n\n**Acceptance**\n- [ ] Clock supports injected time source in tests\n- [ ] Monotonicity tests cover backward/forward jumps\n- [ ] No API changes to production callers (Clock::new remains default)\n\n**Files:** src/daemon/clock.rs, src/daemon/core.rs","id":"bd-8rn","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Clock time-source injection + monotonic tests","type":"bug"}
