{"_at":[1765785395172,0],"_by":"darin@dusk","_v":{"acceptance_criteria":[[1765690392795,0],"darin@dusk"],"claim":[[1765690392795,0],"darin@dusk"],"description":[[1765690392795,0],"darin@dusk"],"design":[[1765690392795,0],"darin@dusk"],"estimated_minutes":[[1765690392795,0],"darin@dusk"],"external_ref":[[1765690392795,0],"darin@dusk"],"labels":[[1765690392795,0],"darin@dusk"],"priority":[[1765690392795,0],"darin@dusk"],"source_repo":[[1765690392795,0],"darin@dusk"],"title":[[1765690392795,0],"darin@dusk"],"type":[[1765690392795,0],"darin@dusk"]},"closed_at":[1765785395172,0],"closed_by":"darin@dusk","created_at":[1765690392795,0],"created_by":"darin@dusk","description":"## What's Wrong\nBead IDs now support `<slug>-<suffix>` to match beads-go (repo-name slug), but new repos still default to `bd` because slug selection is inferred from existing state.\n\n## Where\n- src/daemon/executor.rs: preferred_bead_slug(...) falls back to \"bd\" when store is empty\n- src/git/wire.rs: meta.json only stores format_version; no place to persist root slug\n\n## Why It Matters\n- Fresh repos should default to the repo-name slug (beads-go parity) or at least allow configuring it.\n- Inferring slug from existing IDs fails for empty stores and is an implicit heuristic.\n\n## Suggested Fix\n- Add `root_slug` to `meta.json` (WireMeta + core Meta), and set it on init (derive from repo dir name or remote URL basename; sanitize).\n- Use persisted `root_slug` for new ID generation.\n- Decide compatibility strategy (format_version bump if needed; ensure old readers ignore unknown fields or gate by version).\n\n## Acceptance\n- After `bd init` in a repo named `foo`, new IDs default to `foo-...` (or a clearly documented rule).\n- `bd create` in an empty store uses `meta.root_slug`, not a heuristic.","id":"bd-b6x","labels":[],"priority":2,"status":"closed","title":"Persist root slug in meta.json; default new IDs to repo-name","type":"feature"}
{"_at":[1767919459457,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1767916527694,1],"darin@darinsmacstudio.lan"],"claim":[[1767919334647,1],"darin@darinsmacstudio.lan"],"description":[[1767916527694,1],"darin@darinsmacstudio.lan"],"design":[[1767916527694,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1767916527694,1],"darin@darinsmacstudio.lan"],"external_ref":[[1767916527694,1],"darin@darinsmacstudio.lan"],"labels":[[1767916527694,1],"darin@darinsmacstudio.lan"],"priority":[[1767916527694,1],"darin@darinsmacstudio.lan"],"source_repo":[[1767916527694,1],"darin@darinsmacstudio.lan"],"title":[[1767916527694,1],"darin@darinsmacstudio.lan"],"type":[[1767916527694,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@darinsmacstudio.lan","assignee_at":[1767919334647,1],"assignee_expires":1767922934647,"closed_at":[1767919459457,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1767916527694,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\n`Daemon::apply_update` applies `BeadPatch` field-by-field inline in `src/daemon/executor.rs`. The patch semantics live in `src/daemon/ops.rs`, but the actual application logic lives elsewhere, so adding or changing fields requires touching multiple places and is easy to miss.\n\n**Design**\nAdd a helper on `BeadPatch` to apply patches directly to `BeadFields`:\n- Implement `BeadPatch::apply_to_fields(&self, fields: &mut BeadFields, stamp: &Stamp) -> Result<(), OpError>` in `src/daemon/ops.rs`.\n- Move the current field-application logic (including label parsing and status -> workflow transition) into this helper.\n- Update `Daemon::apply_update` to call the helper inside the WAL mutation.\n\n**Design Notes**\nKeep behavior identical: required fields cannot be cleared, label parsing stays strict, and status strings map to the same workflows with the same validation errors.\n\n**Acceptance**\n- [ ] `Daemon::apply_update` delegates patch application to `BeadPatch::apply_to_fields`.\n- [ ] Label validation and workflow transitions behave exactly as before.\n- [ ] Run `codex review --uncommitted` (timeout 10m) and address findings.\n- [ ] Tests pass.\n\n**Files:** `src/daemon/ops.rs`, `src/daemon/executor.rs`","id":"bd-omw.4","labels":[],"priority":2,"status":"closed","title":"Move BeadPatch application into BeadPatch helper","type":"chore"}
