{"_at":[1768622475281,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622475281,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nOSS contributors face a recursion problem: when using beads to track work on the beads project itself, their personal planning issues leak into PRs. The `.beads/` directory is git-tracked (it's the canonical issue database), but contributors' local issues pollute the diff.\n\n**What the Feature Does**\n`bd init --contributor` wizard that sets up stealth mode for OSS contributors:\n1. Detects fork/contributor status (HTTPS remote vs SSH)\n2. Creates personal planning repo (e.g., `~/.beads-planning/`)\n3. Configures auto-routing:\n   - `routing.mode = auto`\n   - `routing.contributor = ~/.beads-planning`\n   - `routing.maintainer = .`\n4. New issues auto-route to planning repo\n5. Planning issues never appear in upstream PRs\n\n**Example Workflow**\n```bash\n# One-time setup\ncd my-fork-of-beads\nbd init --contributor\n\n# All personal issues route to planning repo\nbd create \"TODO: Test edge case before lunch\" -p 2\nbd create \"Investigate Redis alternative\" -p 3\n# → Created in ~/.beads-planning, NOT in ./beads/\n\n# View all work (upstream + planning)\nbd ready\nbd list\n\n# Git commit/push - no .beads/ pollution in PR ✅\ngit commit -am \"fix: Handle null case\"\ngit push origin my-branch\n```\n\n**Why It Needs Design Work**\n\n1. **Role Detection**:\n   - How to reliably detect maintainer vs contributor?\n   - Git remote URL inspection (SSH = maintainer, HTTPS = contributor)\n   - Explicit override: `git config beads.role contributor`\n   - What about CI environments? Multi-machine setups?\n   - Edge cases: Work machine (SSH) vs personal machine (HTTPS)\n\n2. **Routing vs BEADS_DIR**:\n   - Go beads has BOTH routing config AND BEADS_DIR env var\n   - Which takes precedence?\n   - Backward compatibility with existing BEADS_DIR users?\n   - Should --contributor use routing or BEADS_DIR?\n\n3. **Database Aggregation**:\n   - Contributors need unified view: upstream issues + personal issues\n   - How to merge/hydrate multiple databases for queries?\n   - `bd ready` should show work from both repos\n   - `bd list` should aggregate\n   - But mutations route correctly based on source\n\n4. **Discovered Issue Inheritance**:\n   - If working on upstream issue bd-123, discover bug\n   - Should discovered issue go to planning or upstream?\n   - Go approach: `discovered-from` inherits parent's `source_repo`\n   - Rationale: Discovered work related to parent task\n\n**Key Decisions to Make**\n\n1. **Planning Repo Location**:\n   - Default: `~/.beads-planning/`\n   - User-configurable?\n   - Per-project planning repos? (e.g., `~/.beads-planning-beads/`)\n   - Naming convention?\n\n2. **Auto-Routing Algorithm**:\n   ```\n   When creating issue:\n   1. Check explicit --repo flag (highest priority)\n   2. Check BEADS_DIR env var\n   3. Check routing.mode config\n      - If \"auto\": Detect role → route based on role\n      - If \"explicit\": Use routing.default\n   4. Fallback: Current repo (.)\n   ```\n\n3. **Wizard Flow**:\n   - Detect fork automatically (check git remote)\n   - Prompt for planning repo location\n   - Ask about multi-repo hydration?\n   - Configure sync behavior for planning repo?\n   - Set up gitignore in planning repo?\n\n4. **Integration with Existing Config**:\n   - Go beads has `sync.remote`, `sync.branch` config\n   - Does planning repo have separate sync config?\n   - Or inherit from project repo?\n\n**Trade-offs to Consider**\n\n1. **Automatic vs Manual**:\n   - Pro Auto: Zero-friction, prevents pollution\n   - Con Auto: Magic behavior can confuse\n   - Solution: Clear output showing where issue was created\n\n2. **Single DB vs Dual DB**:\n   - Single: Simpler, easier to query\n   - Dual: Complete isolation, no pollution possible\n   - Dual wins for safety\n\n3. **Discovered Issue Routing**:\n   - Option A: Always go to upstream (they're real bugs)\n   - Option B: Go to planning (keep isolation)\n   - Option C: Inherit parent (Go's approach) ✅\n   - Rationale for C: Discovered work is part of parent task\n\n4. **Privacy**:\n   - Planning repo in home directory = private\n   - But if accidentally committed?\n   - Add .gitignore safety nets?\n\n**Reference Files in Go Beads**\n- `/Users/darin/Projects/beads-rs-macstudio/tmp/beads/docs/CONTRIBUTOR_NAMESPACE_ISOLATION.md` - Full design doc\n- `/Users/darin/Projects/beads-rs-macstudio/tmp/beads/internal/routing/routing.go` - Role detection\n- `/Users/darin/Projects/beads-rs-macstudio/tmp/beads/docs/ROUTING.md` - Auto-routing mechanics\n- `/Users/darin/Projects/beads-rs-macstudio/tmp/beads/docs/MULTI_REPO_AGENTS.md` - Contributor workflows\n\n**Go Implementation Notes**\n- `DetectUserRole(repoPath)` - SSH vs HTTPS detection\n- `DetermineTargetRepo(config, role, path)` - Routing decision\n- `init --contributor` creates `~/.beads-planning/`\n- Explicit `git config beads.role contributor` override\n- `source_repo` field tracks issue provenance\n\n**Open Design Questions**\n\n1. Should first `bd create` without setup show warning?\n   - Pro: Prevents accidental pollution\n   - Con: Friction for new users who might be maintainers\n\n2. Auto-create planning repo on first use?\n   - Pro: True zero-friction\n   - Con: Creates files user didn't ask for\n\n3. How to handle \"graduation\" of issues?\n   - Contributor discovers real bug, wants to file upstream\n   - Need `bd migrate` or `bd promote` command?\n   - Or just manually create in upstream?\n\n**Acceptance**\n- [ ] Design document for contributor mode architecture\n- [ ] Role detection algorithm spec (SSH/HTTPS, overrides, edge cases)\n- [ ] Routing precedence rules (--repo, BEADS_DIR, config)\n- [ ] Planning repo initialization spec\n- [ ] Database aggregation/hydration design\n- [ ] Discovered issue inheritance rules\n- [ ] Wizard UX flow\n- [ ] Migration path for existing BEADS_DIR users\n- [ ] Privacy/safety considerations\n- [ ] Integration with sync config","id":"bd-ze0x.29","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":16402908577586216834,"replica":"091c4987-c9c2-c5f5-5230-fb145ebc5f7f"}]}},"priority":2,"status":"open","title":"Init contributor mode - OSS fork workflow support","type":"feature"}
