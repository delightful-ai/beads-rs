{"_at":[1768195767984,1],"_by":"darin@darinsmacstudio.lan","_v":{"claim":[[1768183541894,1],"darin@darinsmacstudio.lan"],"description":[[1768180128574,1],"darin@darinsmacstudio.lan"],"design":[[1768180128574,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768177732086,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768177732086,1],"darin@darinsmacstudio.lan"],"labels":[[1768177732086,1],"darin@darinsmacstudio.lan"],"priority":[[1768177732086,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768177732086,1],"darin@darinsmacstudio.lan"],"title":[[1768177732086,1],"darin@darinsmacstudio.lan"],"type":[[1768177732086,1],"darin@darinsmacstudio.lan"],"workflow":[[1768183997123,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] WatermarkMap and WatermarkHeadMap helpers enforce contiguous advance and head sha required for seq > 0.\n- [ ] Seq0/Seq1 helpers behave as expected and are used by Watermark APIs.\n- [ ] DurabilityClass cannot represent k=0; DurabilityOutcome encodes pending vs achieved explicitly.\n- [ ] serde roundtrip tests for WatermarkMap/WatermarkHeadMap and DurabilityClass/Outcome.","assignee":"darin@darinsmacstudio.lan","assignee_at":[1768183541894,1],"assignee_expires":1768187141894,"closed_at":[1768183997123,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768177732086,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nRealtime semantics require explicit applied vs durable watermarks and head hash tracking. Today there is no watermark type, no seq0 vs seq1 distinction, and receipts cannot represent pending or partial durability without ambiguity.\n\n**Context**\n- REALTIME_PLAN.md 0.12 (applied vs durable), 0.12 head sha rule, 10.1 (durability classes), 16.1 (receipt shape)\n- Stateright model: beads_stateright_models/src/realtime_types_sketch.rs (Watermarks, Watermark, HeadStatus, DurabilityClass, DurabilityOutcome)\n\n**Files:** src/core/watermark.rs (new), src/core/durability.rs (new), src/core/mod.rs, src/lib.rs","design":"**Design**\n- Add Seq0 and Seq1 newtypes: Seq0 for highest contiguous seen, Seq1 for actual event origin_seq (1 based). Provide helpers next(), prev(), prev_seq0().\n- Add Watermark<K> that couples Seq0 with HeadStatus (Genesis, Known(sha), Unknown). This prevents representing seq>0 with no head.\n- Add Watermarks<Applied> and Watermarks<Durable> maps keyed by (NamespaceId, ReplicaId) with helpers advance_contiguous and observe_at_least that enforce head requirements.\n- Add DurabilityClass with ReplicatedFsync using NonZeroU32 for k; add DurabilityOutcome (Achieved vs Pending) and DurabilityProofV1 to express receipts without ambiguous Option fields.\n- Keep types serde friendly for IPC and WAL metadata.","id":"bd-3m5.3","labels":[],"priority":2,"status":"closed","title":"Phase 1: Watermarks + durability types","type":"task"}
{"_at":[1768395325944,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768178784608,1],"darin@darinsmacstudio.lan"],"claim":[[1768392386426,1],"darin@book"],"description":[[1768178784608,1],"darin@darinsmacstudio.lan"],"design":[[1768178784608,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768178784608,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768178784608,1],"darin@darinsmacstudio.lan"],"labels":[[1768178784608,1],"darin@darinsmacstudio.lan"],"priority":[[1768178784608,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768178784608,1],"darin@darinsmacstudio.lan"],"title":[[1768185417743,1],"darin@darinsmacstudio.lan"],"type":[[1768178784608,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@book","assignee_at":[1768392386426,1],"assignee_expires":1768395986426,"closed_at":[1768395325944,1],"closed_by":"darin@book","created_at":[1768178784608,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nOperators need bounded health checks with deterministic remediation actions.\n\n**Context**\n- REALTIME_PLAN.md ยง16.1 (admin.doctor, admin.scrub_now)\n\n**Design**\n- admin.doctor: runs bounded health scrub, returns machine-readable JSON with:\n  - checks: [{ id, status, severity, evidence, suggested_actions }]\n  - summary: { risk, safe_to_accept_writes, safe_to_prune_wal, safe_to_rebuild_index }\n  - Must include explicit remediation actions (exact admin ops to run)\n- admin.scrub_now: samples N events per namespace (default 200), verifies WAL CRC32c and sha256, verifies SQLite offsets, optionally verifies checkpoint_cache\n  - Returns structured pass/warn/fail results\n\n**Acceptance**\n- [ ] admin.doctor returns structured checks with remediation\n- [ ] admin.scrub_now samples and verifies bounded records\n- [ ] CLI `bd admin doctor` and `bd admin scrub` work\n- [ ] Tests verify check detection\n\n**Files:** src/daemon/admin.rs, src/daemon/scrubber.rs (new), src/cli/commands/admin.rs","id":"bd-3m5.32","labels":[],"priority":2,"status":"closed","title":"Phase 7: admin.doctor + admin.scrub_now IPC ops","type":"task"}
