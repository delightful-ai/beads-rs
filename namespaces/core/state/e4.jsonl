{"_at":[1768254941652,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768252042894,1],"darin@darinsmacstudio.lan"],"claim":[[1768254330728,1],"darin@darinsmacstudio.lan"],"description":[[1768252129726,1],"darin@darinsmacstudio.lan"],"design":[[1768252042894,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768252042894,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768252042894,1],"darin@darinsmacstudio.lan"],"labels":[[1768252042894,1],"darin@darinsmacstudio.lan"],"priority":[[1768252042894,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768252042894,1],"darin@darinsmacstudio.lan"],"title":[[1768252064198,1],"darin@darinsmacstudio.lan"],"type":[[1768252042894,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@darinsmacstudio.lan","assignee_at":[1768254330728,1],"assignee_expires":1768257930728,"closed_at":[1768254941652,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768252042894,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nWAL replay truncates on any corruption, including mid-file CRC/record decode errors, because scan_segment doesn't distinguish tail vs mid-file. This violates REALTIME_PLAN.md 5.2 (online vs offline boundary), which requires fail-fast on mid-file corruption and only tail truncation repairs.\n\n**Design**\nIn src/daemon/wal/replay.rs scan_segment, detect tail vs mid-file:\n- tail: remaining < FRAME_HEADER_LEN, frame_len > remaining, or crc mismatch where offset+frame_len == file_len.\n- mid-file: return explicit WalReplayError (new variant) with path+offset; do not truncate.\nOnly truncate in tail cases when repair_tail=true. Surface operator action to run bd store fsck.\nAdd tests for mid-file corruption (expect error) and tail corruption (truncate) using WAL fixtures.\n\n**Acceptance**\n- [ ] Mid-file corruption during replay returns error and does not truncate.\n- [ ] Tail corruption still truncates and continues.\n- [ ] Tests cover mid-file vs tail behavior; cargo test passes.\n\n**Files:** src/daemon/wal/replay.rs, tests/phase3_wal.rs","id":"bd-a0s","labels":[],"priority":2,"status":"closed","title":"WAL replay mid-file corruption should fail fast","type":"bug"}
