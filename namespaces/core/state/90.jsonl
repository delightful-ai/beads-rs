{"_at":[1768432343423,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","closed_reason":"Skip version ping when daemon.meta.json matches; added meta-based version checks and unit tests for match/mismatch.","created_at":[1768273182411,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nEvery IPC request does a Ping (version check) round-trip before the actual request.\n\n- Direct socket: ~60ms for one request\n- CLI: ~120ms+ for one request (Ping + actual)\n- `bd show` (human mode): 8 requests Ã— 60ms ping = ~480ms overhead\n\n**Evidence**\n```\nbd list -n 1: 64ms    (1 actual request + 1 ping)\nbd --json show: 26ms  (2 actual + 2 pings? or cached?)\nbd show simple: 480ms (8 requests, each with ping)\n```\n\n**Design Options**\n1. Connection reuse: Keep single connection per CLI invocation, verify once\n2. Session tokens: First Ping returns token, skip verification for subsequent\n3. Request batching: Combine Show+Deps+Notes into ShowWithContext\n\n**Acceptance**\n- [ ] `bd show simple-bead` < 200ms\n- [ ] No version mismatch regressions","id":"bd-1qp","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"IPC per-request Ping adds ~60ms overhead to each CLI request","type":"chore"}
{"_at":[1768427148596,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1766127760899,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nWe lack explicit tests for sync behavior under diverged refs, non-fast-forward pushes, and stale local refs. Regressions here can cause data loss or stuck syncs.\n\n**Design**\nAdd tests that simulate:\n- local ahead of remote (backup ref created, local not clobbered)\n- remote ahead of local (fast-forward update succeeds)\n- local/remote diverged (divergence flagged, sync outcome carries warning)\n- push non-fast-forward retry loop respects max_retries\nUse temp git repos with controlled commit graphs.\n\n**Acceptance**\n- [ ] Tests cover the above scenarios\n- [ ] Sync outcome divergence is surfaced\n- [ ] No data loss (local commits preserved)\n\n**Files:** src/git/sync.rs, tests/git_sync.rs","id":"bd-6b7","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Git sync state-machine robustness tests","type":"bug"}
{"_at":[1769551057512,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] `ClientRequestEventIds::new` rejects empty or mixed-origin/namespace inputs.\n- [ ] Ordering is canonical and preserved across WAL encode/decode.\n- [ ] `ClientRequestRow` and all WAL index APIs use the typed wrapper.\n- [ ] Idempotent reuse path no longer needs to revalidate event_ids ordering/non-empty.\n- [ ] Tests cover: empty list, mixed origin, out-of-order list, and roundtrip ordering.\n- [ ] `cargo test` passes.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769502724207,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`ClientRequestRow.event_ids` is a raw `Vec<EventId>`. There is no type-level guarantee that it is:\n- non-empty\n- all in the same `(namespace, origin)`\n- ordered by `origin_seq` (or even unique)\n\nThese invariants are currently enforced ad hoc in `try_reuse_idempotent_response` (runtime checks). If a bug or bad WAL decode writes an empty/mixed list, we can emit the wrong cached response or compute an incorrect durability receipt.\n\n**Impact**\n- Idempotency safety violations: wrong result/receipt for a reused client_request_id.\n- Ordering bugs: receipts and ACK coordination rely on max seq; unordered vectors can hide the true max.\n\n**Files**\n- `crates/beads-rs/src/daemon/wal/index.rs` (ClientRequestRow + encode/decode)\n- `crates/beads-rs/src/daemon/wal/memory_index.rs`\n- `crates/beads-rs/src/daemon/executor.rs` (idempotent reuse path)\n- `crates/beads-rs/src/daemon/wal/replay.rs`","design":"**Design**\nIntroduce a typed wrapper that makes illegal states unrepresentable and preserves ordering:\n\n- New type: `ClientRequestEventIds`\n  - Fields: `namespace: NamespaceId`, `origin: ReplicaId`, `seqs: NonEmptyVec<Seq1>`\n  - Invariant: all event ids are `(namespace, origin)`; `seqs` strictly increasing.\n  - Provide `fn new(event_ids: Vec<EventId>) -> Result<Self, ClientRequestIdsError>` that:\n    - rejects empty\n    - rejects mixed namespace/origin\n    - sorts or validates strict ordering\n    - optionally de-duplicates or rejects duplicates (prefer reject)\n  - Provide `fn event_ids(&self) -> Vec<EventId>` (or iterator) that yields canonical ordering.\n\n- Replace `ClientRequestRow.event_ids: Vec<EventId>` with `event_ids: ClientRequestEventIds`.\n- Update WAL encode/decode to use the new type:\n  - `encode_event_ids` should emit canonical ordering.\n  - `decode_event_ids` should validate and return `ClientRequestEventIds`.\n- Update call sites:\n  - `upsert_client_request` signature should accept `ClientRequestEventIds`.\n  - `lookup_client_request` returns typed row; `try_reuse_idempotent_response` no longer needs to check for empty/mixed origins.\n\n**Ordering / invariants preserved**\n- Canonical ordering is by `origin_seq` ascending and preserved through encode/decode.\n- If a caller supplies out-of-order ids, constructor sorts or rejects (decide explicitly; prefer reject for truthy types).","id":"bd-h672","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Client-request idempotency rows must store a typed, ordered event set","type":"bug"}
{"_at":[1768824646736,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- unlock_store returns UnlockOutcome enum\\n- call sites updated\\n- cargo check, cargo clippy -D warnings, cargo test pass","assignee":"darin@book","created_at":[1768824441845,0],"created_by":"darin@darinsmcstudio2.lan","description":"tests/integration/fixtures/store_lock.rs returns Result<bool> from unlock_store. Replace with an UnlockOutcome enum to encode whether the lock was removed or missing, and update call sites as needed.","id":"bd-zkjt","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Replace unlock_store bool with enum in test fixture","type":"chore"}
