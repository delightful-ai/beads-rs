{"_at":[1768448823211,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768444158887,1],"darin@book"],"claim":[[1768444158887,1],"darin@book"],"description":[[1768444158887,1],"darin@book"],"design":[[1768444158887,1],"darin@book"],"estimated_minutes":[[1768444158887,1],"darin@book"],"external_ref":[[1768444158887,1],"darin@book"],"labels":[[1768444158887,1],"darin@book"],"priority":[[1768444158887,1],"darin@book"],"source_repo":[[1768444158887,1],"darin@book"],"title":[[1768444158887,1],"darin@book"],"type":[[1768444158887,1],"darin@book"]},"acceptance_criteria":"- [ ] Unknown keys in EventBody are ignored (no `InvalidField` error).\n- [ ] Unknown keys in `hlc_max` are ignored while still requiring `actor_id`, `physical_ms`, `logical`.\n- [ ] Tests cover forward-compat decode for both top-level and `hlc_max`.","closed_at":[1768448823211,1],"closed_by":"darin@book","closed_reason":"duplicate of bd-3m5.84","created_at":[1768444158887,1],"created_by":"darin@book","description":"**Problem**\n`decode_event_body_map` rejects unknown keys with `InvalidField` instead of skipping them. This makes EventBody strictly closed and blocks forward-compatible changes to realtime payloads. The plan explicitly removed unknown-key *byte preservation* but did not require rejecting unknown keys; we should accept and ignore them while preserving raw bytes.\n\n**Signals / Evidence**\n- `decode_event_body_map` returns `InvalidField` on any unknown key (`src/core/event.rs`).\n- `decode_event_hlc_max` similarly errors on unknown keys inside `hlc_max`.\n- `verify_event_frame` relies on `decode_event_body`; rejection becomes `invalid_request` or `non_canonical`, making minor forward-compatible additions fatal.\n\n**Why this hurts velocity**\nAny new field in EventBody becomes a coordinated, lockstep upgrade across all replicas and clients. Thatâ€™s brittle and slows rollout.","design":"**Design**\n- Change `decode_event_body_map` to `dec.skip()` unknown keys instead of error.\n- Do the same for `hlc_max` (ignore unknown keys; still require required fields).\n- Keep existing required-field checks and limits.\n- Add tests: decoding succeeds with an extra unknown key at top-level and inside `hlc_max`, and hash verification still uses the raw bytes.","id":"bd-k67","labels":[],"priority":1,"status":"closed","title":"EventBody decode is too strict (unknown keys break forward compat)","type":"bug"}
