{"_at":[1769409227924,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] All dependencies added to Cargo.toml\n- [ ] `beads_rs::core::*` paths work via re-export\n- [ ] `beads_rs::api::*` paths work via re-export\n- [ ] `beads_rs::daemon::ipc::*` paths work via shim\n- [ ] `beads_rs::daemon::{BeadPatch, Filters, ...}` work\n- [ ] CLI compiles without changes to command handlers\n- [ ] `cargo check` passes for entire workspace\n- [ ] `cargo test` passes\n- [ ] `cargo clippy -- -D warnings` clean","assignee":"darin@book","created_at":[1769398697526,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nAfter moving code to surface crate, need to update beads-rs module wiring and re-exports so:\n- CLI keeps compiling without broad edits\n- Existing `beads_rs::*` paths still work\n- Daemon uses surface types correctly\n\n**Changes**\n\n1. **Update Cargo.toml** (`crates/beads-rs/Cargo.toml`):\n   ```toml\n   [dependencies]\n   beads-core = { path = \"../beads-core\" }\n   beads-api = { path = \"../beads-api\" }\n   beads-surface = { path = \"../beads-surface\" }\n   beads-macros = { path = \"../beads-macros\" }\n   ```\n\n2. **Update daemon/ipc/mod.rs** to be a compatibility shim:\n   ```rust\n   // Re-export everything from surface\n   pub use beads_surface::ipc::*;\n\n   // Keep error types accessible\n   pub use beads_core::{ErrorCode, ErrorPayload};\n\n   // Daemon-only additions\n   mod error_mapping;\n   pub use error_mapping::*;\n   ```\n\n3. **Update daemon/mod.rs** re-exports to preserve old paths:\n   ```rust\n   // Surface-owned types\n   pub use beads_surface::ops::{BeadPatch, OpResult, Patch};\n   pub use beads_surface::query::{Filters, SortField};\n   pub use beads_surface::ipc::{Request, Response, ResponsePayload, IpcClient};\n\n   // API types\n   pub use beads_api::QueryResult;\n\n   // Daemon-owned types\n   pub use ops::OpError;\n   ```\n\n4. **Update lib.rs** with crate aliases:\n   ```rust\n   // Crate re-exports for backwards compatibility\n   pub use beads_core as core;\n   pub use beads_api as api;\n   pub use beads_macros::enum_str;\n\n   // Optional: direct surface access\n   pub use beads_surface as surface;\n   ```\n\n5. **Verify all existing paths still work**:\n   - `beads_rs::core::BeadId` ✓\n   - `beads_rs::api::QueryResult` ✓\n   - `beads_rs::daemon::ipc::Request` ✓\n   - `beads_rs::daemon::BeadPatch` ✓\n   - `beads_rs::daemon::Filters` ✓\n\n**Files**\n- crates/beads-rs/Cargo.toml (dependencies)\n- crates/beads-rs/src/lib.rs (crate aliases)\n- crates/beads-rs/src/daemon/mod.rs (re-exports)\n- crates/beads-rs/src/daemon/ipc/mod.rs (shim)","id":"bd-14fs.10","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Phase 4: Re-wire beads-rs daemon with re-export shims","type":"task"}
{"_at":[1768380009337,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Checkpoint export is scheduled and produces commits under new refs.\n- [ ] Dirty events during export schedule a follow up checkpoint.\n- [ ] Legacy sync remains available for migration but does not write new realtime refs.","assignee":"darin@book","created_at":[1768177947873,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nPhase 6: integrate checkpoint scheduling and git ref wiring. Export and import modules alone are not used until daemon schedules checkpoints and writes the new refs.\n\n**Context**\n- REALTIME_PLAN.md §13.2 (refs), §14 (scheduler), §7.3 (startup flow)\n**Files:** src/git/checkpoint/*, src/daemon/scheduler.rs or new checkpoint runtime module, src/daemon/git_worker.rs, src/git/sync.rs (legacy)","design":"**Design**\n- Add checkpoint runtime that tracks dirty namespaces and schedules exports with debounce, max interval, and max events.\n- Write checkpoint commits to `refs/beads/<store_id>/<group>` and keep `refs/beads/meta` for discovery.\n- Ensure only one push in flight per group and coalesce when new events arrive.\n- Keep legacy `src/git/sync.rs` as read only migration path.","id":"bd-3m5.22","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Phase 6: Checkpoint scheduler + git ref wiring","type":"task"}
{"_at":[1768356244491,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768178940965,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbd-3m5.17 is too large. Split: manager handles outbound peers and reconnection.\n\n**Context**\n- REALTIME_PLAN.md §9.1 (manager.rs)\n- Refines bd-3m5.17\n\n**Design**\n- Implement ReplicationManager in src/daemon/repl/manager.rs\n- Manages outbound peer connections from config (replicas.toml)\n- Handles reconnect with exponential backoff\n- Event fanout to connected sessions\n- Namespace scoping based on policy (replicate=anchors/peers/none)\n\n**Acceptance**\n- [ ] Manager connects to configured peers\n- [ ] Reconnect with backoff on disconnect\n- [ ] Events fanned out to eligible sessions\n- [ ] Namespace policy respected\n\n**Files:** src/daemon/repl/manager.rs","id":"bd-3m5.47","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Phase 5: Replication manager + outbound peer lifecycle","type":"task"}
{"_at":[1768488067449,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768444275583,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nREALTIME_PLAN §5.2.3 says *.wal.tmp files MUST be ignored and SHOULD be deleted if not referenced by wal.sqlite. Current replay ignores .tmp files but never cleans them up.\n\nEvidence:\n- src/daemon/wal/replay.rs list_segments only loads *.wal; no cleanup of *.wal.tmp.\n\n**Acceptance**\n- [ ] On startup/replay, delete .wal.tmp files not referenced in wal.sqlite segments table.\n- [ ] Log deletions for operator visibility.","id":"bd-3m5.92","labels":{"cc":{"max":{}},"entries":{}},"priority":4,"status":"closed","title":"Startup does not clean up orphaned *.wal.tmp segments","type":"bug"}
{"_at":[1768717912302,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768710050218,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nSymmetry reduction currently only canonicalizes actor indices; replica IDs embedded in stream keys keep equivalent states distinct. This limits reduction for 3+ replicas.\n\n**Design**\n- Introduce a model-local replica key (index) used for stream keys/digests/invariants.\n- Keep a mapping Id -> ReplicaId for production ingest/frames; convert only at the model boundary.\n- Implement Rewrite<Id> for the model-local replica key / stream key so Representative can rewrite it.\n- Ensure no production logic is reimplemented; adapters remain thin.\n\n**Acceptance**\n- [ ] Symmetry on reduces state space further for >=3 replicas vs current baseline.\n- [ ] All invariants still pass.\n- [ ] Models still use production ingest adapters only.\n\n**Files**\n- beads_stateright_models/examples/repl_core_machine.rs\n- (optional) src/model/* adapters if a model-only key type is needed","id":"bd-54n2","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Stateright repl: full symmetry for replica ids","type":"task"}
