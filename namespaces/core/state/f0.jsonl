{"_at":[1768425704016,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768422496489,1],"darin@book"],"claim":[[1768425139072,1],"darin@book"],"description":[[1768422496489,1],"darin@book"],"design":[[1768422496489,1],"darin@book"],"estimated_minutes":[[1768422496489,1],"darin@book"],"external_ref":[[1768422496489,1],"darin@book"],"labels":[[1768422496489,1],"darin@book"],"priority":[[1768422496489,1],"darin@book"],"source_repo":[[1768422496489,1],"darin@book"],"title":[[1768422496489,1],"darin@book"],"type":[[1768422496489,1],"darin@book"]},"assignee":"darin@book","assignee_at":[1768425139072,1],"assignee_expires":1768428739072,"closed_at":[1768425704016,1],"closed_by":"darin@book","created_at":[1768422496489,1],"created_by":"darin@book","description":"**Problem**\nTests currently serialize via a global env lock because fixtures set process-wide env (BD_DATA_DIR/XDG_RUNTIME_DIR/BD_WAL_DIR). This blocks parallel execution and is fragile.\n\n**Design**\n- Avoid global env mutation in tests.\n- For CLI integration tests, set env only on the Command (already done in some fixtures).\n- For in-process IPC helpers (e.g., fixtures/load_gen using send_request), introduce explicit runtime/socket overrides instead of global env:\n  - Add test-only overrides in daemon::ipc for socket dir (similar to paths::set_data_dir_for_tests), or new send_request_* APIs that accept a socket path/runtime dir.\n  - Update fixtures to pass runtime_dir/socket path explicitly and remove std::env::set_var usage.\n- Remove env locks once overrides are in place.\n\n**Acceptance**\n- [ ] No test fixture calls std::env::set_var for BD_* or XDG_RUNTIME_DIR.\n- [ ] Realtime/load_gen/IPC fixtures accept explicit runtime/socket paths.\n- [ ] Tests run with --test-threads=8 without env-related flakiness.\n\n**Files**\n- tests/fixtures/realtime.rs\n- tests/fixtures/store_dir.rs\n- tests/fixtures/load_gen.rs\n- src/daemon/ipc.rs (test overrides or explicit socket path APIs)\n- src/paths.rs (if adding runtime dir override)\n","id":"bd-5un","labels":[],"priority":1,"status":"closed","title":"Tests: remove global env locks by avoiding env mutation","type":"bug"}
