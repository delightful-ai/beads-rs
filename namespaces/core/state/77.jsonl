{"_at":[1768806377683,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768778996787,0],"created_by":"darin@darinsmcstudio2.lan","description":"Background git sync can be expensive in integration tests that don't assert git behavior. Add a test-only env (e.g., BD_TEST_DISABLE_GIT_SYNC=1) to bypass scheduling/starting sync unless explicitly enabled. Update realtime/daemon fixtures to set it by default; enable in git-specific tests as needed.","id":"bd-ycab","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Add BD_TEST_DISABLE_GIT_SYNC to skip git sync in tests","type":"chore"}
{"_at":[1768622461123,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622461123,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbeads-rs lacks the Agent issue type - agent identity beads that represent autonomous workers in the swarm. Agents self-report state (idle/working/stuck/dead), maintain last_activity for timeout detection, and have slots for current work (hook_bead) and role definition (role_bead).\n\n**What Agent Beads Do (from Go beads)**\nAgent beads are first-class entities in the issue tracker. Each agent (polecat, witness, mayor, etc.) has a bead that:\n- Tracks agent lifecycle state (spawning → running → working → done/stuck/dead)\n- Records last_activity timestamp for heartbeat monitoring\n- Links to role definition (role_bead) and current work (hook_bead)\n- Enables Witness to detect dead agents via timeout\n- Provides audit trail of agent behavior\n\nAgent states (internal/types/types.go lines 579-591):\n- idle: Waiting for work\n- spawning: Starting up\n- running: Executing (general)\n- working: Actively working on a task\n- stuck: Blocked, needs help\n- done: Completed current work\n- stopped: Clean shutdown\n- dead: Died without clean shutdown (set by Witness)\n\n**Go Implementation**\nType definition (internal/types/types.go):\n- IssueType = TypeAgent (line 490)\n- Fields (lines 106-113):\n  - HookBead string: Current work on agent's hook (0..1 cardinality)\n  - RoleBead string: Role definition bead (required)\n  - AgentState AgentState: Current state enum\n  - LastActivity *time.Time: Updated on each action\n  - RoleType string: Role name (polecat|crew|witness|refinery|mayor|deacon)\n  - Rig string: Rig name (empty for town-level agents)\n\nCLI (cmd/bd/agent.go):\n- bd agent state <agent> <state> - Set state and update last_activity\n- bd agent heartbeat <agent> - Update last_activity only\n- bd agent show <agent> - Display agent details\n- bd agent backfill-labels - Migrate old agent beads\n\nSlot management (cmd/bd/slot.go):\n- bd slot set <agent> hook <bead> - Attach work to agent's hook\n- bd slot clear <agent> hook - Detach work from hook\n- bd slot set <agent> role <bead> - Set role definition\n- bd slot show <agent> - Show all slot values\n\nAuto-creation: If agent doesn't exist, bd agent state auto-creates it with gt:agent label.\n\nAgent ID patterns (parseAgentIDFields in agent.go lines 787-842):\n- Town-level: gt-mayor, gt-deacon (no rig)\n- Rig-level singleton: gt-gastown-witness (rig=\"gastown\", role=\"witness\")\n- Rig-level named: gt-gastown-polecat-nux (rig=\"gastown\", role=\"polecat\")\n\n**Design for Rust**\nData model (src/core/):\n```rust\npub enum AgentState {\n    Idle, Spawning, Running, Working, Stuck, Done, Stopped, Dead,\n}\n\npub struct AgentData {\n    state: AgentState,\n    last_activity: Option<SystemTime>,\n    hook_bead: Option<String>,  // 0..1 cardinality\n    role_bead: Option<String>,  // required\n    role_type: Option<String>,  // polecat, witness, etc.\n    rig: Option<String>,        // rig name or empty for town-level\n}\n```\n\nAdd AgentData to Bead or use optional fields.\n\nCLI surface (src/cli/):\n- bd agent state <agent> <state>\n- bd agent heartbeat <agent>\n- bd agent show <agent>\n- bd slot set <agent> <slot> <bead>\n- bd slot clear <agent> <slot>\n- bd slot show <agent>\n\nCardinality enforcement:\n- hook slot: 0..1 (error if already occupied)\n- role slot: required for agents\n\nAuto-creation:\n- Parse agent ID to extract role_type and rig\n- Create with appropriate labels\n\n**Design Notes**\n- Agent beads are infrastructure, not user work items\n- last_activity is critical for Witness timeout detection\n- Slots enforce cardinality at write time (unlike labels)\n- Cross-rig agent references need multi-repo support\n- Auto-creation reduces friction for new agents\n- Consider: Should agents have their own namespace to avoid ID collisions?\n\n**Acceptance**\n- [ ] AgentState enum defined in src/core/\n- [ ] AgentData struct with all fields\n- [ ] Bead can hold agent-specific fields\n- [ ] bd agent state sets state and last_activity\n- [ ] bd agent heartbeat updates only last_activity\n- [ ] bd agent show displays agent fields\n- [ ] bd slot set/clear/show commands work\n- [ ] Hook slot enforces 0..1 cardinality\n- [ ] Agent auto-creation works for non-existent IDs\n- [ ] Agent ID parsing extracts role_type and rig\n- [ ] Tests for agent state transitions\n- [ ] Tests for slot cardinality enforcement\n- [ ] Migration from Go beads preserves agent fields\n\n**Files to study in Go beads:**\n- tmp/beads/internal/types/types.go (lines 106-113: agent fields, 579-600: AgentState)\n- tmp/beads/cmd/bd/agent.go (entire file: CLI implementation)\n- tmp/beads/cmd/bd/slot.go (entire file: slot management)\n- tmp/beads/cmd/bd/agent_test.go","id":"bd-ze0x.25","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":9274434705844063688,"replica":"c683eaf3-0a41-e8b4-8330-6cdb69dab6f6"}]}},"priority":2,"status":"open","title":"Add Agent issue type support","type":"feature"}
