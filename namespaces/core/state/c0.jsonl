{"_at":[1767993328922,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] hash_prev_machine.rs updated or a new model added (e.g., canonical_hash_machine.rs) and compiles\n- [ ] Properties cover: canonical-only acceptance, unknown-key preservation for hash validity, prev continuity per §0.12.1, and defined behavior for out-of-order events\n- [ ] Model doc comments reference REALTIME_PLAN.md §0.6, §0.6.1, §0.12.1, and §9.4\n- [ ] Example runs via cargo run --example canonical_hash_machine (or equivalent)","assignee":"darin@darinsmacstudio.lan","created_at":[1767985361788,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nThe hash/prev continuity and canonical CBOR rules (REALTIME_PLAN.md §0.6, §0.6.1, §0.12.1, §9.4) are foundational. We have hash_prev_machine.rs, but it does not cover unknown-key preservation or the out-of-order buffering vs prev-check policy implied by §9.4.\n\n**Design Notes**\nThis model should clarify how verification interacts with gaps and how canonicalness is enforced before WAL append.","design":"**Design**\nExtend hash_prev_machine.rs or create a new model that adds: (a) a canonical/ non-canonical flag for incoming bytes, (b) unknown-key preservation as a requirement for hash verification, and (c) explicit policy for out-of-order events (buffered until prev is known vs immediate rejection). Tie that policy to Plan §9.4 and §0.12.1 in comments and pick the interpretation the plan intends.\n\nModel invariants: wrong store => reject, sha mismatch => reject, non-canonical => reject, prev mismatch => reject, equivocation => reject. Ensure contiguity is only advanced after successful verification and (if buffered) after gaps are filled.","id":"bd-hjm.9","labels":{"cc":{"max":{}},"entries":{"modeling":[{"counter":5216526302262082596,"replica":"db9a18cf-8955-6c4e-41cb-b907dd389c87"}],"realtime":[{"counter":14425708773074605133,"replica":"a6e632ab-7b8f-a917-dfca-8cc8577b72d6"}],"stateright":[{"counter":14558518687260823237,"replica":"5496546e-0927-8956-7d53-bcd3e2a91621"}]}},"priority":2,"status":"closed","title":"Stateright: canonical hash/prev gating + unknown-key rules","type":"feature"}
