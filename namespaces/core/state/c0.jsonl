{"_at":[1767993328922,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1767985361788,1],"darin@darinsmacstudio.lan"],"claim":[[1767993178918,1],"darin@darinsmacstudio.lan"],"description":[[1767985361788,1],"darin@darinsmacstudio.lan"],"design":[[1767985361788,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1767985361788,1],"darin@darinsmacstudio.lan"],"external_ref":[[1767985361788,1],"darin@darinsmacstudio.lan"],"labels":[[1767985361788,1],"darin@darinsmacstudio.lan"],"priority":[[1767985361788,1],"darin@darinsmacstudio.lan"],"source_repo":[[1767985361788,1],"darin@darinsmacstudio.lan"],"title":[[1767985361788,1],"darin@darinsmacstudio.lan"],"type":[[1767985361788,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] hash_prev_machine.rs updated or a new model added (e.g., canonical_hash_machine.rs) and compiles\n- [ ] Properties cover: canonical-only acceptance, unknown-key preservation for hash validity, prev continuity per §0.12.1, and defined behavior for out-of-order events\n- [ ] Model doc comments reference REALTIME_PLAN.md §0.6, §0.6.1, §0.12.1, and §9.4\n- [ ] Example runs via cargo run --example canonical_hash_machine (or equivalent)","assignee":"darin@darinsmacstudio.lan","assignee_at":[1767993178918,1],"assignee_expires":1767996778918,"closed_at":[1767993328922,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1767985361788,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nThe hash/prev continuity and canonical CBOR rules (REALTIME_PLAN.md §0.6, §0.6.1, §0.12.1, §9.4) are foundational. We have hash_prev_machine.rs, but it does not cover unknown-key preservation or the out-of-order buffering vs prev-check policy implied by §9.4.\n\n**Design Notes**\nThis model should clarify how verification interacts with gaps and how canonicalness is enforced before WAL append.","design":"**Design**\nExtend hash_prev_machine.rs or create a new model that adds: (a) a canonical/ non-canonical flag for incoming bytes, (b) unknown-key preservation as a requirement for hash verification, and (c) explicit policy for out-of-order events (buffered until prev is known vs immediate rejection). Tie that policy to Plan §9.4 and §0.12.1 in comments and pick the interpretation the plan intends.\n\nModel invariants: wrong store => reject, sha mismatch => reject, non-canonical => reject, prev mismatch => reject, equivocation => reject. Ensure contiguity is only advanced after successful verification and (if buffered) after gaps are filled.","id":"bd-hjm.9","labels":["modeling","realtime","stateright"],"priority":2,"status":"closed","title":"Stateright: canonical hash/prev gating + unknown-key rules","type":"feature"}
