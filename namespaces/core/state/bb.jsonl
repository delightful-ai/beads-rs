{"_at":[1770500471519,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Surface lock APIs implemented\n- [ ] CLI lock flows use surface APIs\n- [ ] Lock internals no longer exposed to CLI","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770498234622,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nCLI offline unlock/lock-info reaches into daemon lock internals.","design":"Provide typed surface APIs for lock inspection and unlock, returning stable admin output schemas.","id":"bd-21eg.14","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Add surface store-lock info/unlock APIs returning beads-api output types","type":"feature"}
{"_at":[1770507489648,0],"_by":"darin@darinsmcstudio2.lan","_v":{"workflow":[[1770507489610,0],"darin@darinsmcstudio2.lan"]},"acceptance_criteria":"- [ ] Bin targets compile against new crate layout\n- [ ] Legacy paths retained only as temporary shims\n- [ ] Runtime behavior unchanged","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770498237985,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nBinaries currently assume monolithic internal module ownership.","design":"Update bin entrypoints to call new crates; shrink `beads-rs` to compatibility/orchestration role.","id":"bd-21eg.24","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1770504939527,0],"author":"darin@darins-Mac-Studio-2.local","content":"Progress: binary boundary remains stable while shared repl frame+proto ownership now lives in beads-daemon-core; beads-rs binaries compile against new shared boundary via compatibility shims. Verified cargo check -p beads-rs and --bin tailnet_proxy.","id":"go-comment-bd-21eg.24-1"},{"at":[1770505261134,0],"author":"darin@darins-Mac-Studio-2.local","content":"Progress update: root crate error wiring is now daemon-decoupled (bd-21eg.32 closed), and repl frame+proto ownership moved into beads-daemon-core with beads-rs compatibility shims. This reduces binary coupling and keeps runtime behavior stable while we continue migrating main CLI entrypoint ownership.","id":"go-comment-bd-21eg.24-2"},{"at":[1770507472777,0],"author":"darin@darins-Mac-Studio-2.local","content":"Progress: binary/entrypoint wiring remains green after CLI boundary cleanup. crates/beads-rs/src/bin/main.rs continues to call beads_rs::run_cli_entrypoint, and command dispatch now routes prime/setup/onboard through beads-cli-backed handlers without local compatibility modules. Verified with cargo check -p beads-rs --bins and cargo check --workspace; behavior-preserving path.","id":"go-comment-bd-21eg.24-3"},{"at":[1770507489648,0],"author":"darin@darins-Mac-Studio-2.local","content":"Validation evidence before close: cargo check -p beads-rs --bins, cargo check --workspace, cargo test -p beads-rs --test integration -- cli::critical_path:: (6 pass), and daemon/repl integration slices all pass. With prime/setup/onboard dispatch now routed directly through beads-cli-backed handlers and no local wrapper modules, .24 acceptance criteria are satisfied.","id":"go-comment-bd-21eg.24-4"},{"at":[1770507489648,0],"author":"darin@darinsmcstudio2.lan","content":"Progress: binary boundary remains stable while shared repl frame+proto ownership now lives in beads-daemon-core; beads-rs binaries compile against new shared boundary via compatibility shims. Verified cargo check -p beads-rs and --bin tailnet_proxy.\n\nProgress update: root crate error wiring is now daemon-decoupled (bd-21eg.32 closed), and repl frame+proto ownership moved into beads-daemon-core with beads-rs compatibility shims. This reduces binary coupling and keeps runtime behavior stable while we continue migrating main CLI entrypoint ownership.\n\nProgress: binary/entrypoint wiring remains green after CLI boundary cleanup. crates/beads-rs/src/bin/main.rs continues to call beads_rs::run_cli_entrypoint, and command dispatch now routes prime/setup/onboard through beads-cli-backed handlers without local compatibility modules. Verified with cargo check -p beads-rs --bins and cargo check --workspace; behavior-preserving path.\n\nValidation evidence before close: cargo check -p beads-rs --bins, cargo check --workspace, cargo test -p beads-rs --test integration -- cli::critical_path:: (6 pass), and daemon/repl integration slices all pass. With prime/setup/onboard dispatch now routed directly through beads-cli-backed handlers and no local wrapper modules, .24 acceptance criteria are satisfied.","id":"legacy-notes"}],"priority":1,"status":"closed","title":"Rewire binaries and keep beads-rs as thin orchestration/compat shim","type":"task"}
{"_at":[1769562062556,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769236536126,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-6ole","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Fix repl rig config ordering so WAL limits apply before init","type":"bug"}
{"_at":[1768622536153,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622536153,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n\nGo beads supports registering waiters on gate beads. When a gate closes, waiters receive wake notifications via `gt gate wake`. This enables async coordination across agents.\n\nMissing from beads-rs:\n- `bd gate add-waiter <gate-id> <waiter>` command\n- Waiters field on gate beads (array of strings)\n- Wake notification when gate closes\n\nWaiters field (from types.go line 97):\n```go\nWaiters []string `json:\"waiters,omitempty\"` // Mail addresses to notify when gate clears\n```\n\nTypical waiter format: \"gastown/polecats/Toast\" (agent address)\n\n**Design**\n\nAdd waiters field to gate beads and implement add-waiter command.\n\nCommand:\n```bash\nbd gate add-waiter <gate-id> <waiter>\n```\n\nBehavior:\n- Appends waiter to gate's waiters array\n- Checks for duplicates (don't add same waiter twice)\n- Validates issue is type=gate\n- When gate closes, waiters should be notified (future: gt gate wake integration)\n\nWaiters field:\n- Type: Vec<String>\n- Stored in bead as Lww<Vec<String>> (list CRDT)\n- Each waiter is an address (string identifier)\n\nImplementation files:\n- `src/core/lww.rs` - Add waiters field to Bead (if not already present)\n- `src/cli/gate/add_waiter.rs` - Add-waiter command\n- `src/daemon/ops.rs` - Add-waiter operation\n- `src/cli/gate/show.rs` - Display waiters in gate details\n\nCommand validation:\n1. Resolve gate-id to full ID\n2. Load gate bead\n3. Verify type=gate\n4. Check if waiter already registered\n5. Append to waiters array\n6. Update bead\n\n**Design Notes**\n\nWake notification (gt gate wake) is a Gas Town feature, not core beads-rs. For now:\n1. Store waiters field for compatibility\n2. Implement add-waiter command\n3. Don't implement wake notifications (leave for Gas Town)\n\nWaiter format is free-form string. No validation beyond non-empty.\n\nDeduplication is important:\n```rust\nif gate.waiters.contains(&waiter) {\n    println!(\"Waiter already registered on gate {}\", gate_id);\n    return Ok(());\n}\n```\n\nFuture enhancement: When closing a gate, log waiters to stdout so external tools can trigger notifications.\n\n**Acceptance**\n\n- [ ] Gate beads have waiters field (Vec<String>)\n- [ ] `bd gate add-waiter <gate-id> <waiter>` appends to waiters\n- [ ] Duplicate waiters are rejected with message\n- [ ] Non-gate issues are rejected with error\n- [ ] `bd gate show <id>` displays waiters list\n- [ ] Tests for add-waiter operation\n- [ ] Migration preserves waiters from Go beads\n\n**Files:**\n- src/core/lww.rs\n- src/cli/gate/add_waiter.rs\n- src/daemon/ops.rs\n- src/cli/gate/show.rs\n- src/migrate/go_export.rs","id":"bd-ze0x.44","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":13812956721719678539,"replica":"b4224b2d-cef1-309d-c12b-dd139c245596"}]}},"priority":3,"status":"open","title":"Gate add-waiter command for notification registration","type":"feature"}
