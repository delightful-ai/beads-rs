{"_at":[1769765456312,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] `LabelStore` and `NoteStore` no longer contain legacy maps; all state is lineage-based.\n- [ ] Legacy on-disk formats are migrated at the import boundary (git store / WAL / checkpoint).\n- [ ] All read paths (`labels_for`, `bead_view`, serialization) use a single source of truth without legacy merges.\n- [ ] Tests cover migration of legacy labels/notes and correctness of lineage-based reads.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769580707061,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nLabels and notes are stored in two parallel representations: lineage-aware stores and legacy per-bead stores.\n- `LabelStore` has `by_bead` + `legacy_by_bead` in `crates/beads-core/src/state.rs`\n- `NoteStore` has `by_bead` + `legacy_by_bead` in `crates/beads-core/src/state.rs`\n- Call sites merge these in multiple places (`CanonicalState::labels_for`, `bead_view`, `git/wire.rs` serialization, checkpoint import, WAL legacy snapshot)\n\nThis is a root scatter source: the same data lives in two places, invariants are enforced by convention, and every read path must remember to merge legacy + lineage.\n\n**Files:**\n- `crates/beads-core/src/state.rs`\n- `crates/beads-rs/src/git/wire.rs`\n- `crates/beads-rs/src/git/checkpoint/import.rs`\n- `crates/beads-rs/src/daemon/wal_legacy_snapshot.rs`\n- `crates/beads-rs/src/daemon/core.rs`","design":"**Design**\nMake lineage-based storage the only representation for labels and notes, and migrate legacy data on load.\n\nConcrete plan:\n1) Remove `legacy_by_bead` from `LabelStore` and `NoteStore` and all callers that merge legacy state.\n2) Introduce a migration step when loading legacy data (git store, WAL snapshot, checkpoint import) that:\n   - Derives lineage stamps (e.g., from bead core created stamp)\n   - Moves legacy labels/notes into the lineage map\n3) Update serialization to emit only lineage-aware structures.\n4) Keep a single explicit compatibility adapter for legacy on-disk formats (isolated in the import layer), and delete legacy logic elsewhere.\n\n**Design Notes**\n- Ensure collision tombstone behavior remains correct after migration.\n- If any legacy data lacks lineage, use a deterministic fallback stamp with explicit documentation.","id":"bd-1v5w","labels":{"cc":{"max":{}},"entries":{"consistency":[{"counter":12841434701901136451,"replica":"afe27b0e-ec99-eb74-5157-dda998ba4c0b"}],"scatter":[{"counter":14068472835475420936,"replica":"814fc6b6-edb3-5133-fd32-98a218feea95"}],"tech-debt":[{"counter":12235574247874123841,"replica":"62f0a584-ff0c-48cc-bc5d-35652e537594"}]}},"priority":2,"status":"closed","title":"Remove legacy label/note stores; migrate to lineage-only","type":"chore"}
{"_at":[1770499343713,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] New CLI crate builds\n- [ ] CLI crate depends on surface boundary crates\n- [ ] No direct daemon dependency introduced","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770498236763,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nCLI cannot iterate independently while embedded in monolithic crate.","design":"Create `beads-cli` crate with dependency on surface contracts and workspace wiring.","id":"bd-21eg.21","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Scaffold beads-cli crate and workspace wiring","type":"task"}
{"_at":[1768914175342,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] encode/decode roundtrip for new ops\n\n**Invariants to re-verify**\n- [ ] Wire codec roundtrips dots/DVVs deterministically","assignee":"darin@book","created_at":[1768894653885,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nNew wire ops require codec coverage.\n\n**Files**\n- src/core/wire_bead.rs\n- src/core/event.rs","design":"Add tests for TxnDeltaV1 roundtrip with LabelAdd/Remove and DepAdd/Remove, including dot/dvv ordering.","id":"bd-3zoj.16","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Tests: wire encode/decode for new ops","type":"task"}
{"_at":[1768525641723,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","closed_reason":"fixed by bd-zl6d timeout scaling","created_at":[1768524022696,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-84sy","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"admin_status_monotonic_under_load sometimes times out at 3s","type":"bug"}
