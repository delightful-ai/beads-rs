{"_at":[1769406208824,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] All 12 IPC protocol types defined in beads-surface\n- [ ] No `impl Into<...>` on cross-crate boundaries\n- [ ] `cargo check -p beads-surface` passes\n- [ ] Types use beads_core:: and beads_api:: imports","assignee":"darin@book","created_at":[1769398696496,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nIPC protocol types live in `daemon/ipc/types.rs` but are part of the public boundary.\n\n**Complete type inventory from codebase**:\n- `IPC_PROTOCOL_VERSION` (const)\n- `MutationMeta`, `ReadConsistency`\n- `Request` (enum), `Response` (enum), `ResponsePayload` (enum)\n- `OpResponse`\n- `SyncedPayload`, `RefreshedPayload`, `InitializedPayload`, `ShuttingDownPayload`\n- `SubscribedPayload`, `StreamEventPayload`\n\n**Changes**\n\n1. **Move file**: `crates/beads-rs/src/daemon/ipc/types.rs` → `crates/beads-surface/src/ipc/types.rs`\n\n2. **Update imports in moved file**:\n   ```rust\n   // Old\n   use crate::api::QueryResult;\n   use crate::core::ErrorPayload;\n   use crate::core::{Applied, BeadType, DepKind, DurabilityReceipt, Priority, Watermarks};\n   use crate::daemon::ops::{BeadPatch, OpResult};\n   use crate::daemon::query::Filters;\n\n   // New\n   use beads_api::QueryResult;\n   use beads_core::ErrorPayload;\n   use beads_core::{Applied, BeadType, DepKind, DurabilityReceipt, Priority, Watermarks};\n   use crate::ops::{BeadPatch, OpResult};  // surface-local\n   use crate::query::Filters;              // surface-local\n   ```\n\n3. **Change convenience constructors** to avoid cross-crate `Into` issues:\n\n   Current problematic signatures:\n   - `pub fn err(error: impl Into<ErrorPayload>)` in types.rs:464\n   - `fn box_error(err: impl Into<ErrorPayload>)` in subscription.rs:90\n\n   Change to accept concrete types:\n   ```rust\n   impl Response {\n       pub fn err(err: beads_core::ErrorPayload) -> Self { ... }\n   }\n   impl ResponsePayload {\n       pub fn query(result: beads_api::QueryResult) -> Self { ... }\n   }\n   ```\n\n4. **Update beads-surface/src/ipc/mod.rs**:\n   ```rust\n   pub mod types;\n   pub use types::*;\n   ```\n\n**Files**\n- crates/beads-surface/src/ipc/types.rs (moved + updated)\n- crates/beads-surface/src/ipc/mod.rs (re-export)","id":"bd-14fs.5","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Phase 3B: Move IPC protocol types to beads-surface","type":"task"}
{"_at":[1768200838458,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darinsmacstudio.lan","created_at":[1768180744574,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nPhase 2 tests need canonical CBOR fixtures and apply test harness.\n\n**Context**\n- REALTIME_PLAN.md §18: canonical hashing stability, apply idempotence\n- Blocks Phase 2 testing bead\n\n**Design**\nCreate test infrastructure:\n- Golden CBOR fixtures: known EventBody → known sha256 (cross-platform stable)\n- EventBody test factories with deterministic stamps/IDs\n- Apply test harness: CanonicalState setup + apply + verify helpers\n- Fingerprint comparison utilities\n\n**Acceptance**\n- [ ] tests/fixtures/cbor.rs with golden CBOR bytes + expected hashes\n- [ ] tests/fixtures/event_body.rs with EventBody builders\n- [ ] tests/fixtures/apply_harness.rs with apply + verify helpers\n- [ ] Golden fixtures verified manually on multiple platforms (macOS, Linux)\n\n**Files:** tests/fixtures/cbor.rs (new), tests/fixtures/event_body.rs (new), tests/fixtures/apply_harness.rs (new)","id":"bd-3m5.55","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Phase 2 test infrastructure: CBOR fixtures + apply harness","type":"task"}
