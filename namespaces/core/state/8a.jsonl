{"_at":[1768480026633,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768454419019,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nREALTIME_PLAN ¬ß13.3 calls for `roster_hash` in checkpoint meta and warnings on mismatch. `StoreRuntime::checkpoint_snapshot` always sets `roster_hash = None`, and there is no roster hash computation anywhere. This loses the audit trail for durability eligibility changes.\n\n**Design**\n- Compute roster hash from validated `replicas.toml` (canonical JSON) when present.\n- Include it in `CheckpointSnapshot` + meta; surface mismatch warnings on import.\n\n**Acceptance**\n- [ ] roster_hash is present when a replica roster exists.\n- [ ] Checkpoint import compares roster_hash and emits a warning on mismatch.\n- [ ] Tests cover hash stability + mismatch warning.\n\n**Files:** src/daemon/store_runtime.rs, src/git/checkpoint/meta.rs, src/git/checkpoint/import.rs","id":"bd-3m5.106","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Checkpoint meta never includes roster_hash","type":"bug"}
{"_at":[1768525369990,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] subscribe_gates_on_require_min_seen passes reliably.\n- [ ] Subscribe stream failure modes return a structured error (not just disconnect) when possible.\n- [ ] Test setup avoids daemon lifecycle races if needed.","assignee":"darin@book","created_at":[1768512755367,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nsubscribe_gates_on_require_min_seen fails in tests/integration/daemon/subscribe.rs:104 with Ipc(Disconnected) during the normal integration run (cargo test --test integration). This indicates the subscription stream closes unexpectedly during require_min_seen gating. The same test passed in a subsequent slow-tests run, suggesting a race or lifecycle issue rather than a deterministic assertion failure.\n\n**Repro**\n- cargo test --test integration (failed on 2026-01-15)\n\n**Files**\n- tests/integration/daemon/subscribe.rs\n- src/daemon/ipc/* (subscribe stream), src/daemon/core.rs (subscribe handling), broadcaster/gating logic","design":"Investigate why the IPC subscription stream closes during require_min_seen gating. Add structured logging around subscribe open/close paths and daemon lifecycle. Verify the daemon is started and the subscribe request is not racing daemon startup or shutdown. If the stream closes due to a specific error (gate timeout, overload, unexpected payload), surface that explicitly instead of a bare disconnect. Stabilize the test by ensuring the daemon is ready before subscribing or by retrying transient disconnects if the daemon is still live.","id":"bd-mrbx","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Integration test failure: subscribe require_min_seen disconnects","type":"bug"}
{"_at":[1769513422110,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] No `unreachable!` or panics for Unknown heads in repl/gap buffer/executor paths.\n- [ ] Types distinguish known vs unknown head states; durable/applied paths only accept known.\n- [ ] Snapshot ingestion/decoding validates head presence explicitly.\n- [ ] All existing tests updated; add one compile-time or conversion test to ensure Unknown cannot reach session state.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769494177983,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`HeadStatus::Unknown` exists in core and can be constructed for any watermark, yet several runtime paths treat it as impossible and `unreachable!()` if it appears. This means the type admits a state the system claims cannot happen. It violates ‚Äútypes tell the truth‚Äù and creates latent panics if a future refactor or new codepath produces Unknown.\n\nKey references:\n- `crates/beads-core/src/watermark.rs:118` ‚Äî `HeadStatus` includes `Unknown`.\n- `crates/beads-rs/src/daemon/repl/session.rs:727` ‚Äî `unreachable!(\"unknown head should never reach session state\")`.\n- `crates/beads-rs/src/daemon/repl/gap_buffer.rs:287` ‚Äî same assumption.\n- `crates/beads-rs/src/daemon/executor.rs:840` ‚Äî ‚Äúdurable watermark head should be known‚Äù.\n\nSeverity: latent panic in WAL/repl and mutation pipelines; correctness depends on a convention rather than an enforced invariant.","design":"**Design**\nEncode ‚Äúknown head‚Äù vs ‚Äúunknown head‚Äù in types rather than runtime branches.\n\nOption A (split enum):\n- `enum HeadKnown { Genesis, Known([u8;32]) }`\n- `enum HeadMaybe { Genesis, Known([u8;32]), Unknown }`\n- `Watermark<K, H>` where H is `HeadKnown` or `HeadMaybe`.\n- Functions that require known heads (durable/applied in repl/gap buffer) only accept `Watermark<_, HeadKnown>`.\n\nOption B (newtypes):\n- `struct DurableHead(HeadStatus)` with `TryFrom<HeadStatus>` enforcing `Genesis|Known`.\n- `Watermark<K>` uses `HeadKnown` for durable/applied; only snapshot inputs use `HeadMaybe` and must be validated to `HeadKnown` before entering session state.\n\nMigration:\n- Update watermark parsing and session snapshot ingestion to return `Result<Watermark<_, HeadKnown>, WatermarkError>` instead of allowing Unknown.\n- Remove `unreachable!` branches; they should become impossible to compile.\n- CLI/admin rendering can still show Unknown by using a distinct ‚Äúmaybe head‚Äù type if needed.\n\nThis follows ‚Äútypes should make time/causality explicit‚Äù and ‚Äúthe controversial type is probably the right type.‚Äù","id":"bd-r13r","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Encode known/unknown head state in Watermark types","type":"bug"}
{"_at":[1768622510913,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622510913,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nConsistent visual styling across all commands requires a shared UI module with status icons, Ayu color palette, and rendering helpers.\n\n**Design**\nCreate `src/cli/ui.rs` module with:\n\n**Status Icons** (small Unicode, NOT emoji blobs):\n- `‚óã` open (neutral, hollow circle)\n- `‚óê` in_progress (yellow, half-filled)\n- `‚óè` blocked (red, filled circle)\n- `‚úì` closed (muted, checkmark)\n- `‚ùÑ` deferred (muted, snowflake)\n- `üìå` pinned (purple, pushpin)\n\n**Ayu Theme Colors** (adaptive light/dark):\n```rust\n// Priority colors\nP0: #f07171 (red, bold)\nP1: #ff8f40 (orange)\nP2: #e6b450 (gold)\nP3/P4: neutral (no color)\n\n// Status colors\nin_progress: #ffb454 (yellow)\nblocked: #f26d78 (red)\nclosed: #8090a0 (muted)\npinned: #d2a6ff (purple)\n\n// Type colors\nbug: #f26d78 (red)\nepic: #d2a6ff (purple)\nothers: neutral\n```\n\n**Rendering Helpers**:\n- `render_status_icon(status)` ‚Üí colored icon\n- `render_priority(pri)` ‚Üí colored \"‚óè P0\"\n- `render_type(type)` ‚Üí colored type badge\n- `render_issue_compact(issue)` ‚Üí one-line format\n- `render_muted(text)` ‚Üí gray text\n\n**Design Principle**: Only actionable states get color. Open/closed use neutral colors; in_progress/blocked demand attention.\n\nReference: `/Users/darin/Projects/beads-rs-macstudio/tmp/beads/internal/ui/styles.go`\n\n**Design Notes**\n- Use `owo-colors` or `yansi` for ANSI colors with RGB support\n- Detect terminal capabilities (TrueColor vs 256 vs basic)\n- Respect NO_COLOR env var and non-TTY output\n- MutedStyle for inactive/closed items\n- BoldStyle for emphasis (P0 priority)\n- Tree characters: `‚éø ` (child), `‚îî‚îÄ ` (last), `  ` (indent)\n\n**Acceptance**\n- [ ] Status icons defined (‚óã ‚óê ‚óè ‚úì ‚ùÑ üìå)\n- [ ] Ayu color palette (adaptive light/dark)\n- [ ] Priority colors (P0 bold red, P1 orange, P2 gold)\n- [ ] Status colors (in_progress yellow, blocked red, closed muted)\n- [ ] Type colors (bug red, epic purple)\n- [ ] Rendering helper functions\n- [ ] Respects NO_COLOR and terminal capabilities\n- [ ] MutedStyle for closed issues (entire line)\n\n**Files:**\n- `src/cli/ui.rs` (new - core styling module)\n- `Cargo.toml` (add owo-colors or yansi)","id":"bd-ze0x.38","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"open","title":"Status icons and Ayu theme styling system","type":"feature"}
