{"_at":[1768909791801,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] New ops encode/decode roundtrip\n- [ ] D1 invalid patches rejected pre-WAL\n\n**Invariants to re-verify**\n- [ ] encode->decode->encode is stable for new ops\n- [ ] D1 semantic validation rejects Keep-based claim/closure patches","assignee":"darin@book","created_at":[1768894651813,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nEvent codec only supports old ops; validation only checks limits.\n\n**Files**\n- src/core/event.rs","design":"Update encode/decode for new Label/Dep ops with dot/dvv. Remove legacy dep ops. Add semantic validation:\n- reject Keep-based workflow/claim patches for touched fields\n- reject legacy full-set labels (no longer encoded)\nKeep size/limits validation.","id":"bd-3zoj.6","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Event encode/decode + semantic validation","type":"task"}
{"_at":[1769769739527,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] Store identity resolution returns a typed `StoreIdResolution` with provenance.\n- [ ] Persisted store-id mappings are only written for verified sources (or explicit confirmation).\n- [ ] Callers can log or surface whether identity is verified vs provisional.\n- [ ] Tests cover conflicting sources and provisional fallback behavior.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769581932200,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nStore identity resolution is implicit and provenance is lost:\n- `StoreCaches::resolve_store_id` tries env override, path cache, on-disk map, git meta, git refs, then remote fallback (`crates/beads-rs/src/daemon/store/discovery.rs`).\n- The caller gets only a `StoreId` with no indication of whether it was verified (git meta) or guessed (remote fallback).\n- The mapping is persisted even for fallback guesses, potentially cementing wrong identity.\n\nThis is implicit + drift risk: multiple sources can disagree, but the code does not encode which source is trusted.\n\n**Files:**\n- `crates/beads-rs/src/daemon/store/discovery.rs`\n- `crates/beads-rs/src/daemon/core.rs`\n- `crates/beads-rs/src/daemon/store/runtime.rs`","design":"**Design**\nMake store identity resolution explicit and type-checked.\n\nConcrete plan:\n1) Introduce a `StoreIdResolution` type with:\n   - `store_id`\n   - `source` (env/path/git_meta/git_refs/remote_fallback)\n   - `verified` (bool or enum: Verified / Unverified)\n2) Update `resolve_store_id` to return `StoreIdResolution` instead of raw `StoreId`.\n3) Only persist/store the mapping when `verified == true` (e.g., git meta/ref) or when explicitly confirmed by the user.\n4) Bubble resolution provenance into logs and into any state initialization that depends on identity.\n5) Add explicit error handling for mismatched sources (e.g., git meta vs git refs disagree).\n\n**Design Notes**\n- Remote fallback should be treated as provisional until confirmed by git meta.\n- This keeps identity semantics explicit and makes guessing visible in types.","id":"bd-iorm","labels":{"cc":{"max":{}},"entries":{"consistency":[{"counter":12001613734123142000,"replica":"32c75fe9-f686-d5a2-bfdc-2d97956c40ab"}],"identity":[{"counter":5287405369260036149,"replica":"f765274a-9fc9-04bd-d99d-ed7dce956be1"}],"implicit":[{"counter":7051363103046783700,"replica":"f951b638-1dd7-f002-1247-f9fe8f5e8d06"}]}},"priority":2,"status":"closed","title":"Make store identity resolution explicit and verified","type":"chore"}
