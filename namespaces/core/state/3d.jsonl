{"_at":[1768450850071,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768444163141,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nREALTIME_PLAN §5.2.3/§5.2.3 require marking rotated segments as sealed with final_len recorded in wal.sqlite. Current runtime writes segments with sealed=false and never updates them when rotation happens (AppendOutcome.rotated is unused). Sealing only occurs during replay rebuild, so live index misses sealed/final_len invariants.\n\nEvidence:\n- src/daemon/executor.rs:264–282 upsert_segment always uses sealed=false, final_len=None.\n- src/daemon/core.rs:1041–1066 does the same for replication ingest.\n- SegmentWriter::append returns AppendOutcome.rotated, but no caller updates sealed/final_len.\n\n**Why this violates plan**\nPlan mandates sealed segments be recorded at rotation time and validated on startup (file_len == final_len). Without this, on-disk corruption and partial writes can go undetected.\n\n**Acceptance**\n- [ ] On segment rotation, mark previous segment sealed=1 and final_len in wal.sqlite.\n- [ ] Ensure index updates are atomic with segment rotation.\n- [ ] Admin/status and replay enforce sealed invariants for live-written segments, not just rebuild.","id":"bd-3m5.83","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"WAL segment sealing not recorded on rotation","type":"bug"}
{"_at":[1766124452636,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@dusk","created_at":[1766116455465,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`init_beads_ref` fetches and force-updates `refs/heads/beads/store` to remote even if a local ref already exists. If local has data, this can overwrite it.\n\n**Design**\nIf local ref exists, treat init as a no-op (already initialized). Only fast-forward local when it does not exist. Never force-update without preserving local history. Add a test that ensures init does not modify an existing local ref.\n\n**Acceptance**\n- [ ] init is a no-op when local ref exists\n- [ ] No forced updates on existing local refs\n- [ ] Tests cover init with existing local ref\n- [ ] Tests pass\n\n**Files:** src/git/sync.rs","id":"bd-vb0","labels":{"cc":{"max":{}},"entries":{}},"priority":0,"status":"closed","title":"init_beads_ref must not overwrite existing local ref","type":"bug"}
