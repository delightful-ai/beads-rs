{"_at":[1768538827687,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768508732473,1],"darin@book"],"claim":[[1768536780447,1],"darin@book"],"description":[[1768508732473,1],"darin@book"],"design":[[1768508732473,1],"darin@book"],"estimated_minutes":[[1768508732473,1],"darin@book"],"external_ref":[[1768508732473,1],"darin@book"],"labels":[[1768508732473,1],"darin@book"],"priority":[[1768508732473,1],"darin@book"],"source_repo":[[1768508732473,1],"darin@book"],"title":[[1768508732473,1],"darin@book"],"type":[[1768508732473,1],"darin@book"]},"acceptance_criteria":"- [ ] Canonical store state lives in `StoreRuntime`, not `RepoState`.\n- [ ] Git lane metadata lives in `GitLaneState` (renamed file/module).\n- [ ] No name collision with `src/repo.rs`.\n- [ ] Tests pass.","assignee":"darin@book","assignee_at":[1768536780447,1],"assignee_expires":1768540380447,"closed_at":[1768538827687,1],"closed_by":"darin@book","created_at":[1768508732473,1],"created_by":"darin@book","description":"**Problem**\n- `RepoState` owns canonical `StoreState` plus git lane metadata, mixing concerns.\n- `StoreRuntime` holds `repo_state`, so store state is indirectly coupled to git operations.\n- `RepoState` name conflicts with `src/repo.rs` and is easy to open by mistake.\n\n**Files:**\n- src/daemon/repo.rs\n- src/daemon/store_runtime.rs\n- src/daemon/core.rs\n- src/git/sync.rs (only if types are referenced)","design":"- Move `StoreState` ownership into `StoreRuntime` (`state: StoreState`).\n- Rename `RepoState` to `GitLaneState` (or `CheckpointLaneState`) and keep only git/checkpoint metadata there.\n- Update `Daemon` maps to store `GitLaneState` separately from store runtime.\n- Remove unused fields like `wal_sequence` if they are now owned by WAL.\n- Update all references/imports.","id":"bd-1h02","labels":[],"priority":2,"status":"closed","title":"Decouple StoreState from RepoState (rename RepoState)","type":"chore"}
{"_at":[1768432817252,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768431984087,1],"darin@book"],"claim":[[1768432640861,1],"darin@book"],"description":[[1768431984087,1],"darin@book"],"design":[[1768431984087,1],"darin@book"],"estimated_minutes":[[1768431984087,1],"darin@book"],"external_ref":[[1768431984087,1],"darin@book"],"labels":[[1768431984087,1],"darin@book"],"priority":[[1768431984087,1],"darin@book"],"source_repo":[[1768431984087,1],"darin@book"],"title":[[1768431984087,1],"darin@book"],"type":[[1768431984087,1],"darin@book"]},"assignee":"darin@book","assignee_at":[1768432640861,1],"assignee_expires":1768436240861,"closed_at":[1768432817252,1],"closed_by":"darin@book","closed_reason":"Switched tests to thread-local override_data_dir_for_tests; removed lock usage and added allow(dead_code) on lock APIs.","created_at":[1768431984087,1],"created_by":"darin@book","description":"**Problem**\\nUnit tests that override data dir grab a global lock (paths::lock_data_dir_for_tests) and serialize across the suite. This blocks parallel test execution and shows up as time spent waiting.\\n\\n**Design**\\nUse thread-local DataDirOverride (paths::override_data_dir_for_tests) in unit tests instead of global set_data_dir_for_tests + lock. Update affected tests to use RAII guard. Keep lock-based API for cases that truly need cross-thread overrides.\\n\\n**Acceptance**\\n- [ ] Tests no longer use lock_data_dir_for_tests when not needed\\n- [ ] Data dir override is scoped and does not leak\\n- [ ] Tests still pass in parallel\\n\\n**Files**: src/git/checkpoint/cache.rs, src/daemon/store_runtime.rs, src/daemon/core.rs","id":"bd-mvd","labels":[],"priority":1,"status":"closed","title":"Remove global test data dir lock by using thread-local overrides","type":"task"}
