{"_at":[1768528250108,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768506341917,1],"darin@book"],"claim":[[1768527623794,1],"darin@book"],"description":[[1768506341917,1],"darin@book"],"design":[[1768506341917,1],"darin@book"],"estimated_minutes":[[1768506341917,1],"darin@book"],"external_ref":[[1768506341917,1],"darin@book"],"labels":[[1768506341917,1],"darin@book"],"priority":[[1768506341917,1],"darin@book"],"source_repo":[[1768506341917,1],"darin@book"],"title":[[1768506341917,1],"darin@book"],"type":[[1768506341917,1],"darin@book"]},"acceptance_criteria":"- [ ] `StoreRuntime::open` rejects incompatible `StoreMeta` versions with a structured error.\n- [ ] Only one canonical set of format/protocol constants exists.\n- [ ] Tests cover version mismatch and regression on constant drift.","assignee":"darin@book","assignee_at":[1768527623794,1],"assignee_expires":1768531223794,"closed_at":[1768528250108,1],"closed_by":"darin@book","created_at":[1768506341917,1],"created_by":"darin@book","description":"**Problem**\n`StoreRuntime::open` accepts existing `StoreMeta` without validating `store_format_version`, `wal_format_version`, `checkpoint_format_version`, `replication_protocol_version`, or `index_schema_version`. This means a daemon can silently run against an unsupported store layout. Also, format/version constants are duplicated across modules (`store_runtime.rs`, `wal/segment.rs`, `wal/index.rs`, `repl/proto.rs`), which is brittle and can drift.\n\n**Files**\n- src/daemon/store_runtime.rs\n- src/core/store_meta.rs\n- src/daemon/wal/segment.rs\n- src/daemon/wal/index.rs\n- src/daemon/repl/proto.rs\n","design":"**Design**\n- Add a single source of truth for format/protocol versions (e.g., `core::versions` or `StoreMetaVersions::current()` with associated consts).\n- In `StoreRuntime::open`, validate existing `StoreMeta` against the current versions and return a dedicated error (e.g., `StoreRuntimeError::UnsupportedVersion { expected, got }`) on mismatch.\n- Update WAL/index/proto modules to import the shared constants instead of redefining their own.\n- Add tests to cover mismatch handling and ensure constants are used consistently.","id":"bd-rfit","labels":[],"priority":2,"status":"closed","title":"Validate StoreMeta versions + centralize format constants","type":"chore"}
