{"_at":[1768518479906,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768503185869,1],"darin@book"],"claim":[[1768516837695,1],"darin@book"],"description":[[1768503185869,1],"darin@book"],"design":[[1768503185869,1],"darin@book"],"estimated_minutes":[[1768503185869,1],"darin@book"],"external_ref":[[1768503185869,1],"darin@book"],"labels":[[1768503185869,1],"darin@book"],"priority":[[1768503185869,1],"darin@book"],"source_repo":[[1768503185869,1],"darin@book"],"title":[[1768503185869,1],"darin@book"],"type":[[1768503185869,1],"darin@book"]},"acceptance_criteria":"- [ ] `EventBody` no longer has optional `hlc_max` or top-level `delta` fields.\n- [ ] `TxnV1` always includes `hlc_max` and `delta`, and `EventKindV1::TxnV1` carries it.\n- [ ] encode/decode enforces HLC presence; no runtime \"event missing hlc_max\" error.\n- [ ] Updated event/repl tests pass.","assignee":"darin@book","assignee_at":[1768516837695,1],"assignee_expires":1768520437695,"closed_at":[1768518479906,1],"closed_by":"darin@book","created_at":[1768503185869,1],"created_by":"darin@book","description":"**Problem**\n`src/core/event.rs` defines `EventBody { delta: TxnDeltaV1, hlc_max: Option<HlcMax> }` and `EventKindV1::TxnV1` carries no data. The realtime plan + `beads_stateright_models/src/realtime_types_sketch.rs` expect `EventKindV1::TxnV1(TxnV1{hlc_max, delta})`. The optional `hlc_max` lets invalid events exist; the executor currently errors at runtime when it is missing (\"event missing hlc_max\"). Invariants are not encoded in the type system.\n\n**Files**\n- src/core/event.rs\n- src/daemon/mutation_engine.rs\n- src/daemon/executor.rs\n- src/daemon/repl/proto.rs (tests)\n- other event encode/decode callers","design":"Refactor the event model to match the sketch:\n- Introduce `TxnV1 { hlc_max: HlcMax, delta: TxnDeltaV1 }`.\n- Change `EventKindV1` to `TxnV1(TxnV1)`.\n- Remove `EventBody.delta` and `EventBody.hlc_max`.\n- Update canonical encode/decode to require HLC max for txn bodies; decide whether to accept legacy payloads for compatibility or reject them explicitly.\n- Update apply/verification paths and tests to construct the new `EventKindV1::TxnV1` payload.","id":"bd-5xm","labels":[],"priority":2,"status":"closed","title":"EventBody: move hlc_max+delta into EventKindV1::TxnV1","type":"chore"}
