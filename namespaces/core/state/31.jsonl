{"_at":[1768518479906,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] `EventBody` no longer has optional `hlc_max` or top-level `delta` fields.\n- [ ] `TxnV1` always includes `hlc_max` and `delta`, and `EventKindV1::TxnV1` carries it.\n- [ ] encode/decode enforces HLC presence; no runtime \"event missing hlc_max\" error.\n- [ ] Updated event/repl tests pass.","assignee":"darin@book","created_at":[1768503185869,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`src/core/event.rs` defines `EventBody { delta: TxnDeltaV1, hlc_max: Option<HlcMax> }` and `EventKindV1::TxnV1` carries no data. The realtime plan + `beads_stateright_models/src/realtime_types_sketch.rs` expect `EventKindV1::TxnV1(TxnV1{hlc_max, delta})`. The optional `hlc_max` lets invalid events exist; the executor currently errors at runtime when it is missing (\"event missing hlc_max\"). Invariants are not encoded in the type system.\n\n**Files**\n- src/core/event.rs\n- src/daemon/mutation_engine.rs\n- src/daemon/executor.rs\n- src/daemon/repl/proto.rs (tests)\n- other event encode/decode callers","design":"Refactor the event model to match the sketch:\n- Introduce `TxnV1 { hlc_max: HlcMax, delta: TxnDeltaV1 }`.\n- Change `EventKindV1` to `TxnV1(TxnV1)`.\n- Remove `EventBody.delta` and `EventBody.hlc_max`.\n- Update canonical encode/decode to require HLC max for txn bodies; decide whether to accept legacy payloads for compatibility or reject them explicitly.\n- Update apply/verification paths and tests to construct the new `EventKindV1::TxnV1` payload.","id":"bd-5xm","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"EventBody: move hlc_max+delta into EventKindV1::TxnV1","type":"chore"}
{"_at":[1768819579271,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768778636743,0],"created_by":"darin@darinsmcstudio2.lan","description":"Use src/test_harness (ReplicationRig/TestWorld) to cover common replication scenarios (roundtrip, tailnet profile, crash/restart, durability receipts) without spawning daemons or tailnet_proxy. Keep 1-2 daemon E2E tests for IPC/real network, but shift most coverage to fast in-process tests.","id":"bd-mzlo","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Move some repl_e2e coverage to in-process test_harness","type":"chore"}
{"_at":[1769221304333,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Tests: invalid claim combos (Clear+Set, Set+Clear where disallowed) are rejected by validation.\\n- [ ] Tests: valid claim combos are accepted and apply deterministically.\\n- [ ] Tests: workflow status set requires explicit closure fields (already validated).\\n- [ ] Encoder/mutation_engine only accepts validated patch types.","assignee":"darin@book","created_at":[1769209800591,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\\nClaim validation only checks Keep mismatch; it allows explicit but nonsensical combos (e.g., assignee Clear with expires Set). Workflow/claim patches can be constructed in invalid states, then only fail at apply or produce odd semantics.\\n\\n**Files**: src/core/event.rs, src/core/apply.rs, src/core/wire_bead.rs, src/daemon/mutation_engine.rs","design":"**Design**\\nIntroduce explicit patch enums to make invalid states unrepresentable (typestate):\\n- WorkflowPatch::{NoChange, SetStatus{status, closed_reason, closed_on_branch}}\\n- ClaimPatch::{NoChange, Clear, Set{assignee, expires}}\\nConvert WireBeadPatch to carry these in a backward-compatible way or add validated newtypes (ValidatedBeadPatch) used by encoder/mutation_engine.\\n\\nUpdate validate_bead_patch_semantics to reject impossible explicit claim combos if full typestate is too invasive. Ensure apply remains total for all explicit combinations allowed by validator.","id":"bd-qz97.7","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Claim/workflow patch validation: tighten rules + typestate patch types","type":"bug"}
{"_at":[1768802314240,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768778081415,0],"created_by":"darin@darinsmcstudio2.lan","description":"tests/integration/fixtures/tailnet_proxy.rs waits for listen by polling bind+sleep. Add a readiness signal to tailnet_proxy (e.g., --ready-file) and wait on that instead to reduce polling and tighten timeouts.","id":"bd-ws6v","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Tailnet proxy readiness uses bind polling; add ready-file/handshake","type":"chore"}
