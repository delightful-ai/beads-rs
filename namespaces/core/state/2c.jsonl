{"_at":[1769543599576,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] It is impossible to construct a header with `request_sha256` but no `client_request_id` (compile‑time enforced).\n- [ ] Encode/decode APIs operate on the typed representation only.\n- [ ] All call sites updated; no ad‑hoc header struct literals remain.\n- [ ] Tests cover encode/decode round‑trip and reject invalid bytes at the boundary.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769501207924,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`RecordHeader` allows invalid combinations of flags/fields that are only rejected at encode/decode time. The compiler cannot prevent constructing headers where `request_sha256` is present without `client_request_id`, or other invalid flag/field pairings.\n\nKey refs:\n- `crates/beads-rs/src/daemon/wal/record.rs:65` (RecordHeader)\n- `crates/beads-rs/src/daemon/wal/record.rs:103` (encode-time validation)\n\n**Impact**\nWAL integrity depends on runtime checks. Any new constructor or refactor can accidentally build an invalid header that compiles and fails later.","design":"**Design (opinionated)**\nEncode header invariants in the type system with an enum or structured subtype.\n\nOption A (enum):\n```rust\nenum RecordHeader {\n  NoClientRequest { /* fields */ },\n  WithClientRequest { client_request_id: ClientRequestId, request_sha256: Option<[u8;32]>, /* fields */ }\n}\n```\n- Encode/decode produce one of these variants.\n- There is no state where `request_sha256` exists without `client_request_id`.\n\nOption B (struct with nested request):\n```rust\nstruct RecordHeader { common: CommonFields, request: Option<RequestMeta> }\nstruct RequestMeta { id: ClientRequestId, request_sha256: Option<[u8;32]> }\n```\n- Constructors enforce that `request_sha256` cannot exist without `RequestMeta`.\n\nMake invalid combinations unrepresentable, not just validated at runtime.","id":"bd-123u","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Encode WAL RecordHeader invariants in types","type":"bug"}
{"_at":[1768798821337,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768798571480,0],"created_by":"darin@darinsmcstudio2.lan","description":"cargo clippy -D warnings fails due to nested if in src/daemon/export_worker.rs:63. Collapse the if per clippy suggestion or add allow with rationale.","id":"bd-1lzt","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Clippy collapsible_if in export_worker.rs:63","type":"chore"}
{"_at":[1765775210547,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@dusk","created_at":[1765744499553,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nCannot change a beads type after creation. Had to close bd-d37 and recreate as epic bd-2fr.\n\n**Solution**\nAdd `--type` flag to `bd update`:\n```\nbd update <id> --type=epic\n```\n\n**Design Notes**\n- Should validate type is one of: task, bug, feature, epic, chore\n- Type changes should be LWW like other fields\n- Consider if changing TO epic should warn if bead has no children\n- Consider if changing FROM epic should warn if bead has children\n\n**Acceptance**\n- [ ] `bd update --type <TYPE>` works\n- [ ] Invalid types rejected with clear error\n- [ ] Type change reflected in `bd show`","id":"bd-3t9","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Add --type flag to bd update command","type":"feature"}
{"_at":[1770590738233,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769815046164,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nParent dependencies should reject cycles (A's parent is B, B's parent is A), but currently allow them. The test `test_parent_deps_reject_cycles` expects failure with \"circular\" or \"cycle\" in stderr, but the operation succeeds.\n\nNote: Related dependencies (`--kind=related`) intentionally allow cycles, but parent dependencies should not.\n\n**Files:**\n- `crates/beads-rs/tests/integration/cli/critical_path.rs` (test at line ~1800)\n- `crates/beads-rs/src/daemon/mutation_engine.rs` (likely validation logic)\n- `crates/beads-core/src/dep.rs` (dependency validation)\n\n**Design**\nThe mutation engine or dep validation should check for cycles when adding parent deps. Likely need to traverse the parent chain and reject if adding this edge would create a cycle.\n\n**Acceptance**\n- [ ] `bd dep add A B --kind=parent` fails if B is already an ancestor of A\n- [ ] Error message contains \"circular\" or \"cycle\"\n- [ ] `test_parent_deps_reject_cycles` passes\n- [ ] Related deps still allow cycles (existing behavior)","id":"bd-n15q","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Parent dependency cycles not rejected - test_parent_deps_reject_cycles fails","type":"bug"}
{"_at":[1768622383738,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622383738,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbeads-rs currently lacks the molecule system that exists in Go beads. Molecules are foundational - they're the workflow template system that enables complex agent orchestration.\n\n**What are Molecules?**\nMolecules are workflow templates (protos) that can be instantiated. They're the same as epics but with workflow semantics:\n- Proto (solid): Template epic with 'template' label\n- Mol (liquid): Poured instance → persistent, syncs to git\n- Wisp (vapor): Ephemeral instance → local only, auto-cleanup\n\n**Core Fields**\n- mol_type: enum (swarm/patrol/work)\n- bonded_from: Vec<BondRef> for compound molecules\n- Ephemeral: bool flag (wisps vs persistent mols)\n\n**Design**\nThe molecule system layers on top of existing epics/dependencies. No separate storage needed - just:\n1. Add molecule-specific fields to Issue type\n2. Add template label handling\n3. Implement instantiation logic (variable substitution)\n\n**Files to Study (Go beads)**\n- cmd/bd/mol.go - molecule commands structure\n- cmd/bd/template.go - template loading and instantiation\n- internal/types/types.go - Issue fields for molecules\n- docs/MOLECULES.md - conceptual overview\n\n**Acceptance**\n- [ ] Issue type extended with molecule fields\n- [ ] Template label recognized\n- [ ] Basic instantiation works (pour proto → mol)\n- [ ] Tests for molecule CRDT semantics\n","id":"bd-ze0x.1","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":13251068344367108153,"replica":"8bede988-ad34-cd1e-689c-a6cd3c458a16"}]}},"priority":1,"status":"open","title":"Add molecule infrastructure to beads-rs","type":"epic"}
