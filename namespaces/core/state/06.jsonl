{"_at":[1770499795050,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] CLI no longer imports `crate::daemon::run_daemon`\n- [ ] Wrapper location documented\n- [ ] Runtime behavior preserved","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770498233410,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nCLI entrypoint calls daemon runtime internals directly from CLI module tree.","design":"Introduce a thin non-CLI wrapper boundary so CLI code stops importing daemon modules directly.","id":"bd-21eg.10","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Add CLI daemon-run wrapper to remove direct daemon module dependency","type":"chore"}
{"_at":[1767992950308,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] New model file exists (e.g., beads_stateright_models/examples/fairness_bounds_machine.rs) and compiles\n- [ ] Properties cover bounded queues and no starvation for core under sustained wf churn (todo.md Model #7)\n- [ ] Model doc comments reference REALTIME_PLAN.md §0.19 and §9.8\n- [ ] Example runs via cargo run --example fairness_bounds_machine (or equivalent)","assignee":"darin@darinsmacstudio.lan","created_at":[1767985341005,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nThe plan mandates bounds (MAX_FRAME_BYTES, MAX_EVENT_BATCH_BYTES, gap buffer caps) and fairness across namespaces/origins (REALTIME_PLAN.md §0.19, §9.8). There is no model that checks starvation and bounded queues.\n\n**Design Notes**\nModel cost as small integers; focus on fairness and bounded buffers rather than exact byte sizes.","design":"**Design**\nBuild a Stateright model for bounded buffers and fair scheduling across namespaces/origins. The model should include: bounded gap buffer per origin, in-flight event limits, and a round-robin scheduler that selects per-(ns, origin) batches with caps (Plan §9.8).\n\nProperties: buffers never exceed configured bounds (Plan §0.19), and no starvation for core when wf is high churn (todo.md Model #7).\n\nThe model can reuse limits constants from realtime_types_sketch.rs or define tiny constants in the example.","id":"bd-hjm.7","labels":{"cc":{"max":{}},"entries":{"modeling":[{"counter":18414178269261525469,"replica":"c804cd31-ce48-56e7-7d77-02a84bb35ab4"}],"realtime":[{"counter":3089061322524959751,"replica":"6754632e-c9e4-a34d-7e36-a7dd50c366ed"}],"stateright":[{"counter":7323072469460752563,"replica":"62c65438-e9b6-4a60-8517-2fa7da20a288"}]}},"priority":2,"status":"closed","title":"Stateright: resource bounds + fairness across namespaces","type":"feature"}
{"_at":[1768622401969,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622401969,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbeads-rs lacks the Gate issue type - an async coordination primitive that blocks workflow steps until conditions are met. This is a major swarm coordination feature used for GitHub CI, PR merges, timers, human approvals, and cross-rig bead dependencies.\n\n**What Gates Do (from Go beads)**\nGates are async wait conditions created automatically by formula steps. They block dependent steps until resolved. Gate types:\n- human: Manual resolution via bd close\n- timer: Auto-expires after timeout\n- gh:run: Waits for GitHub Actions workflow\n- gh:pr: Waits for PR merge  \n- bead: Waits for cross-rig bead completion (await_id format: <rig>:<bead-id>)\n\n**Go Implementation**\nType definition in internal/types/types.go:\n- IssueType = TypeGate\n- Fields: AwaitType (string), AwaitID (string), Timeout (Duration), Waiters ([]string)\n- Waiters are notified when gate clears\n\nCLI in cmd/bd/gate.go:\n- bd gate list [--all] - List open/closed gates\n- bd gate show <id> - Show gate details\n- bd gate resolve <id> [--reason] - Manually close gate\n- bd gate check [--type] [--dry-run] [--escalate] - Evaluate gates, auto-close resolved\n- bd gate add-waiter <id> <waiter> - Register for wake notification\n\nGate checking (bd gate check):\n- gh:run: Uses gh CLI to check workflow status/conclusion\n- gh:pr: Uses gh CLI to check PR state/merged\n- timer: Compares current time to created_at + timeout\n- bead: Cross-rig database lookup for target bead status\n\nSchema (internal/storage/sqlite/schema.go):\nMigration 027_gate_columns.go adds await_type, await_id, timeout, waiters columns.\n\n**Design for Rust**\nData model (src/core/):\n```rust\npub enum GateType {\n    Human,\n    Timer,\n    GhRun,\n    GhPr,\n    Bead,\n}\n\npub struct GateData {\n    await_type: GateType,\n    await_id: Option<String>,\n    timeout: Option<Duration>,\n    waiters: Vec<String>,\n}\n```\n\nAdd GateData to Bead enum variants or use optional fields in Bead struct.\n\nCLI surface (src/cli/):\n- bd gate list [--all]\n- bd gate show <id>\n- bd gate resolve <id> [--reason]\n- bd gate check [--type] [--dry-run]\n- bd gate add-waiter <id> <waiter>\n\nGate checking logic:\n- Integrate with gh CLI (Command::new(\"gh\"))\n- Cross-rig bead lookup via git2 (open remote db read-only)\n- Timer expiration via SystemTime\n\n**Design Notes**\n- Gate type is structural (specific fields) not just an enum\n- Waiters enable push notifications (reactive vs polling)\n- Cross-rig bead gates need multi-repo access\n- gh CLI integration is external dependency\n- Escalation (failed/expired gates) needs notification system\n\n**Acceptance**\n- [ ] GateType enum and GateData struct defined in src/core/\n- [ ] Bead can hold gate-specific fields\n- [ ] bd gate list/show/resolve commands work\n- [ ] bd gate check evaluates timer gates\n- [ ] bd gate check evaluates gh:run gates (if gh CLI available)\n- [ ] bd gate check evaluates gh:pr gates (if gh CLI available)\n- [ ] bd gate check evaluates bead gates (cross-rig lookup)\n- [ ] Waiters list can be modified via add-waiter\n- [ ] Tests for gate CRDT merge behavior\n- [ ] Migration from Go beads preserves gate fields\n\n**Files to study in Go beads:**\n- tmp/beads/internal/types/types.go (lines 93-97: Gate fields)\n- tmp/beads/cmd/bd/gate.go (entire file: CLI implementation)\n- tmp/beads/internal/storage/sqlite/migrations/027_gate_columns.go\n- tmp/beads/cmd/bd/gate_test.go","id":"bd-ze0x.5","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":12771606559369402638,"replica":"de612653-07b8-2d48-206c-20b859969691"}]}},"priority":2,"status":"open","title":"Add Gate issue type support","type":"feature"}
