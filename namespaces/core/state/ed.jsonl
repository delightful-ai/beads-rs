{"_at":[1768256192277,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768252077046,1],"darin@darinsmacstudio.lan"],"claim":[[1768252077046,1],"darin@darinsmacstudio.lan"],"description":[[1768252139146,1],"darin@darinsmacstudio.lan"],"design":[[1768252077046,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768252077046,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768252077046,1],"darin@darinsmacstudio.lan"],"labels":[[1768252077046,1],"darin@darinsmacstudio.lan"],"priority":[[1768252077046,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768252077046,1],"darin@darinsmacstudio.lan"],"title":[[1768252077046,1],"darin@darinsmacstudio.lan"],"type":[[1768252077046,1],"darin@darinsmacstudio.lan"]},"closed_at":[1768256192277,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768252077046,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nRecord header fields (origin_replica_id, origin_seq, event_time_ms, txn_id, client_request_id) are not validated against decoded EventBody bytes during replay or fsck. Corrupted headers can silently diverge while sha matches payload. REALTIME_PLAN.md 5.2 requires header consistency checks.\n\n**Design**\nDecode EventBody from Record.payload using core::decode_event_body (limits) in replay and fsck; compare fields with RecordHeader. On mismatch:\n- fsck: report corruption (new FsckEvidenceCode) and quarantine/repair per mode.\n- replay: return explicit WalReplayError (non-tail corruption).\nAdd tests with a record whose payload is valid but header is tampered; assert fsck reports mismatch and replay errors.\n\n**Acceptance**\n- [ ] Header/body mismatches are detected in replay and fsck.\n- [ ] Fsck report includes deterministic evidence code.\n- [ ] Tests cover header mismatch path; cargo test passes.\n\n**Files:** src/daemon/wal/replay.rs, src/daemon/wal/fsck.rs, src/daemon/wal/record.rs, tests/phase3_fsck.rs","id":"bd-796","labels":[],"priority":2,"status":"closed","title":"Validate WAL record header vs EventBody payload","type":"bug"}
