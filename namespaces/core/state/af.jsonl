{"_at":[1770519281888,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] No `crate::daemon` imports under CLI crate/module tree\n- [ ] `beads-cli` and `beads-daemon` compile as independent crates\n- [ ] Boundary lint gates forbidden edges in CI\n- [ ] Surface/API contracts are single-source (no duplicate protocol models)\n- [ ] Full verification: `cargo check`, `cargo clippy --all-features -- -D warnings`, `cargo test`, `cargo test --features slow-tests`, `just dylint`","closed_reason":"All child beads closed; boundary cleanup epic acceptance criteria satisfied","created_at":[1770498164851,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`beads-rs` still has direct CLI->daemon coupling (`crate::daemon::*`) despite `beads-surface`/`beads-api` existing as boundary crates. This increases scatter and weakens locality of reasoning: CLI behavior depends on daemon internals instead of a single typed contract.\n\n**Goal**\nFinish boundary cleanup and split runtime into isolated crates while preserving behavior:\n- `beads-cli` depends on `beads-surface` (+ `beads-api` as needed), not `beads-daemon`\n- `beads-daemon` owns daemon internals and runtime wiring\n- shared contracts stay in `beads-surface`/`beads-api` with typed, explicit boundaries\n- no drift/duplication of protocol or schema types\n\n**Target DAG**\n`beads-core <- beads-api <- beads-surface <- {beads-cli, beads-daemon}`\n\nForbidden edges:\n- `beads-cli -> beads-daemon`\n- `beads-surface -> beads-cli|beads-daemon`\n- `beads-api -> beads-surface|beads-cli|beads-daemon`","design":"Stage work in narrow, reversible phases:\n1) boundary inventory + lint enforcement,\n2) CLI boundary cleanup,\n3) missing boundary API extraction (fsck/lock/patch validation),\n4) daemon crate split,\n5) CLI crate split,\n6) shared daemon-core extraction for model/fuzz/stateright consumers,\n7) cleanup + shims removal.\n\nUse typed outputs at boundaries (`beads-api` structs/enums), avoid stringly errors, and keep one source of truth per concept.","id":"bd-21eg","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Phase 2 crate boundary cleanup: split daemon+cli with typed surface contracts","type":"epic"}
{"_at":[1768798540012,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768777674711,0],"created_by":"darin@darinsmcstudio2.lan","description":"tests/integration/fixtures/admin_status.rs collect_for sleeps at fixed intervals. Use ReadConsistency require_min_seen + wait_timeout_ms to block until watermarks advance (or expose a wait-for-status helper) so sampling isnâ€™t busy-waiting. Update admin_status tests accordingly.","id":"bd-b54o","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"StatusCollector collect_for uses fixed sleep; sample on watermark changes","type":"chore"}
{"_at":[1768428842957,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768273170014,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nRunning cargo test spawns daemon processes in temp directories that don't get cleaned up.\n\n```bash\npgrep -fl 'bd daemon run' | wc -l\n# Returns 50+\n```\n\nMost are from test temp dirs like:\n- /var/folders/.../beads-test-runtime-*/daemon.sock\n- /var/folders/.../.tmpXXXX/daemon.sock\n\n**Design**\n- Test fixtures should kill daemon processes on drop\n- Or use daemon shutdown request in test teardown\n- Consider `atexit` handler or test wrapper\n\n**Acceptance**\n- [ ] Daemon count doesn't grow after running cargo test\n- [ ] Test cleanup kills spawned daemons","id":"bd-gna","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Test daemons not cleaned up: 50+ orphan bd daemon processes","type":"bug"}
{"_at":[1769772131433,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769309224422,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n8 parser functions are scattered in src/cli/mod.rs (lines 1598-1770), mixed with unrelated code:\n\n- `parse_bead_type()` (line 1637)\n- `parse_priority()` (line 1649)\n- `parse_status()` (line 1668)\n- `parse_dep_kind()` (line 1679)\n- `parse_sort()` (line 1683)\n- `parse_time_ms_opt()` (line 1708)\n- `parse_time_ms()` (line 1723)\n- `parse_dep_edge()` (line 1750)\n\nThese are all clap value_parser functions that convert strings to domain types. Having them in mod.rs hurts discoverability and bloats the file.\n\n**Design**\n1. Create `src/cli/parsers.rs`\n2. Move all 8 parser functions there\n3. Make them `pub(crate)` \n4. Update imports in mod.rs and any command handlers that use them directly\n\n```rust\n// src/cli/parsers.rs\nuse crate::core::{BeadType, Priority, WorkflowStatus};\nuse crate::daemon::query::{DepKind, SortField};\n\npub(crate) fn parse_bead_type(s: &str) -> Result<BeadType, String> { ... }\npub(crate) fn parse_priority(s: &str) -> Result<Priority, String> { ... }\npub(crate) fn parse_status(s: &str) -> Result<WorkflowStatus, String> { ... }\npub(crate) fn parse_dep_kind(s: &str) -> Result<DepKind, String> { ... }\npub(crate) fn parse_sort(s: &str) -> Result<SortField, String> { ... }\npub(crate) fn parse_time_ms_opt(s: &str) -> Result<Option<u64>, String> { ... }\npub(crate) fn parse_time_ms(s: &str) -> Result<u64, String> { ... }\npub(crate) fn parse_dep_edge(s: &str) -> Result<(String, String), String> { ... }\n```\n\n```rust\n// src/cli/mod.rs\nmod parsers;\nuse parsers::*; // or explicit imports\n```\n\n**Acceptance**\n- [ ] src/cli/parsers.rs created with all 8 parser functions\n- [ ] src/cli/mod.rs imports from parsers module\n- [ ] No parser functions remain in mod.rs\n- [ ] All #[arg(value_parser = ...)] references still work\n- [ ] cargo clippy passes\n- [ ] cargo test passes\n\n**Files:** src/cli/mod.rs, src/cli/parsers.rs (new)","id":"bd-jc2z","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Extract cli/parsers.rs module for argument parsers","type":"chore"}
