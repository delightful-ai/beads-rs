{"_at":[1768246638048,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768180763865,1],"darin@darinsmacstudio.lan"],"claim":[[1768246071336,1],"darin@darinsmacstudio.lan"],"description":[[1768180763865,1],"darin@darinsmacstudio.lan"],"design":[[1768180763865,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768180763865,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768180763865,1],"darin@darinsmacstudio.lan"],"labels":[[1768180763865,1],"darin@darinsmacstudio.lan"],"priority":[[1768180763865,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768180763865,1],"darin@darinsmacstudio.lan"],"title":[[1768180763865,1],"darin@darinsmacstudio.lan"],"type":[[1768180763865,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@darinsmacstudio.lan","assignee_at":[1768246071336,1],"assignee_expires":1768249671336,"closed_at":[1768246638048,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768180763865,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nPhase 3 tests need WAL segment fixtures and SQLite test helpers.\n\n**Context**\n- REALTIME_PLAN.md ยง18: WAL framing, tail truncation, index rebuild\n- Blocks Phase 3 testing bead\n\n**Design**\nCreate test infrastructure:\n- Temp WAL directory helpers (namespace subdirs, segment files)\n- Segment file fixtures: valid, corrupted (bad crc), partial (truncated mid-record)\n- SQLite test database setup/teardown\n- WAL record builders with known bytes\n- Crash simulation helpers (write partial record, kill before fsync)\n\n**Acceptance**\n- [ ] tests/fixtures/wal.rs with TempWalDir, segment file generators\n- [ ] tests/fixtures/wal_corrupt.rs with corruption injection helpers\n- [ ] Fixtures include: valid segment, bad-crc segment, truncated segment\n- [ ] cargo test fixtures::wal passes\n\n**Files:** tests/fixtures/wal.rs (new), tests/fixtures/wal_corrupt.rs (new)","id":"bd-3m5.57","labels":[],"priority":2,"status":"closed","title":"Phase 3 test infrastructure: WAL fixtures + segment helpers","type":"task"}
{"_at":[1768522037086,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768503245771,1],"darin@book"],"claim":[[1768521672942,1],"darin@book"],"description":[[1768503245771,1],"darin@book"],"design":[[1768503245771,1],"darin@book"],"estimated_minutes":[[1768503245771,1],"darin@book"],"external_ref":[[1768503245771,1],"darin@book"],"labels":[[1768503245771,1],"darin@book"],"priority":[[1768503245771,1],"darin@book"],"source_repo":[[1768503245771,1],"darin@book"],"title":[[1768503245771,1],"darin@book"],"type":[[1768503245771,1],"darin@book"]},"acceptance_criteria":"- [ ] `Reject` carries a typed reason, not a string.\n- [ ] Error payloads include the mapped reason consistently.\n- [ ] Gap buffer/session tests updated.","assignee":"darin@book","assignee_at":[1768521672942,1],"assignee_expires":1768525272942,"closed_at":[1768522037086,1],"closed_by":"darin@book","created_at":[1768503245771,1],"created_by":"darin@book","description":"**Problem**\n`IngestDecision::Reject { code: String }` in `src/daemon/repl/gap_buffer.rs` uses ad-hoc string codes (\"prev_unknown\", \"gap_timeout\", \"gap_buffer_overflow\", etc.) and the session layer forwards them into `SubscriberLagged` errors. This is brittle and makes it easy to add new reasons without updating error handling.\n\n**Files**\n- src/daemon/repl/gap_buffer.rs\n- src/daemon/repl/session.rs\n- src/core/error/details.rs (if adding structured reason)","design":"Replace string codes with a typed enum (e.g., `ReplRejectReason`). Map that enum to error payloads (and, if needed, add a structured detail field for the reason). Update gap buffer + session logic and tests accordingly.","id":"bd-al7","labels":[],"priority":2,"status":"closed","title":"Repl gap buffer reject reasons should be typed","type":"chore"}
