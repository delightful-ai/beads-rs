{"_at":[1770500471112,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Surface API validates patch semantics\n- [ ] CLI uses surface API only\n- [ ] Error mapping remains typed and explicit","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770498234014,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nCLI update path depends on daemon-only patch validation trait.","design":"Move validation logic to surface-level typed API and map errors explicitly without stringly conversions.","id":"bd-21eg.12","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Extract BeadPatch daemon validation into beads-surface typed API","type":"task"}
{"_at":[1768461133331,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768454392707,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nREALTIME_PLAN §9.3 requires EVENTS batches be constructed round‑robin across eligible (namespace, origin_replica_id) to avoid starvation. Current `handle_want` in `src/daemon/repl/manager.rs` and `server.rs` builds batches by iterating hot‑cache then WAL ranges in map order; there is no round‑robin scheduling.\n\n**Design**\n- Implement a round‑robin iterator over keys `(namespace, origin)` when building EVENTS frames.\n- Preserve per‑origin contiguity (do not interleave out of order within a key).\n- Add tests that show fairness across multiple namespaces/origins under batch size limits.\n\n**Acceptance**\n- [ ] EVENTS batching uses round‑robin across (namespace, origin) when filling a batch.\n- [ ] Per‑origin sequence ordering is preserved.\n- [ ] Tests validate fairness and contiguity.\n\n**Files:** src/daemon/repl/manager.rs, src/daemon/repl/server.rs","id":"bd-3m5.103","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Replication EVENTS batching is not round‑robin across (namespace, origin)","type":"bug"}
{"_at":[1766127067042,0],"_by":"darin@darinsmcstudio2.lan","closed_reason":"test cleanup","created_at":[1766127044862,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-70v","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Test epic for show","type":"epic"}
{"_at":[1769597435084,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] There is one canonical validator for surface/bead patch semantics; surface parsing no longer enforces its own required-field rules.\n- [ ] Checkpoint import uses a shared validation path for meta/manifest/content across file-based and in-memory exports.\n- [ ] Git store meta parsing returns a validated type or is immediately validated by a single helper used in all call sites.\n- [ ] Duplicate validation code is removed or reduced to input normalization.\n- [ ] Tests cover invalid inputs rejected at the boundary and valid inputs accepted by the validated types.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769573175272,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nValidation boundaries are not single-source-of-truth. Examples:\n- `ParsedBeadPatch::parse` in `crates/beads-rs/src/daemon/mutation_engine.rs` enforces required-field rules that are not enforced by `ValidatedBeadPatch` in `crates/beads-core/src/event.rs`.\n- Checkpoint import validates meta/manifest and content in multiple paths (`import_checkpoint` and `import_checkpoint_export`) in `crates/beads-rs/src/git/checkpoint/import.rs`.\n- Git store `parse_meta` exposes `format_version` but callers (`crates/beads-rs/src/git/sync.rs`) do not gate on it.\n\nThis creates implicitness and drift: you must know which path does the \"real\" validation, and it is easy to add new call paths without the right checks.\n\n**Files:**\n- `crates/beads-rs/src/daemon/mutation_engine.rs`\n- `crates/beads-core/src/event.rs`\n- `crates/beads-rs/src/git/checkpoint/import.rs`\n- `crates/beads-rs/src/git/wire.rs`\n- `crates/beads-rs/src/git/sync.rs`","design":"**Design**\nCreate a single validated type per boundary and ensure all callers only use the validated type.\n\nConcrete plan:\n1) For patch parsing: introduce a `ValidatedSurfacePatch` (or fold requirements into the canonical validator) so surface parsing does not independently enforce required-field rules. The pipeline should be: raw input -> parsed -> validated (single place) -> apply.\n2) For checkpoint import: extract shared validation into a helper that returns `ValidatedCheckpointMeta` and `ValidatedCheckpointManifest`, and reuse it for both `import_checkpoint` and `import_checkpoint_export`.\n3) For git store meta: change `parse_meta` to return a validated meta type that includes a version gate (see separate bead on version gating), or add a `parse_supported_meta` helper used everywhere.\n4) Remove or inline duplicate validation logic so there is exactly one canonical validator per boundary.\n\n**Design Notes**\n- Favor type gates: after validation, the type system should guarantee invariants (no re-checks).\n- Use small, explicit boundary types: `ParsedX` -> `ValidatedX`.","id":"bd-907g","labels":{"cc":{"max":{}},"entries":{"scatter":[{"counter":5839662980227332767,"replica":"a557e6a8-6cca-7d3e-a89f-607941c87975"}],"tech-debt":[{"counter":9618146627077327439,"replica":"5983ddbe-77dd-cd68-e5b1-c0163d81dd0f"}],"validation":[{"counter":9378939429740772330,"replica":"64a295f8-729e-a5c3-83f4-65ff04eb402e"}]}},"notes":[{"at":[1769596252802,0],"author":"darin@darins-Mac-Studio-2.local","content":"Rendering should remain in command files; avoid centralizing CLI rendering while refactoring validation boundaries.","id":"go-comment-bd-907g-1"},{"at":[1769597435084,0],"author":"darin@darinsmcstudio2.lan","content":"Rendering should remain in command files; avoid centralizing CLI rendering while refactoring validation boundaries.","id":"legacy-notes"}],"priority":2,"status":"closed","title":"Single validation gate per boundary","type":"chore"}
{"_at":[1765772953094,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@dusk","created_at":[1765744931340,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`src/daemon/scheduler.rs` spawns a new thread on every schedule call, and reschedules do not cancel old sleepers. Under bursty ops, this devolves into \"death by a thousand sleeping threads\".\n\n**Design**\nSingle timer mechanism:\n- Keep a min-heap of `(deadline, remote)`\n- State loop computes next deadline and uses `crossbeam::channel::after(next - now)` (or one dedicated timer thread)\n- When rescheduling, update the heap entry (or push and ignore stale entries by checking current deadline in a map)\n\nThis makes the daemon \"boring\" which is good.\n\n**Acceptance**\n- [ ] At most 1 timer thread (or zero with channel-based approach)\n- [ ] Rapid reschedules dont accumulate sleeping threads\n- [ ] Stress test: 1000 rapid mutations, verify thread count stays bounded\n- [ ] Existing sync behavior preserved (debounce still works)\n\n**Files:** src/daemon/scheduler.rs","id":"bd-w36","labels":{"cc":{"max":{}},"entries":{}},"priority":0,"status":"closed","title":"Scheduler spawns unbounded threads on reschedule (threadpocalypse)","type":"bug"}
