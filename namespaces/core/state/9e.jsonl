{"_at":[1768376045284,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768178841172,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nExisting users have data in legacy snapshot WAL format. Must import into new event WAL.\n\n**Context**\n- REALTIME_PLAN.md §17.1 (legacy WAL snapshot), §5.1 (rename to wal_legacy_snapshot.rs)\n\n**Design**\n- Rename src/daemon/wal.rs to src/daemon/wal_legacy_snapshot.rs\n- On store open during migration: detect legacy snapshot WAL, read it, merge into StoreState[\"core\"] namespace\n- Proceed with new event WAL thereafter\n- Keep legacy reader read-only for one release\n\n**Acceptance**\n- [ ] Legacy wal.rs renamed to wal_legacy_snapshot.rs\n- [ ] Migration detects and imports legacy snapshot\n- [ ] Data ends up in \"core\" namespace\n- [ ] Tests verify migration path\n\n**Files:** src/daemon/wal_legacy_snapshot.rs, src/daemon/store_runtime.rs, src/daemon/migration.rs (new)","id":"bd-3m5.38","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Phase 6: Legacy WAL snapshot migration import","type":"task"}
{"_at":[1769593331247,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] Parent edges are represented by a distinct type, not `DepKey` + `DepKind::Parent`.\n- [ ] Generic dep add/remove APIs cannot represent parent edges.\n- [ ] Mutation engine uses only parent-specific ops for parent changes.\n- [ ] Event validation rejects parent edges in generic dep operations (or the type system prevents them).\n- [ ] Tests cover: single-parent invariant, parent edge add/remove, and rejection of parent via generic deps.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769573160970,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nParent relationships are represented as a generic dependency kind (`DepKind::Parent`) and are enforced by convention in mutation paths (`SetParent` vs `AddDep`). This means the single-parent invariant is not encoded in types, and any new generic dep path can violate it.\n\n**Files:**\n- `crates/beads-core/src/domain.rs`\n- `crates/beads-core/src/dep.rs`\n- `crates/beads-rs/src/daemon/mutation_engine.rs`\n- `crates/beads-rs/src/daemon/query_executor.rs`\n- `crates/beads-rs/src/compat/go_schema.rs`","design":"**Design**\nSplit parent edges from general dependency edges at the type level and disallow `DepKind::Parent` in generic dep ops.\n\nConcrete plan:\n1) Introduce a distinct `ParentEdge` (or `ParentLink`) type in `beads-core` with explicit `child` and `parent` fields.\n2) Update dependency types so `DepKey`/`DepKind` only represent non-parent deps (e.g., Blocks/Related). If `DepKind::Parent` must remain for compatibility, make it unreachable from public constructors.\n3) Add dedicated ops: `SetParent`, `ClearParent`, `ParentAdd` (if needed), and remove the ability to add/remove parent edges via generic `DepAdd`/`DepRemove`.\n4) Update mutation planning: `SetParent` path constructs parent ops only; generic dep add path rejects parent kind at type level (compile time) or with explicit runtime error.\n5) Update validation paths and wire formats so parent edges have a single representation and invariant enforcement.\n\n**Design Notes**\n- If removing `DepKind::Parent` is too invasive, keep it for legacy parsing but map it immediately into parent-specific types.\n- Make parent edges DAG-safe by construction and remove ad-hoc runtime checks where possible.","id":"bd-t9xz","labels":{"cc":{"max":{}},"entries":{"scatter":[{"counter":16657498115539209288,"replica":"7b9928ee-b787-3c08-2811-817afc36d5ce"}],"tech-debt":[{"counter":5468007523263720890,"replica":"2327902c-7bd5-5649-8474-67df1052b6a9"}],"types":[{"counter":6491874434171015920,"replica":"34a32b01-6fa4-4c78-0755-14bcce256832"}]}},"notes":[{"at":[1769590759150,0],"author":"darin@darins-Mac-Studio-2.local","content":"Reminder: keep rendering in the command files themselves; avoid moving rendering into shared layers.","id":"go-comment-bd-t9xz-1"},{"at":[1769593331247,0],"author":"darin@darinsmcstudio2.lan","content":"Reminder: keep rendering in the command files themselves; avoid moving rendering into shared layers.","id":"legacy-notes"}],"priority":2,"status":"closed","title":"Separate parent edges from generic deps","type":"chore"}
{"_at":[1768508963682,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] No phase-named integration test files remain.\n- [ ] All integration tests compile under `tests/integration/mod.rs` as a single crate.\n- [ ] Fixtures are centralized and imported from a single module.\n- [ ] `cargo test` still discovers and runs the integration tests.","closed_reason":"Duplicate of bd-qrlt","created_at":[1768508260025,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nIntegration tests live as many top-level crates in `tests/` and are named by phase (phase1/phase2/phase7), which obscures intent and makes it unclear where new integration tests should live. There isn't a single integration test entrypoint or hierarchy aligned with runtime boundaries.\n\n**Files**\n- tests/* (integration test files)\n- tests/fixtures/*\n","design":"**Design**\n- Create a single integration test crate at `tests/integration/mod.rs`.\n- Move existing integration tests into a module tree grouped by contract boundaries (core/apply, wal/fsck/index/seq, repl/*, checkpoint, admin, cli, upgrade, migration, crash_recovery, realtime_errors).\n- Move shared fixtures under `tests/integration/fixtures/` and re-export from the crate root for consistent use.\n- Update module paths/usages and remove per-file `mod fixtures;` declarations.\n- Rename file headers to remove “phase X” naming.","id":"bd-yzmj","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Reorganize integration tests into single module tree","type":"chore"}
