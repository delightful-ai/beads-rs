{"_at":[1768336320713,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768178744328,1],"darin@darinsmacstudio.lan"],"claim":[[1768335110454,1],"darin@darinsmacstudio.lan"],"description":[[1768178744328,1],"darin@darinsmacstudio.lan"],"design":[[1768178744328,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768178744328,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768178744328,1],"darin@darinsmacstudio.lan"],"labels":[[1768178744328,1],"darin@darinsmacstudio.lan"],"priority":[[1768261543032,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768178744328,1],"darin@darinsmacstudio.lan"],"title":[[1768187791670,1],"darin@darinsmacstudio.lan"],"type":[[1768178744328,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@darinsmacstudio.lan","assignee_at":[1768335110454,1],"assignee_expires":1768338710454,"closed_at":[1768336320713,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768178744328,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nPlan requires priority ordering and overload shedding to protect local mutations from replication storms.\n\n**Context**\n- REALTIME_PLAN.md ยง0.19 (overload shedding, internal backpressure defaults)\n- Priority: local IPC > replication ingest > WANT servicing > checkpoint\n\n**Design**\n- Add `AdmissionController` to src/daemon/admission.rs\n- Track inflight counts: ipc_mutations, repl_ingest_bytes, repl_ingest_events\n- Enforce limits: MAX_IPC_INFLIGHT_MUTATIONS (1024), MAX_REPL_INGEST_QUEUE_BYTES (32 MiB), MAX_REPL_INGEST_QUEUE_EVENTS (50k)\n- When overloaded: shed replication first, then IPC\n- Return ERROR(code=\"overloaded\") with retry_after_ms\n\n**Acceptance**\n- [ ] AdmissionController tracks inflight by priority class\n- [ ] Replication shed before IPC mutations\n- [ ] Limits enforced with ERROR(code=\"overloaded\")\n- [ ] Tests verify shedding order\n\n**Files:** src/daemon/admission.rs (new), src/daemon/core.rs, src/daemon/repl/session.rs","id":"bd-3m5.29","labels":[],"priority":1,"status":"closed","title":"Phase 5: AdmissionController + overload shedding","type":"task"}
