{"_at":[1768622414118,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622414118,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n\nGo beads has a StatusDeferred workflow status for putting issues on ice (icebox). This is distinct from blocked status - deferred issues aren't waiting on dependencies, they're deliberately postponed for future consideration.\n\nKey features missing from beads-rs:\n- `bd defer [id]` command to set status to deferred\n- `bd undefer [id]` command to restore to open\n- `--until` flag for time-based deferral\n- `defer_until` timestamp field for auto-revealing issues\n- Snowflake (❄) display icon for deferred status\n- Exclusion from `bd ready` by default\n\n**Design**\n\nAdd StatusDeferred variant to Status enum and implement defer/undefer commands.\n\nTime-based scheduling uses the defer_until field:\n- `bd defer bd-abc --until=tomorrow` sets defer_until timestamp\n- `bd defer bd-abc --until=+1h` (relative: +6h, -1d, +2w)\n- `bd defer bd-abc --until=2025-01-20` (absolute: ISO 8601 or date-only)\n- Issues with defer_until > now are excluded from `bd ready`\n- `bd undefer` clears both status and defer_until\n\nTime parsing supports layered formats (from timeparsing/parser.go):\n1. Compact duration: +6h, -1d, +2w, 3m, 1y (regex: `[+-]?(\\d+)([hdwmy])`)\n2. Absolute formats: YYYY-MM-DD, RFC3339, ISO 8601 variants\n3. Natural language: \"tomorrow\", \"next monday\", \"in 3 days\" (using chrono crate or similar)\n\nImplementation files:\n- `src/core/workflow.rs` - Add StatusDeferred variant\n- `src/core/lww.rs` - Add defer_until field to Bead struct as Lww<Option<Timestamp>>\n- `src/cli/defer.rs` - Defer command with --until flag\n- `src/cli/undefer.rs` - Undefer command\n- `src/util/timeparse.rs` - Time parsing utilities (compact duration, NLP, absolute)\n- `src/daemon/ops.rs` - Defer/undefer operations\n- `src/cli/ready.rs` - Filter out deferred issues (status=deferred OR defer_until > now)\n\nStatusDeferred display:\n- Icon: ❄ (snowflake)\n- Color: muted/gray (see ui/styles.go line 236)\n- Format: `MutedStyle.Render(\"❄\")` in Go\n\nDeferred issues behavior:\n- Don't appear in `bd ready` by default\n- Still visible in `bd list`\n- Can be claimed if you explicitly want to work on them\n\n**Design Notes**\n\nGo beads uses olebedev/when for NLP time parsing. For Rust, consider:\n- chrono-english crate for NLP (\"tomorrow\", \"next monday\")\n- regex for compact duration parsing (+6h, -1d)\n- chrono for absolute timestamp parsing\n\nTime parsing error handling should provide helpful examples:\n```\nError: invalid --until format \"foo\". Examples: +1h, tomorrow, next monday, 2025-01-15\n```\n\nEdge cases:\n- Defer without --until just sets status=deferred (no timestamp)\n- Undefer always clears both status and defer_until\n- Setting status to anything other than deferred should clear defer_until\n- Auto-reveal happens in ready work calculation, not via background job\n\n**Acceptance**\n\n- [ ] Status enum has StatusDeferred variant\n- [ ] Bead struct has defer_until field (Lww<Option<Timestamp>>)\n- [ ] `bd defer [id]` sets status to deferred\n- [ ] `bd defer [id] --until=<time>` parses and sets defer_until timestamp\n- [ ] Time parsing supports: +6h, -1d, +2w, tomorrow, next monday, 2025-01-15\n- [ ] `bd undefer [id]` restores to open and clears defer_until\n- [ ] `bd ready` excludes issues with status=deferred OR defer_until > now\n- [ ] Deferred status displays with snowflake icon (❄) in muted color\n- [ ] Tests for time parsing (compact, NLP, absolute formats)\n- [ ] Tests for defer/undefer operations\n- [ ] Migration handles StatusDeferred from Go beads export\n\n**Files:**\n- src/core/workflow.rs\n- src/core/lww.rs\n- src/cli/defer.rs\n- src/cli/undefer.rs\n- src/util/timeparse.rs\n- src/daemon/ops.rs\n- src/cli/ready.rs","id":"bd-ze0x.10","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":14532607019882133948,"replica":"5ac7d3cc-7f07-4053-ec59-0ba83ed7f1ff"}]}},"priority":2,"status":"open","title":"Defer/undefer commands with time-based scheduling","type":"feature"}
