{"_at":[1768513032904,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768503231152,1],"darin@book"],"claim":[[1768512918302,1],"darin@book"],"description":[[1768503231152,1],"darin@book"],"design":[[1768503231152,1],"darin@book"],"estimated_minutes":[[1768503231152,1],"darin@book"],"external_ref":[[1768503231152,1],"darin@book"],"labels":[[1768503231152,1],"darin@book"],"priority":[[1768503231152,1],"darin@book"],"source_repo":[[1768503231152,1],"darin@book"],"title":[[1768503231152,1],"darin@book"],"type":[[1768503231152,1],"darin@book"]},"acceptance_criteria":"- [ ] Append path uses sync_data instead of sync_all.\n- [ ] Directory fsync happens only on new segment creation/rotation.\n- [ ] WAL tests updated to account for new sync behavior.","assignee":"darin@book","assignee_at":[1768512918302,1],"assignee_expires":1768516518302,"closed_at":[1768513032904,1],"closed_by":"darin@book","created_at":[1768503231152,1],"created_by":"darin@book","description":"**Problem**\n`SegmentWriter::append` currently uses `sync_all`, which fsyncs file metadata and directory on every append. The realtime plan specifies syncing file data per record and only syncing the directory when a new segment file is created/rotated. The current behavior is significantly slower and diverges from the intended design.\n\n**Files**\n- src/daemon/wal/segment.rs\n- src/daemon/wal/event_wal.rs\n- src/daemon/store_runtime.rs (if metrics/limits need adjustments)","design":"Implement the planâ€™s fsync policy:\n- Use `File::sync_data()` (or equivalent) for normal record appends.\n- Only `sync_all()` when creating a new segment file or sealing/rotating a segment.\n- Fsync the namespace directory when a new segment file path is created.\nUpdate metrics to distinguish data fsync vs full fsync if needed.","id":"bd-0it","labels":[],"priority":2,"status":"closed","title":"WAL append fsync policy should follow realtime plan","type":"chore"}
