{"_at":[1768823227172,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768776087397,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nLog/spans use inconsistent field keys, making search and correlation brittle.\n\n**Design**\n- Define a canonical field schema for observability (e.g., request_id/trace_id, store_id, namespace, actor_id, replica_id, txn_id, client_request_id, repo).\n- Provide helper functions/macros to build spans/logs with required fields.\n- Update key entry points (IPC request handling, mutation execution, repl send/recv, git sync, admin) to use the schema.\n- Add tests or lint-style checks for required fields on critical spans.\n\n**Acceptance**\n- [ ] Critical spans/logs include required fields using standardized keys.\n- [ ] Documentation or tests enforce the schema.\n\n**Files:** src/telemetry.rs, src/daemon/server.rs, src/daemon/executor.rs, src/daemon/repl/*, src/daemon/git_worker.rs, docs/philosophy/* (if needed)","id":"bd-7i3y","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Observability: enforce consistent field schema","type":"chore"}
{"_at":[1768426332260,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1766127735338,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nWe still lack an integration test that proves WAL recovery works after an unclean daemon crash. Data loss here would be catastrophic.\n\n**Design**\nAdd an integration test that:\n1) creates a repo with a bare remote\n2) starts the daemon (via bd create --json) and captures PID via IPC Ping\n3) performs a mutation (bd create) and verifies WAL file exists\n4) SIGKILL the daemon immediately (kill -9) before sync finishes\n5) restart via any bd command (autostart)\n6) assert the bead is present (bd list/show) and can be synced to remote\nUse per-test XDG_RUNTIME_DIR + BD_WAL_DIR temp dirs to avoid cross-test leakage.\n\n**Acceptance**\n- [ ] Test passes reliably\n- [ ] WAL replay is asserted (data present after restart)\n- [ ] No flakiness in CI\n\n**Files:** tests/critical_path.rs (or new tests/robustness.rs), src/daemon/ipc.rs (if needed)","id":"bd-bk2","labels":{"cc":{"max":{}},"entries":{}},"priority":0,"status":"closed","title":"Crash recovery integration test (kill -9 WAL replay)","type":"bug"}
{"_at":[1768514087706,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Internal mutation flow uses typed `ParsedMutationMeta` (no raw strings).\n- [ ] Invalid namespace/durability/actor/client_request_id values fail at IPC boundary with clear errors.\n- [ ] Duplicate parsing logic removed.","assignee":"darin@book","created_at":[1768503201562,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`MutationMeta` in `src/daemon/ipc.rs` stores `namespace`, `durability`, `actor_id`, and `client_request_id` as `Option<String>`. These are parsed later (and in multiple places), which makes error handling inconsistent and keeps invalid values alive deep into the realtime pipeline.\n\n**Files**\n- src/daemon/ipc.rs\n- src/daemon/core.rs (parse_durability)\n- src/daemon/mutation_engine.rs","design":"Introduce an internal `ParsedMutationMeta` that uses `NamespaceId`, `DurabilityClass`, `ActorId`, and `ClientRequestId`. Parse/validate once at IPC boundary (or in a dedicated conversion layer) and propagate the typed struct through `MutationContext` / executor. Move `parse_durability` into a shared helper so the CLI/IPC use the same parser.","id":"bd-neu","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"IPC: parse MutationMeta into typed namespace/durability/actor","type":"chore"}
{"_at":[1768525607619,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","closed_reason":"fixed by bd-zl6d timeout scaling","created_at":[1768510073390,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-qw1v","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Integration test admin_status_monotonic_under_load can time out at 3s","type":"bug"}
