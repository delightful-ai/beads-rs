{"_at":[1768712840180,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] ActorModel for idempotency/durability uses timers + crash/recover + storage.\n- [ ] Properties cover retry stability + timeout semantics.\n- [ ] Model uses production logic paths (no toy idempotency mapping).","assignee":"darin@book","created_at":[1768680815374,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nIdempotency/durability models are hand-rolled without Stateright’s timer, crash/recover, or storage features. This misses realistic failure windows and makes drift likely.\n\n**Goal**\nModel idempotency + durability using ActorModel timers, storage, and crash/recover actions with production-backed logic.","design":"**Design**\n1) Define an ActorModel where server actors use production functions for:\n   - idempotency map updates (WalIndex client_request_id mapping)\n   - durability proof/receipt generation (`DurabilityReceipt`, `DurabilityCoordinator`)\n2) Use Stateright timers (`model_timeout`) for durability wait + retry timeouts.\n3) Enable crash/recover actions with persistent `Storage` to model WAL/index persistence.\n4) Properties:\n   - no remint of txn_id/event_ids on retry\n   - timeout receipts are retryable and monotonic\n   - crash after fsync but before reply still yields original receipt on retry\n\n**References**\n- `~/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/stateright-0.31.0/examples/timers.rs`\n- `~/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/stateright-0.31.0/src/actor/model.rs` (Crash/Recover actions)\n- Production idempotency: `src/daemon/wal/index.rs`\n- Durability: `src/daemon/durability_coordinator.rs`, `src/core/durability.rs`","id":"bd-3fsg","labels":{"cc":{"max":{}},"entries":{}},"priority":0,"status":"closed","title":"Stateright crash/timer/storage modeling for idempotency + durability","type":"task"}
{"_at":[1767991016023,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] New model file exists (e.g., beads_stateright_models/examples/repl_core_machine.rs) and compiles\n- [ ] Properties cover todo.md Model #1 invariants: no-gap ACK, idempotence, equivocation detection, monotonicity, origin ordering, and reachability\n- [ ] Model explicitly references REALTIME_PLAN.md §9.4/§9.5/§9.6/§9.8 and §0.12 in doc comments\n- [ ] Model runs via cargo run --example repl_core_machine (or equivalent) within reasonable timeout","assignee":"darin@darinsmacstudio.lan","created_at":[1767985279630,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nThe current Stateright examples split core replication invariants across multiple tiny models (gap_want, equivocation, watermarks). We need one integrated replication-core model that matches REALTIME_PLAN.md §9.4/§9.5/§9.6/§9.8 and §0.12 so counterexamples map directly to the actual ingest rules.\n\n**Design Notes**\nUse existing toy pieces as seeds: beads_stateright_models/examples/gap_want_machine.rs, beads_stateright_models/examples/equivocation_machine.rs, beads_stateright_models/examples/watermarks_machine.rs, and the shared types in beads_stateright_models/src/spec.rs or realtime_types_sketch.rs.","design":"**Design**\nCreate an integrated Stateright model for the replication core: multi-namespace (core, wf), multi-origin (>=2), unordered delivery, duplication allowed. Implement the Plan §9.4/§9.5 rules: contiguity-only advancement, bounded gap buffering, WANT emission, ACK monotonicity, and equivocation detection. The model should treat the event payload as a token + sha (Plan §0.6) and maintain a small state digest set to enforce idempotence.\n\nTie the model to plan language explicitly in comments: Plan §9.4 EVENTS ordering + contiguity, §9.5 ACK monotonicity, §9.6 WANT semantics, §9.8 gap bounds, §0.12 applied vs durable seen maps (even if durable==applied in this first model). Reuse OriginStreamState-like logic (realtime_types_sketch.rs) or port minimal versions into the model to avoid drift.","id":"bd-hjm.1","labels":{"cc":{"max":{}},"entries":{"modeling":[{"counter":1589913608189293226,"replica":"5e5c50dd-8216-8dff-c3cd-072ff3c5a3aa"}],"realtime":[{"counter":8440291938502121092,"replica":"2c76324a-ebec-ff3b-39c1-3acc5fac3710"}],"stateright":[{"counter":17579497586890207659,"replica":"0d17a603-3640-a942-ba3a-06b2e25c8749"}]}},"priority":1,"status":"closed","title":"Stateright: replication core (gaps/WANT/ACK/seen_map)","type":"feature"}
