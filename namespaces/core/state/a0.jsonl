{"_at":[1768914972620,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768914167229,0],"created_by":"darin@darinsmcstudio2.lan","description":"Doc still mentions removed wire ops; update to LabelAdd/LabelRemove/DepAdd/DepRemove/NoteAppend or mark historical.","id":"bd-3wz4","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Update CRDT_OVERHAUL.md references to deprecated NotesPatch/DepUpsert/DepDelete","type":"chore"}
{"_at":[1768541272969,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Coordinator logic is in its own module with a clear API.\n- [ ] `src/daemon/core.rs` shrinks to wiring + data holders or is replaced by a coordinator module.\n- [ ] Server loop uses the coordinator interface without behavior changes.\n- [ ] `cargo test` passes.","assignee":"darin@book","created_at":[1768508732268,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n- `src/daemon/core.rs` is a ~4.7k-line god module mixing request dispatch, read gates, scheduling, replication handles, and store access.\n- Coordinator logic is hard to reason about and hard to test in isolation.\n\n**Files:**\n- src/daemon/core.rs\n- src/daemon/server.rs\n- src/daemon/executor.rs\n- src/daemon/query_executor.rs\n- src/daemon/mod.rs","design":"- Introduce `src/daemon/coord/` (or `coordinator.rs`) containing request dispatch, read gating, and scheduling.\n- `Daemon` becomes a thin facade or a type alias to `Coordinator` to preserve API shape.\n- Move helpers like `handle_request`, `normalize_*`, and deadline calculations into the coordinator module.\n- Keep executor/query modules unchanged except for imports.","id":"bd-4v16","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Refactor daemon coordinator/request routing","type":"chore"}
{"_at":[1769587543355,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"Acceptance\n- Parsing invalid combinations (closed without closed_at/by, assignee without assignee_at, or mismatched stamps) fails with WireError::InvalidValue.\n- Roundtrip tests ensure wire serialization only emits valid combinations.\n- If redundant fields are kept, they are always consistent with the LWW stamps; if removed, the compatibility path is explicit and tested.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769563852300,0],"created_by":"darin@darinsmcstudio2.lan","description":"Problem\n- WireBead carries redundant fields (status + closed_at/closed_by; assignee + assignee_at).\n- wire_to_parts ignores closed_at/closed_by/assignee_at entirely and accepts any combination.\n- This is a lie: the wire format claims timestamps/actors but the parser doesn't enforce or consume them.\n\nImpact\n- Corrupted or inconsistent store data silently loads.\n- We can't rely on the compiler to enforce the invariant that redundant fields are consistent with LWW stamps.\n- Violates parse-don't-validate and Scatter (invariants live in the reader's head).\n","design":"Design\n- Replace the redundant field trio/quads with typed enums, mirroring beads-core snapshots: WireWorkflow (Open | InProgress | Closed { closed_reason, closed_on_branch, closed_at, closed_by }) and WireClaim (Unclaimed | Claimed { assignee, assignee_at, assignee_expires }).\n- Use #[serde(flatten)] to keep the same on-disk field names for compatibility.\n- On parse, require that:\n  - status=closed implies closed_at and closed_by are present.\n  - status!=closed implies closed_* fields are absent.\n  - assignee present implies assignee_at present.\n  - assignee absent implies assignee_at/expires absent.\n- Optionally validate that closed_at/assignee_at match the LWW stamp used for workflow/claim (from _v/default). If they do not, return WireError::InvalidValue.\n- If we decide the redundant timestamps are unnecessary, delete them entirely and migrate legacy readers via a compatibility gate (but keep the invariants explicit either way).\n\nScatter fit\n- Make the wire types tell the truth; no hidden redundancy checks at call sites.\n\nFiles\n- crates/beads-rs/src/git/wire.rs","id":"bd-8ezy","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1769587294121,0],"author":"darin@darins-Mac-Studio-2.local","content":"Constraint: keep rendering in command files; do not centralize or move rendering logic out of command handlers.","id":"go-comment-bd-8ezy-1"},{"at":[1769587543355,0],"author":"darin@darinsmcstudio2.lan","content":"Constraint: keep rendering in command files; do not centralize or move rendering logic out of command handlers.","id":"legacy-notes"}],"priority":2,"status":"closed","title":"git wire: validate workflow/claim redundant fields","type":"bug"}
