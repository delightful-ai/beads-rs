{"_at":[1769401519801,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] `cargo check -p beads-macros` passes\n- [ ] `cargo check -p beads-rs` passes\n- [ ] All 9 enum_str! call sites still work\n- [ ] enum_str.rs deleted from beads-rs","created_at":[1769400113215,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbd-14fs.2 is too large - macro extraction should be a separate atomic step.\n\n**Context from codebase analysis**\n`enum_str!` is used in 9 places:\n- `src/core/error.rs` (2 uses)\n- `src/core/domain.rs` (2 uses)\n- `src/core/wire_bead.rs` (1 use)\n- `src/error.rs` (1 use) ← OUTSIDE core\n- `src/cli/commands/store.rs` (1 use) ← OUTSIDE core\n- `src/daemon/store/discovery.rs` (1 use) ← OUTSIDE core\n- `src/daemon/repl/proto.rs` (1 use) ← OUTSIDE core\n\n**Implication**: beads-rs needs direct dependency on beads-macros, not just via beads-core.\n\n**Changes**\n\n1. **Create macro in beads-macros**:\n   ```rust\n   // crates/beads-macros/src/lib.rs\n   #[macro_export]\n   macro_rules! enum_str { ... }\n   ```\n\n2. **Update beads-rs to use it**:\n   - Add `beads-macros` dependency to Cargo.toml\n   - Replace `#[macro_use] mod enum_str;` with `pub use beads_macros::enum_str;`\n   - Delete `crates/beads-rs/src/enum_str.rs`\n\n3. **All existing `crate::enum_str!` calls keep working** because the macro is re-exported at crate root.\n\n**Files**\n- crates/beads-macros/src/lib.rs (populate with macro)\n- crates/beads-rs/Cargo.toml (add beads-macros dep)\n- crates/beads-rs/src/lib.rs (re-export macro)\n- crates/beads-rs/src/enum_str.rs (delete)\n","id":"bd-14fs.11","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Phase 1A: Extract enum_str! macro to beads-macros","type":"task"}
{"_at":[1770505125849,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Root error no longer depends on daemon-only types\n- [ ] Error conversions remain typed\n- [ ] Existing callers compile without stringly fallbacks","closed_reason":"Introduced crate-level OpError surface in error.rs (ValidationFailed/InvalidRequest/Daemon payload), removed daemon-type dependency from root Error wiring, and kept callers compiling with typed mappings. Verified cargo check -p beads-rs, cli unit tests, and just dylint.","created_at":[1770498508957,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nTop-level error type imports daemon internals, which blocks clean crate boundaries.","design":"Move/shared-map error wiring via surface/api error types and explicit conversion paths.","id":"bd-21eg.32","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1770504565841,0],"author":"darin@darins-Mac-Studio-2.local","content":"Progress: root error wiring now imports IpcError from beads_surface path instead of daemon path, and root OpError export tightened to daemon::ops::OpError. Full decouple of OpError from daemon internals remains pending and will require a dedicated shared op-error surface.","id":"go-comment-bd-21eg.32-1"},{"at":[1770505125849,0],"author":"darin@darinsmcstudio2.lan","content":"Progress: root error wiring now imports IpcError from beads_surface path instead of daemon path, and root OpError export tightened to daemon::ops::OpError. Full decouple of OpError from daemon internals remains pending and will require a dedicated shared op-error surface.","id":"legacy-notes"}],"priority":2,"status":"closed","title":"Relocate crate-level error wiring away from daemon-only types","type":"chore"}
{"_at":[1769564700496,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] The only way to call `ingest_remote_batch` is via a `ContiguousBatch` (no raw Vec API).\n- [ ] `ContiguousBatch::try_new` rejects mixed origin/namespace, gaps, duplicates, and prev_sha mismatches.\n- [ ] `GapBuffer` and any other repl sources construct `ContiguousBatch` at the boundary.\n- [ ] Tests cover: valid contiguous batch, gap rejection, duplicate rejection, mixed origin rejection.\n- [ ] No code path can compile if it tries to ingest a raw Vec.\n- [ ] `cargo test` passes.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769562821328,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`SessionStore::ingest_remote_batch` accepts a raw `Vec<VerifiedEvent<PrevVerified>>`. Nothing in the type system guarantees: (a) same namespace + origin, (b) strictly increasing contiguous `origin_seq`, (c) no duplicates, (d) prev_sha chain consistency. Today the batch is sourced from `GapBuffer` so it is usually valid, but a single future refactor (or a new caller) can pass an invalid batch and we will append to WAL + apply state before later checks fail. That can produce WAL/state divergence and incorrect watermarks.\n\nThis violates parse-don’t-validate (we validate in scattered places) and keeps correctness implicit.\n\n**Impact**\n- Safety bug: WAL written with non-contiguous or duplicated events; state/apply diverges from WAL.\n- Hard to localize: failures surface far from where the batch was constructed.\n- Compiler cannot prevent misuse.\n\n**Files**\n- `crates/beads-rs/src/daemon/repl/session.rs` (batch construction)\n- `crates/beads-rs/src/daemon/repl/store.rs` / `crates/beads-rs/src/daemon/repl/runtime.rs` (SessionStore APIs)\n- `crates/beads-rs/src/daemon/core.rs` (ingest_remote_batch)\n","design":"**Design (opinionated)**\nMake contiguity unrepresentable as a runtime-only property. Encode it in a type that is the *only* input to ingest.\n\n1) Introduce `ContiguousBatch` (name bikesheddable) in core or repl module:\n```rust\npub struct ContiguousBatch {\n  namespace: NamespaceId,\n  origin: ReplicaId,\n  first: Seq1,\n  last: Seq1,\n  events: NonEmptyVec<VerifiedEvent<PrevVerified>>,\n}\n```\nInvariants enforced in constructor:\n- all events share namespace + origin\n- `origin_seq` strictly increasing and contiguous\n- no duplicates\n- prev_sha chain matches event order\n- `first`/`last` match bounds\n\n2) Construction should be *parse boundary only*:\n- `GapBuffer::ingest_one` / `drain_ready` should return `ContiguousBatch` instead of `Vec<VerifiedEvent<PrevVerified>>`.\n- WAL backfill (if used for repl ingest) should also construct `ContiguousBatch`.\n\n3) Change all ingest signatures:\n- `SessionStore::ingest_remote_batch(&mut self, batch: ContiguousBatch, now_ms: u64)`\n- `ReplIngestRequest` should carry `ContiguousBatch`\n- Callers no longer pass raw Vecs.\n\n4) Provide `events()` / `into_events()` accessors for local processing, but do not expose mutation of the underlying Vec.\n\nThis makes it impossible to call ingest with an invalid batch; the compiler becomes the guardrail.","id":"bd-36vu","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Replication ingest must require a contiguous verified batch type","type":"bug"}
{"_at":[1768622426568,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622426568,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbd has 70+ commands, many for AI agents and advanced workflows. Human users need a focused menu showing only the ~15 essential commands.\n\n**Design**\nImplement `bd human` command that displays:\n- Working With Issues: create, list, show, update, close, reopen, comment\n- Finding Work: ready, search, status, stats\n- Dependencies: dep add/remove/tree, graph, blocked\n- Setup & Sync: init, sync, doctor\n- Getting Help: quickstart, help, --help\n- Quick Examples: common workflows with actual commands\n\nReference: `/Users/darin/Projects/beads-rs-macstudio/tmp/beads/cmd/bd/human.go`\n\nOutput format:\n```\nbd - Essential Commands for Humans\nFor all 70+ commands: bd --help\n\nWorking With Issues:\n  create                Create a new issue\n  list                  List issues (filter with --status, --priority, --label)\n  ...\n\nQuick Examples:\n  # Create and track an issue\n  bd create \"Fix login bug\" --priority 1\n  bd update bd-abc123 --status in_progress\n  ...\n```\n\n**Design Notes**\n- Use ui rendering functions for consistent styling\n- Keep it under 40 lines of output\n- Focus on human workflow, not agent commands\n- Include real examples, not placeholders\n\n**Acceptance**\n- [ ] bd human shows ~15 essential commands\n- [ ] Grouped by workflow area (issues, finding work, deps, setup)\n- [ ] Quick examples section with real commands\n- [ ] Mentions full --help for all 70+ commands\n- [ ] Clean formatting with ui helpers\n\n**Files:**\n- `src/cli/human.rs` (new)\n- `src/cli/mod.rs` (register command)","id":"bd-ze0x.12","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"open","title":"bd human command - focused help menu","type":"feature"}
