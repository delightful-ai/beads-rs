{"_at":[1770519281262,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] CLI module tree moved\n- [ ] Command tests compile and pass\n- [ ] Imports respect DAG constraints","assignee":"darin@darins-Mac-Studio-2.local","closed_reason":"Acceptance criteria met; CLI module migration complete with boundary + verification gates green","created_at":[1770498237344,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nCommand implementation locality is blocked by monolithic layout.","design":"Relocate CLI parser/command/render modules into `beads-cli` with typed interfaces.","id":"bd-21eg.22","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1770504565643,0],"author":"darin@darins-Mac-Studio-2.local","content":"Progress: moved cli helper modules (filters/parsers/validation) into crates/beads-cli with compatibility wrappers in crates/beads-rs/src/cli/*. This keeps behavior stable while shrinking beads-rs CLI ownership. Verified cargo check -p beads-cli and -p beads-rs plus CLI unit tests.","id":"go-comment-bd-21eg.22-1"},{"at":[1770507472810,0],"author":"darin@darins-Mac-Studio-2.local","content":"Progress: removed beads-rs CLI compatibility wrapper modules for prime/setup/onboard and rewired runtime dispatch directly to beads-cli command types/handlers from cli::run. Deleted crates/beads-rs/src/cli/commands/{prime,setup,onboard}.rs and updated command typing in commands/mod.rs. Verified cargo check -p beads-rs, cargo test -p beads-cli, and cargo check --workspace.","id":"go-comment-bd-21eg.22-2"},{"at":[1770508398390,0],"author":"darin@darins-Mac-Studio-2.local","content":"Major progress: removed beads-rs CLI shim modules `src/cli/{parsers,filters,validation}.rs` and rewired command handlers directly to `beads_cli::{parsers,filters,validation}` APIs. Also removed prime/setup/onboard shim command modules earlier and dispatches directly through beads-cli-backed handlers/types. No behavior changes observed in CLI critical path tests.\nValidation: cargo check -p beads-rs, cargo test -p beads-rs --test integration -- cli::critical_path:: (6 pass), just dylint, cargo check --workspace.","id":"go-comment-bd-21eg.22-3"},{"at":[1770512264734,0],"author":"darin@darins-Mac-Studio-2.local","content":"Update: mapped the hard cycle blocker for full CLI handler migration and converted .22 into an executable dependency chain under the epic.\n\nCycle blocker observed:\n- current edge: beads-rs -> beads-cli\n- full handler move needs upgrade/store/migrate host operations still owned by beads-rs\n- adding beads-cli -> beads-rs would create forbidden cycle\n\nTo execute without shims/cycles, I created and claimed these phased beads:\n- bd-21eg.37 (closed): extract shared CLI runtime primitives into beads-cli\n- bd-21eg.38 (in_progress): move pure IPC read-only handlers into beads-cli + rewire dispatch\n- bd-21eg.39 (open): add typed backend trait for host-coupled ops (upgrade/store/migrate)\n- bd-21eg.40 (open): finalize ownership and delete migrated beads-rs handler modules\n\nDependency wiring:\n- .38 depends on .37\n- .39 depends on .37\n- .40 depends on .38 + .39\n- .22 depends on .40\n\nThis keeps .22 focused on final outcome while execution proceeds in typed, non-cyclic increments.","id":"go-comment-bd-21eg.22-4"},{"at":[1770519281027,0],"author":"darin@darins-Mac-Studio-2.local","content":"Closeout evidence for bd-21eg.22:\n\n- CLI module tree is owned by `crates/beads-cli` (`commands/`, `parsers.rs`, `filters.rs`, `runtime.rs`, `upgrade/`, `migrate/`).\n- Final CLI ownership cleanup beads (`bd-21eg.38`/`.39`/`.40`) are complete, with migrated handlers removed from `beads-rs` shim ownership.\n- DAG/boundary invariant holds:\n  - `rg -n \"crate::daemon::\" crates/beads-rs/src/cli crates/beads-cli/src` => no matches.\n  - `just dylint` passes.\n- Verification for command/test stability passes:\n  - `cargo check`\n  - `cargo fmt --all`\n  - `just dylint`\n  - `cargo clippy --all-features -- -D warnings`\n  - `cargo test`\n  - `RUST_TEST_THREADS=1 cargo test --features slow-tests`\n\nAcceptance mapping:\n- [x] CLI module tree moved\n- [x] Command tests compile and pass\n- [x] Imports respect DAG constraints\n\nNo intended behavior changes; CLI critical-path and integration coverage stayed green.","id":"go-comment-bd-21eg.22-5"},{"at":[1770519281262,0],"author":"darin@darinsmcstudio2.lan","content":"Progress: moved cli helper modules (filters/parsers/validation) into crates/beads-cli with compatibility wrappers in crates/beads-rs/src/cli/*. This keeps behavior stable while shrinking beads-rs CLI ownership. Verified cargo check -p beads-cli and -p beads-rs plus CLI unit tests.\n\nProgress: removed beads-rs CLI compatibility wrapper modules for prime/setup/onboard and rewired runtime dispatch directly to beads-cli command types/handlers from cli::run. Deleted crates/beads-rs/src/cli/commands/{prime,setup,onboard}.rs and updated command typing in commands/mod.rs. Verified cargo check -p beads-rs, cargo test -p beads-cli, and cargo check --workspace.\n\nMajor progress: removed beads-rs CLI shim modules `src/cli/{parsers,filters,validation}.rs` and rewired command handlers directly to `beads_cli::{parsers,filters,validation}` APIs. Also removed prime/setup/onboard shim command modules earlier and dispatches directly through beads-cli-backed handlers/types. No behavior changes observed in CLI critical path tests.\nValidation: cargo check -p beads-rs, cargo test -p beads-rs --test integration -- cli::critical_path:: (6 pass), just dylint, cargo check --workspace.\n\nUpdate: mapped the hard cycle blocker for full CLI handler migration and converted .22 into an executable dependency chain under the epic.\n\nCycle blocker observed:\n- current edge: beads-rs -> beads-cli\n- full handler move needs upgrade/store/migrate host operations still owned by beads-rs\n- adding beads-cli -> beads-rs would create forbidden cycle\n\nTo execute without shims/cycles, I created and claimed these phased beads:\n- bd-21eg.37 (closed): extract shared CLI runtime primitives into beads-cli\n- bd-21eg.38 (in_progress): move pure IPC read-only handlers into beads-cli + rewire dispatch\n- bd-21eg.39 (open): add typed backend trait for host-coupled ops (upgrade/store/migrate)\n- bd-21eg.40 (open): finalize ownership and delete migrated beads-rs handler modules\n\nDependency wiring:\n- .38 depends on .37\n- .39 depends on .37\n- .40 depends on .38 + .39\n- .22 depends on .40\n\nThis keeps .22 focused on final outcome while execution proceeds in typed, non-cyclic increments.\n\nCloseout evidence for bd-21eg.22:\n\n- CLI module tree is owned by `crates/beads-cli` (`commands/`, `parsers.rs`, `filters.rs`, `runtime.rs`, `upgrade/`, `migrate/`).\n- Final CLI ownership cleanup beads (`bd-21eg.38`/`.39`/`.40`) are complete, with migrated handlers removed from `beads-rs` shim ownership.\n- DAG/boundary invariant holds:\n  - `rg -n \"crate::daemon::\" crates/beads-rs/src/cli crates/beads-cli/src` => no matches.\n  - `just dylint` passes.\n- Verification for command/test stability passes:\n  - `cargo check`\n  - `cargo fmt --all`\n  - `just dylint`\n  - `cargo clippy --all-features -- -D warnings`\n  - `cargo test`\n  - `RUST_TEST_THREADS=1 cargo test --features slow-tests`\n\nAcceptance mapping:\n- [x] CLI module tree moved\n- [x] Command tests compile and pass\n- [x] Imports respect DAG constraints\n\nNo intended behavior changes; CLI critical-path and integration coverage stayed green.","id":"legacy-notes"}],"priority":1,"status":"closed","title":"Move CLI module tree and command handlers into beads-cli","type":"task"}
{"_at":[1768374571803,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768178964803,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbd-3m5.20 is too large. Split: export algorithm for sharded JSONL.\n\n**Context**\n- REALTIME_PLAN.md ยง13.8 (export algorithm)\n- Refines bd-3m5.20\n\n**Design**\n- Implement checkpoint export in src/git/checkpoint/export.rs\n- Materialize converged state for included namespaces\n- Incremental export: track dirty shards via ApplyOutcome, regenerate only dirty\n- Determinism: shard JSONL lines sorted by key\n- Write manifest.json and meta.json with hashes\n\n**Acceptance**\n- [ ] Export writes shard files in sorted order\n- [ ] Incremental: only dirty shards regenerated\n- [ ] manifest.json lists files with hashes\n- [ ] meta.json includes watermarks and content_hash\n\n**Files:** src/git/checkpoint/export.rs","id":"bd-3m5.49","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Phase 6: Checkpoint export algorithm","type":"task"}
{"_at":[1769758985846,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] A `ReadScope` validated type exists with a single constructor that normalizes inputs.\n- [ ] Daemon entrypoints use `ReadScope` and do not re-normalize namespace/consistency.\n- [ ] `normalize_read_consistency` / `normalize_namespace` usage is reduced to the constructor or removed.\n- [ ] Tests cover invalid namespace/consistency rejection and valid normalization.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769574013445,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nRead-scope normalization (namespace + read consistency) is scattered across daemon entrypoints:\n- `normalize_read_consistency` and `normalize_namespace` in `crates/beads-rs/src/daemon/coord.rs`\n- Callers in `crates/beads-rs/src/daemon/admin.rs` and `crates/beads-rs/src/daemon/server.rs` repeatedly normalize inputs\n\nThis is scatter + implicit: every new entrypoint must remember to normalize, and there is no type that represents a validated read scope.\n\n**Files:**\n- `crates/beads-rs/src/daemon/coord.rs`\n- `crates/beads-rs/src/daemon/admin.rs`\n- `crates/beads-rs/src/daemon/server.rs`\n- `crates/beads-core/src/namespace.rs` (if adding shared type)","design":"**Design**\nIntroduce a validated `ReadScope` type and require it at all read entrypoints.\n\nConcrete plan:\n1) Define `ReadScope` (namespace + consistency) in `beads-core` or a shared daemon module.\n2) Provide a constructor that performs normalization and validation once.\n3) Update daemon entrypoints to accept `ReadScope` instead of raw namespace/consistency fields.\n4) Remove repeated normalization calls in `admin`, `server`, and `coord` once the type is in place.\n\n**Design Notes**\n- The type should expose canonical namespace and consistency values so downstream code can trust them.\n- Keep error reporting precise (field names and reasons).","id":"bd-8s8j","labels":{"cc":{"max":{}},"entries":{"scatter":[{"counter":9451778915415646401,"replica":"eced5dde-b410-b2bf-e819-0440a0a456b4"}],"types":[{"counter":16181115873261566275,"replica":"ef9c9fcc-5029-d876-333c-9fb5bdd36430"}],"validation":[{"counter":8415491841507395444,"replica":"b95660c6-c93e-258e-aa46-47aada1d1443"}]}},"priority":2,"status":"closed","title":"Validated ReadScope for daemon entrypoints","type":"chore"}
{"_at":[1768622429278,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622429278,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nGo beads supports `bd supersede <old> --with <new>` to mark an issue as superseded by a newer version and automatically close it. Useful for design docs, specs, and evolving artifacts. beads-rs needs this.\n\n**How it works in Go beads**\n- Command: `bd supersede <old> --with <new>` (in cmd/bd/duplicate.go)\n- Uses `DepSupersedes` dependency type\n- Automatically closes the superseded issue\n- Close reason references the replacement issue\n- Stored in dependencies table (per Decision 004)\n\n**Design for Rust**\n1. Add `Supersedes` variant to `DepKind` enum in src/core/domain.rs\n2. Mark it as non-DAG-enforcing (informational chain)\n3. Add CLI command: src/cli/commands/supersede.rs\n   - `bd supersede <old> --with <new>`\n   - Validates replacement issue exists\n   - Rejects self-supersession (old == new)\n   - Creates supersedes edge\n   - Closes old issue atomically\n4. Wire through daemon IPC for atomic operation\n5. Add to CLI command tree\n\n**Design considerations**\n- Atomicity: dependency + closure must be atomic\n- Allow superseding already-closed issues? (spec updates)\n- Close reason should reference replacement ID\n- Should we build supersession chains? (A supersedes B supersedes C)\n  * Go doesn't enforce linearity\n  * Could have multiple \"next versions\" (branches)\n- Direction of edge: old -> new (Go's choice)\n\n**Design questions for human review**\n- Should supersedes be bidirectional or unidirectional?\n  * Go: unidirectional (old -> new)\n  * Allows querying \"what did this replace?\" vs \"what replaces this?\"\n- Should we prevent cycles in supersession chains?\n  * Or allow time-travel paradoxes for lols?\n- Display: show \"superseded by X\" in bd show/list?\n\n**Files to study**\n- tmp/beads/cmd/bd/duplicate.go - runSupersede function\n- tmp/beads/internal/types/types.go - DepSupersedes type\n- src/core/bead.rs - bead closure workflow\n\n**Acceptance**\n- [ ] Supersedes added to DepKind enum\n- [ ] bd supersede command creates edge and closes issue\n- [ ] Self-supersession rejected\n- [ ] Replacement issue validated to exist\n- [ ] JSON output format matches Go beads\n- [ ] Cargo fmt, clippy, test pass","id":"bd-ze0x.14","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":18188522642124036763,"replica":"ec276192-fc14-5b30-db63-c0ef99c8159a"}]}},"priority":2,"status":"open","title":"Add supersede command for version chain links","type":"feature"}
