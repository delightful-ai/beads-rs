{"_at":[1768337034494,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1768195783109,1],"darin@darinsmacstudio.lan"],"claim":[[1768335113872,1],"darin@darinsmacstudio.lan"],"description":[[1768180621243,1],"darin@darinsmacstudio.lan"],"design":[[1768180621243,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768178913199,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768178913199,1],"darin@darinsmacstudio.lan"],"labels":[[1768178913199,1],"darin@darinsmacstudio.lan"],"priority":[[1768261543237,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768178913199,1],"darin@darinsmacstudio.lan"],"title":[[1768185450539,1],"darin@darinsmacstudio.lan"],"type":[[1768178913199,1],"darin@darinsmacstudio.lan"]},"acceptance_criteria":"- [ ] PeerAckTable stores per-peer durable/applied watermarks and heads with monotonic updates.\n- [ ] Divergent head sha at same seq is detected and excluded from eligibility.\n- [ ] satisfied_k computes k-of-n for eligible peers with explicit failure cases.\n- [ ] Unit tests cover monotonic updates and satisfied_k behavior.","assignee":"darin@darinsmacstudio.lan","assignee_at":[1768335113872,1],"assignee_expires":1768338713872,"closed_at":[1768337034494,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1768178913199,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nReplicatedFsync(k) requires a truthful view of which peers have durably ACKed which watermarks and head hashes. A naive map risks mixing namespaces or ignoring head hash divergence.\n\n**Context**\n- REALTIME_PLAN.md ยง0.12 (applied vs durable + head sha), ยง10.1-10.3 (durability coordination), ยง9.5 (ACK semantics)\n- Stateright model: beads_stateright_models/src/realtime_types_sketch.rs (Watermarks<Durable>, HeadStatus)\n\n**Files:** src/daemon/repl/peer_acks.rs (new), src/daemon/durability_coordinator.rs, src/daemon/store_runtime.rs","design":"**Design**\n- PeerAckTable tracks per peer: durable Watermarks<Durable>, optional durable_heads, and last_ack_at_ms.\n- Enforce monotonicity on update: seq may only advance; head sha must match the seq (reject divergence).\n- Provide queries: acked_by(ns, origin, seq) -> Vec<ReplicaId>, and satisfied_k(ns, origin, seq, k) -> bool.\n- Maintain per-namespace eligibility via roster (durability_eligible); only count eligible peers.\n- Surface divergence: if a peer reports the same seq but a different head sha, mark that peer as diverged and exclude from durability quorum.","id":"bd-3m5.45","labels":[],"priority":1,"status":"closed","title":"Phase 5: PeerAckTable for durability coordination","type":"task"}
{"_at":[1767919327281,1],"_by":"darin@darinsmacstudio.lan","_v":{"acceptance_criteria":[[1767916519416,1],"darin@darinsmacstudio.lan"],"claim":[[1767918620570,0],"darin@darinsmacstudio.lan"],"description":[[1767916519416,1],"darin@darinsmacstudio.lan"],"design":[[1767916519416,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1767916519416,1],"darin@darinsmacstudio.lan"],"external_ref":[[1767916519416,1],"darin@darinsmacstudio.lan"],"labels":[[1767916519416,1],"darin@darinsmacstudio.lan"],"priority":[[1767916519416,1],"darin@darinsmacstudio.lan"],"source_repo":[[1767916519416,1],"darin@darinsmacstudio.lan"],"title":[[1767916519416,1],"darin@darinsmacstudio.lan"],"type":[[1767916519416,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@darinsmacstudio.lan","assignee_at":[1767918620570,0],"assignee_expires":1767922220570,"closed_at":[1767919327281,1],"closed_by":"darin@darinsmacstudio.lan","created_at":[1767916519416,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nCLI handlers perform read-modify-write for labels and parent relationships. `src/cli/commands/label.rs` fetches each issue then sends a full `Update` patch, and `src/cli/commands/update.rs` queries deps then removes/adds parent edges. This makes changes non-atomic, adds round trips, and splits core behavior across CLI and daemon.\n\n**Design**\nAdd daemon-side ops for label and parent mutations and switch CLI to use them:\n- Extend IPC `Request` with `AddLabels { repo, id, labels: Vec<String> }` and `RemoveLabels { repo, id, labels: Vec<String> }`, or a single `UpdateLabels { add, remove }` request.\n- Add `SetParent { repo, id, parent: Option<String> }` that replaces existing parent edges in one mutation.\n- Implement handlers in `src/daemon/executor.rs` that apply the changes atomically in a single WAL mutation, validating label formats and parent existence.\n- Update CLI `label` commands to call the new label ops; update `update` to call `SetParent` when `--parent/--no-parent` is provided.\n- Keep response payloads consistent (use `OpResult::Updated` or add a small label/parent result if needed for clarity).\n\n**Design Notes**\nThis keeps CLI thin and centralizes behavior in the daemon. It also avoids subtle races (labels changed between fetch and update) and makes parent updates atomic.\n\n**Acceptance**\n- [ ] CLI label add/remove no longer fetches issues; daemon applies label changes atomically.\n- [ ] Parent updates are handled by a dedicated daemon op; CLI no longer manipulates deps directly.\n- [ ] Label validation errors and missing parent errors remain user-friendly.\n- [ ] Run `codex review --uncommitted` (timeout 10m) and address findings.\n- [ ] Tests pass.\n\n**Files:** `src/daemon/ipc.rs`, `src/daemon/ops.rs`, `src/daemon/executor.rs`, `src/cli/commands/label.rs`, `src/cli/commands/update.rs`, `src/api/mod.rs`","id":"bd-omw.3","labels":[],"priority":2,"status":"closed","title":"Move label/parent updates into daemon ops","type":"chore"}
