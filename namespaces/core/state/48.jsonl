{"_at":[1770499342900,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Lint catches direct CLI -> daemon imports\n- [ ] Diagnostics include actionable replacement guidance\n- [ ] No false positives in allowed modules","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770498231367,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nBoundary violations can regress without fast feedback.","design":"Extend lint rule to flag forbidden imports in CLI paths, with clear diagnostics and minimal false positives.","id":"bd-21eg.5","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Harden dylint rule for CLI/daemon boundary violations","type":"task"}
{"_at":[1768184440925,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768180726141,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nPhase 1 implementation must be verified before Phase 2 starts.\n\n**Context**\n- REALTIME_PLAN.md §18: store discovery order, identity persistence, store-global lock enforcement\n- Depends on: Phase 1 implementation beads + Phase 1 test infrastructure\n\n**Design**\nDeterministic tests for:\n- Store discovery order: multiple repo paths → same StoreId\n- Identity persistence: create store, close, reopen → same StoreId/ReplicaId\n- Store-global lock enforcement: two processes → second gets error\n- Namespace validation: valid/invalid NamespaceId patterns\n- StoreMeta round-trip: write → read → compare\n\n**Acceptance**\n- [ ] tests/phase1_identity.rs exists\n- [ ] Test: store identity survives daemon restart\n- [ ] Test: lock prevents concurrent access with clear error\n- [ ] Test: namespace regex validation (a-z, 0-9, underscore, length)\n- [ ] cargo test phase1_identity passes\n\n**Files:** tests/phase1_identity.rs (new)","id":"bd-3m5.54","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Phase 1 tests: identity persistence + lock enforcement","type":"task"}
{"_at":[1768465491733,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768444366719,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nREALTIME_PLAN §8.4 requires HLC state to be monotonic per ActorId and persisted/restored per actor. Current daemon uses a single global Clock and only restores HLC state for the daemon actor, so custom actor_id requests can regress after restart.\n\nEvidence:\n- src/daemon/clock.rs implements a single Clock without actor partitioning.\n- src/daemon/core.rs:564–570 loads hlc_state only for self.actor.\n- MutationEngine uses Clock::tick for all actors (src/daemon/mutation_engine.rs:200–240).\n\n**Why this violates plan**\nPer-actor monotonicity and persistence are required; using a single clock and only restoring the daemon actor breaks this for alternate actor_id inputs.\n\n**Acceptance**\n- [ ] Maintain per-actor HLC state (e.g., map ActorId -> Clock state) and load from wal_index.hlcs for any actor seen/used.\n- [ ] When actor_id is specified in a request, advance the correct actor clock state.\n- [ ] Tests cover monotonicity across restarts for non-daemon actor_id.","id":"bd-3m5.93","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"HLC state is global; per-actor persistence not honored","type":"bug"}
{"_at":[1767993609274,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Epic decomposed into per model beads with dependencies and priorities\n- [ ] Each model in beads_stateright_models/todo.md is implemented or explicitly scoped to non Stateright tests with rationale\n- [ ] Each model asserts the invariants listed in todo.md and references REALTIME_PLAN.md sections\n- [ ] Every model counterexample that maps to a product bug is translated into a deterministic regression test in the main codebase\n- [ ] Documentation exists in beads_stateright_models (README.md or similar) explaining how to run each model and interpret counterexamples","created_at":[1767984543055,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nWe need a tracked epic for the Stateright state machine model suite described in REALTIME_PLAN.md and beads_stateright_models/todo.md. Without it, modeling work is ad hoc and the sequence of invariants and model boundaries is not managed.\n\n**Design Notes**\nUse multiple small models at the seams: replication core, durability, idempotency, checkpoint lane, GC floor, identity and epoch guards, resource bounds, crash recovery. Each model should map counterexamples to integration tests.\n\n**Files:** REALTIME_PLAN.md, beads_stateright_models/todo.md, beads_stateright_models/src, beads_stateright_models/examples","design":"**Design**\nBuild a model portfolio, ordered for maximum early signal, matching the todo list:\n1) Realtime replication core: EVENTS, WANT, ACK, gaps, equivocation, monotonic seen map.\n2) Durability semantics: applied vs durable watermarks, ReplicatedFsync(k) coordinator.\n3) Idempotency and receipts: client_request_id mapping, PENDING vs COMMITTED, retry behavior, crash cut points.\n4) Checkpoint lane: snapshot inclusion, included_heads, multi writer retry loop, truthful included watermarks.\n5) GC markers and floors: ignore old events but advance contiguity and ACK.\n6) Store identity and epoch mismatch guards across replication and checkpoint import.\n7) Resource bounds and fairness: bounded buffers, round robin per namespace origin.\n8) WAL crash recovery cut points: no origin_seq reuse, durable means survives crash.\n9) Deterministic encoding and hashing: canonical CBOR and checkpoint hashing via property tests or tiny models.\n\nEach model should live in beads_stateright_models/src or examples, keep state minimal, and reference matching sections in REALTIME_PLAN.md so counterexamples map to implementation changes.","id":"bd-hjm","labels":{"cc":{"max":{}},"entries":{"modeling":[{"counter":14649477593514722683,"replica":"1c35f30f-7e43-bfa4-c75f-665dbd76dc97"}],"realtime":[{"counter":8106486938905790905,"replica":"31ec4c94-4418-fb9c-842b-2f7339b3dba3"}],"stateright":[{"counter":3031288444764710681,"replica":"417b96b8-e28a-30ae-8ce4-2e49ffe1d066"}]}},"priority":2,"status":"closed","title":"Stateright state machine modeling for realtime Beads","type":"epic"}
{"_at":[1768622544325,0],"_by":"darin@darinsmcstudio2.lan","created_at":[1768622544325,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nbeads-rs lacks the Message issue type - ephemeral inter-agent communication beads that enable agents to send messages, coordinate work, and thread conversations. Messages are NOT exported to JSONL (Ephemeral=true) and auto-cleanup.\n\n**What Message Beads Do (from Go beads)**\nMessage beads enable asynchronous communication between agents:\n- Send work requests, status updates, questions\n- Thread conversations via replies_to (now DependencyType)\n- Ephemeral by default (not persisted to JSONL)\n- Auto-cleanup when no longer needed\n\nMessage structure:\n- Sender: Who sent the message (agent bead ID or entity URI)\n- Assignee: Who receives the message\n- RepliesTo: Parent message ID (creates thread via dependency)\n- Ephemeral: true (skip JSONL export)\n- Status: open → closed when acknowledged\n\n**Go Implementation**\nType definition (internal/types/types.go):\n- IssueType = TypeMessage (line 486)\n- Fields:\n  - Sender string (line 75): Who sent this\n  - Ephemeral bool (line 76): If true, not exported to JSONL\n  - Assignee string: Recipient\n  - Uses dependencies table for replies-to threading\n\nEphemeral flag (types.go and nodb.go):\n- Ephemeral=true skips JSONL export in storage layer\n- Messages live in main database but not in issues.jsonl\n- Enables short-lived coordination without polluting history\n\nThreading (Decision 004: Edge Schema Consolidation):\n- Old: RepliesTo field on Issue\n- New: DepRepliesTo dependency type\n- ThreadID field on dependency for efficient queries\n- Enables conversation tree traversal\n\nCleanup:\n- bd cleanup --ephemeral deletes old ephemeral issues\n- Configurable TTL for message retention\n\n**Design for Rust**\nData model (src/core/):\n```rust\npub struct MessageData {\n    sender: String,           // Agent/entity who sent\n    assignee: Option<String>, // Recipient (optional)\n    ephemeral: bool,          // Skip JSONL export\n}\n```\n\nAdd to Bead or use optional fields.\n\nThreading via dependencies:\n- Use DepRepliesTo relation type\n- thread_id for efficient conversation queries\n- src/core/dependencies.rs handles replies-to edges\n\nJSONL export filter:\n- Check Ephemeral flag in export path\n- Skip ephemeral beads in JSONL serialization\n- Ephemeral beads live only in database\n\nCLI (src/cli/):\n- bd create --type message --sender <agent> --assignee <agent> \"Message text\"\n- bd list --type message [--label ephemeral]\n- bd reply <message-id> \"Reply text\" (creates replies-to dependency)\n- bd cleanup --ephemeral (delete old messages)\n\n**Design Notes**\n- Messages blur the line between data and metadata\n- Ephemeral flag is critical - don't pollute git history\n- Threading via dependencies is more flexible than parent field\n- Consider: Message priority/urgency\n- Consider: Broadcast messages (no assignee, multiple recipients)\n- Consider: Message expiry/TTL\n- Consider: Rich message content (attachments, structured data)\n\n**Acceptance**\n- [ ] Message type constant defined\n- [ ] MessageData struct with sender, assignee, ephemeral\n- [ ] Ephemeral flag implemented on Bead\n- [ ] JSONL export skips ephemeral beads\n- [ ] bd create --type message works\n- [ ] Sender and assignee fields populate\n- [ ] bd reply creates replies-to dependency\n- [ ] Conversation threading via DependencyType\n- [ ] bd list --ephemeral filters ephemeral beads\n- [ ] bd cleanup --ephemeral deletes old messages\n- [ ] Tests for message creation and threading\n- [ ] Tests for ephemeral JSONL exclusion\n- [ ] Migration from Go beads preserves message fields\n\n**Files to study in Go beads:**\n- tmp/beads/internal/types/types.go (lines 74-77: message fields, line 486: TypeMessage)\n- tmp/beads/cmd/bd/wisp.go (ephemeral bead handling)\n- tmp/beads/cmd/bd/nodb.go (line 225: ephemeral JSONL filter)\n- tmp/beads/internal/storage/sqlite/schema.go (lines 33-35: sender, ephemeral columns)","id":"bd-ze0x.46","labels":{"cc":{"max":{}},"entries":{"human-needed":[{"counter":10538132418215412551,"replica":"758d0240-f982-0c35-8c2e-c0d0898792fa"}]}},"priority":2,"status":"open","title":"Add Message issue type support","type":"feature"}
