{"_at":[1769512885656,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Shared `CommonFilterArgs` (or equivalent) exists with an `apply()` method that fills `Filters`.\n- [ ] `bd list` and `bd count` use the shared args via `#[command(flatten)]` and no longer duplicate filter parsing logic.\n- [ ] CLI flags, defaults, and help text remain unchanged for list/count.\n- [ ] `cargo test` passes.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769481360002,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`crates/beads-rs/src/cli/commands/list.rs` and `crates/beads-rs/src/cli/commands/count.rs` each re-implement a large chunk of filter parsing and `Filters` population (status/type/priority/assignee/labels/time windows/etc.). This is easy to drift when adding a new filter or fixing parsing logic. `search` is a smaller subset but follows the same pattern.\n\n**Design**\nCreate a single reusable filter args struct and an `apply()` method that fills `Filters` consistently for all commands.\n\n1) Add a shared args struct (location: `crates/beads-rs/src/cli/commands/mod.rs` or new `crates/beads-rs/src/cli/filters.rs`):\n```rs\n#[derive(Args, Debug, Clone)]\npub struct CommonFilterArgs { /* shared flags */ }\nimpl CommonFilterArgs {\n    pub fn apply(&self, filters: &mut Filters) -> Result<()> { /* parsing + validation */ }\n}\n```\nShared fields should include:\n- `status`, `priority`, `priority_min`, `priority_max`\n- `bead_type`, `assignee`\n- `labels`, `labels_any`\n- `title_contains`, `desc_contains`, `notes_contains`\n- `created_after/before`, `updated_after/before`, `closed_after/before`\n- `empty_description`, `no_assignee`, `no_labels`\n\n2) Use `#[command(flatten)]` to embed `CommonFilterArgs`:\n- `ListArgs { common: CommonFilterArgs, ... }`\n- `CountArgs { common: CommonFilterArgs, ... }`\n(Ensure the flags/aliases remain the same as today.)\n\n3) Update handlers:\n- `list.rs`: initialize `Filters::default()`, call `args.common.apply(&mut filters)?`, then apply list-specific fields (limit/search/parent/sort).\n- `count.rs`: same, then apply count-specific fields (`title`, `id`, `--by-*` groupings).\n- (Optional) `search.rs`: keep as-is or use the shared struct if we want `--label` etc for search in the future. Donâ€™t change user-facing behavior in this bead.\n\n4) Consolidate helpers:\n- `apply_common_filters` in `crates/beads-rs/src/cli/mod.rs` can be removed or reduced to a private helper used by `CommonFilterArgs::apply`.\n- Use existing `parse_time_ms_opt`, `parse_priority`, `parse_bead_type`, and `normalize_bead_id_for` for consistency.\n\n**Design Notes**\n- Keep help text and CLI flags **unchanged**.\n- Preserve current quirks (e.g., empty string filtering, label-any semantics) to avoid behavior changes.\n- Prefer minimal surface changes in handlers; the goal is to eliminate duplication, not change logic.\n\n**Files**\n- `crates/beads-rs/src/cli/commands/list.rs`\n- `crates/beads-rs/src/cli/commands/count.rs`\n- `crates/beads-rs/src/cli/commands/mod.rs` (or new `crates/beads-rs/src/cli/filters.rs`)\n- `crates/beads-rs/src/cli/mod.rs` (if helper is moved/removed)","id":"bd-dhv2","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Unify CLI filter args + filter building","type":"chore"}
{"_at":[1768759609556,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Remove manual as_str/parse match ladders for the enums listed in design\n- [ ] All tests pass (cargo test)\n- [ ] No behavior change in string formats","assignee":"darin@book","created_at":[1768638391462,0],"created_by":"darin@darinsmcstudio2.lan","description":"Enum string mapping/parsing is duplicated across core/daemon (e.g., ProtocolErrorCode, CliErrorCode, DepKind, MessageType, Effect, WorkflowStatus). This creates long match ladders and drift risk.","design":"Introduce a cross-crate solution to define string forms and parsing in one place. Options: (A) add strum + strum_macros and replace match ladders with derives + aliases, or (B) add a local enum_str! macro that defines variant->string and alias parse table. Apply to core/error.rs, core/domain.rs, daemon/repl/proto.rs, core/event.rs, core/wire_bead.rs, error.rs, cli/commands/store.rs, daemon/store/discovery.rs.","id":"bd-iy0c","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Reduce enum string mapping boilerplate (as_str/parse)","type":"chore"}
