{"_at":[1765836331910,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@dusk","created_at":[1765744958180,0],"created_by":"darin@darinsmcstudio2.lan","description":"Many queries do repeated full scans of deps (`deps_from`, `compute_blocked_by`, cycle detection, validation). Fine at 200 issues, painful at 20k.\n\n**Files:** src/core/state.rs, src/daemon/query_executor.rs, src/daemon/executor.rs","design":"**In-memory only** — indexes live in `RepoState`, never persisted to deps.jsonl.\n\n**Rebuild on load:** When daemon starts or merges from git, iterate deps once to build:\n```rust\nstruct DepIndexes {\n    out_edges: BTreeMap<BeadId, Vec<(BeadId, DepKind)>>,  // from -> [(to, kind)]\n    in_edges: BTreeMap<BeadId, Vec<(BeadId, DepKind)>>,   // to -> [(from, kind)]\n}\n```\n\n**Incremental update:** In `apply_add_dep` / `apply_remove_dep`, push/remove from both maps.\n\n**Functions to change:**\n- `deps_from()` (state.rs:300) → lookup `out_edges[id]`\n- `deps_to()` (state.rs:309) → lookup `in_edges[id]`  \n- `compute_blocked_by()` (query_executor.rs:707) → iterate `in_edges` filtered by kind\n- `would_create_cycle()` (executor.rs:1073) → BFS uses `out_edges` directly\n\nComplexity drops from O(all deps) to O(neighbors per hop).","id":"bd-g1c","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Add derived indexes to avoid full dep scans","type":"feature"}
{"_at":[1769212397955,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] Fixture uses explicit closure fields when status is set (or status omitted).\\n- [ ] New test: validate_event_body accepts sample_event_body.","assignee":"darin@book","created_at":[1769209800177,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\\nsample_bead_patch sets status=Open but leaves closed_reason/closed_on_branch as Keep, which violates D1 validation and will fail any path that validates events.\\n\\n**Files**: tests/integration/fixtures/event_body.rs","design":"**Design**\\nUpdate fixture to explicitly Clear closed_reason and closed_on_branch when status is set, or omit status entirely depending on intent. Add a small fixture validation test that validate_event_body accepts the generated sample event.","id":"bd-qz97.5","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"Fix sample_bead_patch fixture to satisfy D1 workflow rules","type":"task"}
