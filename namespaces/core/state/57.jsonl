{"_at":[1769518129545,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"- [ ] `join` can only be called on same‑lineage beads at compile time.\n- [ ] Collision checks move to construction boundary, not inside `join`.\n- [ ] All existing join call sites are updated; old API removed or deprecated.","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1769495028829,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`Bead::join` has a documented precondition: the beads must share the same ID and `core.created` (lineage). This is enforced by runtime checks returning `CollisionError`, but the type system does not prevent misuse. It’s easy to call `join` in a context where collisions are possible, especially during refactors.\n\nKey references:\n- `crates/beads-core/src/bead.rs:149` — precondition comment + runtime collision error.\n\nSeverity: misuse produces runtime errors and undermines correctness of merge logic.","design":"**Design**\nEncode same-lineage constraint in the type system.\n\nOption A (newtype):\n- Introduce `SameLineageBead<'a>` wrapper constructed only by a checked function:\n  - `fn same_lineage(a: &Bead, b: &Bead) -> Result<(SameLineageBead, SameLineageBead), CoreError>`\n- Implement `join` for `SameLineageBead` only.\n\nOption B (keyed grouping):\n- Introduce `LineageKey { id: BeadId, created: Stamp }` and require it to construct a pair for join.\n\nMigration:\n- Keep old `Bead::join` temporarily, mark deprecated, and move callers to typed join.","id":"bd-8t8d","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Make Bead::join require same‑lineage type","type":"bug"}
{"_at":[1770612479888,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@darins-Mac-Studio-2.local","created_at":[1770611167712,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\n`create`, `show`, and `update` still live in `crates/beads-rs/src/cli/commands`, even though adjacent read/write command handlers have moved to `beads-cli`. This keeps core CRUD ownership split and increases regression surface during future command work.\n\n**Design**\nMove the handler implementations and argument types for `create`, `show`, and `update` into `crates/beads-cli/src/commands/`. Keep `beads-rs` modules as thin compatibility shims that call through to `beads-cli`.\n\n**Acceptance**\n- [ ] `crates/beads-cli/src/commands/{create,show,update}.rs` exist and own handler logic.\n- [ ] `crates/beads-rs/src/cli/commands/{create,show,update}.rs` are compatibility shims only.\n- [ ] Existing output semantics (human + `--json`) are unchanged.\n- [ ] Integration coverage exercises create/show/update critical paths.\n- [ ] `cargo fmt --all`, `just dylint`, `cargo clippy --all-features -- -D warnings`, `cargo test`, and `cargo test --features slow-tests` pass.\n\n**Files**\n- crates/beads-cli/src/commands/create.rs\n- crates/beads-cli/src/commands/show.rs\n- crates/beads-cli/src/commands/update.rs\n- crates/beads-rs/src/cli/commands/create.rs\n- crates/beads-rs/src/cli/commands/show.rs\n- crates/beads-rs/src/cli/commands/update.rs","id":"bd-atsg.1","labels":{"cc":{"max":{}},"entries":{}},"priority":1,"status":"closed","title":"Migrate create/show/update command handlers to beads-cli","type":"chore"}
{"_at":[1768371765950,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768367199735,0],"created_by":"darin@darinsmcstudio2.lan","description":"","id":"bd-m1z","labels":{"cc":{"max":{}},"entries":{}},"priority":2,"status":"closed","title":"IPC subscribe WAL backfill for require_min_seen\n\n**Problem**\nSubscribe streams hot-cache/live events only; it does not backfill WAL ranges when require_min_seen lags current applied.\n\n**Design**\n- Compute per-origin backfill ranges from require_min_seen to current applied for the subscribed namespace.\n- Use WalRangeReader to read bounded frames (max_event_batch_bytes/events).\n- Stream backfill before live subscription; abort with explicit error if range missing/corrupt.\n\n**Acceptance**\n- [ ] Backfill frames are streamed before live events when require_min_seen is behind.\n- [ ] Backfill is bounded by max batch limits.\n- [ ] Error mapping matches REALTIME_ERRORS (corruption/bootstrap_required).\n- [ ] Tests cover backfill planning and error paths.\n\n**Files:** src/daemon/server.rs, src/daemon/repl/runtime.rs, src/daemon/ipc.rs, src/api/mod.rs","type":"task"}
