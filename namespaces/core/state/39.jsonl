{"_at":[1765781345450,0],"_by":"darin@dusk","_v":{"acceptance_criteria":[[1765744323190,0],"darin@book"],"claim":[[1765780937409,0],"darin@dusk"],"description":[[1765744323190,0],"darin@book"],"design":[[1765744323190,0],"darin@book"],"estimated_minutes":[[1765744323190,0],"darin@book"],"external_ref":[[1765744323190,0],"darin@book"],"labels":[[1765744323190,0],"darin@book"],"priority":[[1765744323190,0],"darin@book"],"source_repo":[[1765744323190,0],"darin@book"],"title":[[1765744323190,0],"darin@book"],"type":[[1765744323190,0],"darin@book"]},"assignee":"darin@dusk","assignee_at":[1765780937409,0],"assignee_expires":1765784537409,"closed_at":[1765781345450,0],"closed_by":"darin@dusk","created_at":[1765744323190,0],"created_by":"darin@book","description":"Make self-dependencies structurally impossible via validating constructor.\n\n**Problem:** `DepKey` has public fields and self-loop check is scattered in `apply_add_dep`:\n```rust\npub struct DepKey {\n    pub from: BeadId,\n    pub to: BeadId,\n    pub kind: DepKind,\n}\n```\n\n**Solution:** Make fields private with a validating constructor:\n```rust\nimpl DepKey {\n    pub fn new(from: BeadId, to: BeadId, kind: DepKind) -> Result<Self, CoreError> {\n        if from == to {\n            return Err(InvalidDependency {\n                reason: format!(\"cannot create self-dependency: {}\", from),\n            }.into());\n        }\n        Ok(Self { from, to, kind })\n    }\n\n    pub fn from(&self) -> &BeadId { &self.from }\n    pub fn to(&self) -> &BeadId { &self.to }\n    pub fn kind(&self) -> DepKind { self.kind }\n}\n```\n\nAdd serde support via proxy type for deserialization validation.\n\n**Impact:** Self-dependencies become unrepresentable, not just checked.\n\n**Files:** src/core/dep.rs","id":"bd-l4y","labels":[],"priority":2,"status":"closed","title":"Encapsulate DepKey to enforce no self-loops by construction","type":"chore"}
{"_at":[1768490241017,1],"_by":"darin@book","_v":{"acceptance_criteria":[[1768010129816,1],"darin@darinsmacstudio.lan"],"claim":[[1768490033718,1],"darin@book"],"description":[[1768010150345,1],"darin@darinsmacstudio.lan"],"design":[[1768010129816,1],"darin@darinsmacstudio.lan"],"estimated_minutes":[[1768010129816,1],"darin@darinsmacstudio.lan"],"external_ref":[[1768010129816,1],"darin@darinsmacstudio.lan"],"labels":[[1768010129816,1],"darin@darinsmacstudio.lan"],"priority":[[1768010129816,1],"darin@darinsmacstudio.lan"],"source_repo":[[1768010129816,1],"darin@darinsmacstudio.lan"],"title":[[1768254406433,1],"darin@darinsmacstudio.lan"],"type":[[1768010129816,1],"darin@darinsmacstudio.lan"]},"assignee":"darin@book","assignee_at":[1768490033718,1],"assignee_expires":1768493633718,"closed_at":[1768490241017,1],"closed_by":"darin@book","created_at":[1768010129816,1],"created_by":"darin@darinsmacstudio.lan","description":"**Problem**\nRunning `cargo run --example session_coordinator_boundary -- check` reports a counterexample for the property \"pending ingest starts at next expected\". The trace shows pending ingest can start ahead of the next expected seq:\n- DeliverEvent(3)\n- DeliverEvent(2)\n- DeliverEvent(1)\n- CoordinatorIngest\n- DeliverEvent(1)\n- DeliverEvent(2)\n- DeliverAck\n\nThis indicates either the model invariant is wrong or the coordinator boundary logic allows a gap to slip through.\n\n**Design**\nInspect `beads_stateright_models/examples/session_coordinator_boundary.rs` and the underlying boundary logic. Confirm the intended rule (pending ingest should start at next expected, not beyond). If the rule is intended, adjust the model and/or coordinator state machine so it enforces contiguity when ingesting pending events. Add a regression test in the beads runtime to mirror the counterexample trace once the implementation exists (or add a model-only regression property if implementation work is not yet wired).\n\n**Acceptance**\n- [ ] Model check passes without the \"pending ingest starts at next expected\" counterexample.\n- [ ] If rule is intended, coordinator boundary enforces contiguity (no ingest beyond next expected).\n- [ ] Regression test added for the counterexample trace (model or implementation).\n\n**Files:** beads_stateright_models/examples/session_coordinator_boundary.rs","id":"bd-qsk","labels":[],"priority":2,"status":"closed","title":"Stateright model: pending ingest contiguity counterexample","type":"bug"}
