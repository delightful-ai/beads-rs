{"_at":[1768437916950,0],"_by":"darin@darinsmcstudio2.lan","assignee":"darin@book","created_at":[1768178870748,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nPlan requires crash tests to verify recovery behavior after SIGKILL at various points.\n\n**Context**\n- REALTIME_PLAN.md §18 (crash tests)\n\n**Design**\n- Integration tests that:\n  - Inject SIGKILL during append (after write before fsync, after fsync before index commit, etc.)\n  - Assert recovery: no duplicate origin_seq, tail truncation correct, index rebuild correct\n- Use fork() or subprocess to inject crashes\n- Verify idempotency mapping survives\n\n**Acceptance**\n- [ ] Test kills daemon mid-append and verifies recovery\n- [ ] No duplicate origin_seq after crash\n- [ ] Tail truncation handles partial records\n- [ ] Index rebuild correct after crash\n\n**Files:** tests/crash_recovery.rs (new)","id":"bd-3m5.42","labels":{"cc":{"max":{}},"entries":{}},"priority":3,"status":"closed","title":"Cross-phase: Crash safety integration tests","type":"task"}
{"_at":[1768726624161,0],"_by":"darin@darinsmcstudio2.lan","acceptance_criteria":"**Acceptance**\n- [ ] Notes summarizing both papers are captured in the bead (or linked), and key mechanisms chosen.\n- [ ] Interleaving replay harness exists and is used by at least one replication e2e test.\n- [ ] Harness can replay a captured trace deterministically and fail on divergence.\n- [ ] Tests write only under ./tmp and pass with `cargo test --features slow-tests`.","assignee":"darin@book","created_at":[1768673120786,0],"created_by":"darin@darinsmcstudio2.lan","description":"**Problem**\nWe do not have interleaving-aware testing for replication; subtle message-order bugs can slip through even when the model looks right.","design":"**Design**\n- First: fully read the papers in order before coding.\n  1) iMocket: Model Checking Guided Incremental Testing for Distributed Systems\n     https://dl.acm.org/doi/10.1145/3728883\n  2) ER-π: Exhaustive Interleaving Replay for Testing Replicated Data Library Integration\n     https://people.cs.vt.edu/provakar/Middleware_25__ER_%F0%9D%9C%8B_.pdf\n- Extract concrete mechanisms we can implement (interleaving capture, scheduling control, replay).\n- Implement a targeted interleaving replay harness for beads replication tests: record message orderings for repl sessions + tailnet proxy, replay deterministically, and integrate into slow-tests/CI.","id":"bd-5cay","labels":{"cc":{"max":{}},"entries":{}},"notes":[{"at":[1768726414980,0],"author":"darin@book","content":"Notes from papers:\n\n- iMocket: incremental model-checking-guided testing. Model checker generates traces for tests; when the model changes, only affected states are re-tested via incremental testing patterns. Uses a growth-based graph traversal algorithm to identify affected states and minimize the required tests compared to full re-checking.\n\n- ER-π: exhaustive interleaving replay for replicated libraries. Workflow: instrument Start/End around the code segment; proxy intercepts library calls to extract operations + events; generate interleavings, reset replicas between runs, and enforce a chosen interleaving via a distributed lock. Pruning techniques include event grouping, replica-specific pruning, event-independence pruning, and skipping failed ops.\n\nChosen mechanisms to implement now:\n- Intercept replication frames via tailnet proxy, record the observed interleaving order, and replay deterministically.\n- Deterministic replay enforcement with a strict order (fails if the run diverges).\n- Keep trace files per link under ./tmp; integrate in a slow e2e test.","id":"go-comment-bd-5cay-1"},{"at":[1768726624161,0],"author":"darin@darinsmcstudio2.lan","content":"Notes from papers:\n\n- iMocket: incremental model-checking-guided testing. Model checker generates traces for tests; when the model changes, only affected states are re-tested via incremental testing patterns. Uses a growth-based graph traversal algorithm to identify affected states and minimize the required tests compared to full re-checking.\n\n- ER-π: exhaustive interleaving replay for replicated libraries. Workflow: instrument Start/End around the code segment; proxy intercepts library calls to extract operations + events; generate interleavings, reset replicas between runs, and enforce a chosen interleaving via a distributed lock. Pruning techniques include event grouping, replica-specific pruning, event-independence pruning, and skipping failed ops.\n\nChosen mechanisms to implement now:\n- Intercept replication frames via tailnet proxy, record the observed interleaving order, and replay deterministically.\n- Deterministic replay enforcement with a strict order (fails if the run diverges).\n- Keep trace files per link under ./tmp; integrate in a slow e2e test.","id":"legacy-notes"}],"priority":0,"status":"closed","title":"Realtime: interleaving replay harness (read iMocket + ER-π first)","type":"bug"}
